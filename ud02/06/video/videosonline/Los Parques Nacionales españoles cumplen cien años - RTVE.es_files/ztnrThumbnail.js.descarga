define(["vendor/jquery"],function(t){"use strict";function e(t){var e,r,i;if(i=t.readInt(),r=t.readChars(4),e=[],t.read(e,0,i)!==i)throw"Out of bounds";return t.skip(4),{type:r,data:e}}function r(t){var e,r,i,s;for(e="",r=0,i=0,s=0,r=0;r<t.length;r++)0===s?(e+=t.charAt(r),i=(i+1)%4,s=i):s--;return e}function i(t,e){var r,i,s,n,o,a;for(r="",i=0,s=0,n=3,o=1,i=0;i<t.length;i++)0===s?(a=10*parseInt(t.charAt(i)),s=1):0===n?(a+=parseInt(t.charAt(i)),r+=e.charAt(a),n=(o+3)%4,s=0,o++):n--;return r}function s(t){var e,s,n;return n=t.indexOf("#"),s=r(t.substring(0,n)),e=t.substring(n+1),i(e,s)}function n(t,r){this.logger.log("RtvePlayer","ztnrThumbnail","function uPlayerShow ()"+t);var i,n,a,h=[],u=[];try{for(n=new o(t),n.skip(8),i=e(n);"IEND"!==i.type;){if("tEXt"===i.type){var l=i.data,c="",g=0;for(g=0;g<l.length;++g)0!==l[g]&&(c+=String.fromCharCode(l[g]));a=-1===c.indexOf("%%")?"":c.split("#")[1].split("%%")[0],c=-1===c.indexOf("%%")?c:c.split("#")[0]+"#"+c.split("#")[1].split("%%")[1],u.push(a),h.push(s(c))}i=e(n)}}catch(t){this.logger.error("RtvePlayer","ztnrThumbnail","No se ha podido procesar la img en modeTwo.")}r(h,u)}var o=function(t){this.position=0,this.base64=t,this.bits=0,this.bitsLength=0,this.readByte=function(){try{if(0===this.bitsLength){for(var t=0;this.position<this.base64.length&&this.bitsLength<24;){var e=this.base64.charAt(this.position);if(++this.position,e>" "){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e);if(r<0)throw"Invalid character";if(r<64){if(t>0)throw"Invalid encoding (padding)";this.bits=this.bits<<6|r}else{if(this.bitsLenght<8)throw"Invalid encoding (extra)";this.bits<<=6,t+=6}this.bitsLength+=6}}if(this.position>=this.base64.length){if(0===this.bitsLength)return-1;if(this.bitsLength<24)throw"Invalid encoding (end)"}6===t?t=8:12===t&&(t=16),this.bits=this.bits>>t,this.bitsLength-=t}return this.bitsLength-=8,this.bits>>this.bitsLength&255}catch(t){console.error("RtvePlayer","ztnrThumbnail","Base64Reader readByte error: "+t.message)}},this.read=function(t,e,r){for(var i=0;i<r;){var s=this.readByte();if(-1===s)return i;t[e+i]=s,i++}return i},this.readChar=function(){var t=this.readByte();return-1===t?null:String.fromCharCode(t)},this.readChars=function(t){for(var e="",r=0;r<t;r++){var i=this.readChar();if(!i)return e;e+=i}return e},this.skip=function(t){for(var e=0;e<t;e++)this.readByte()},this.readInt=function(){var t=[];if(4!==this.read(t,0,4))throw"Out of bounds";return t[0]<<24|t[1]<<16|t[2]<<8|t[3]}};return{load:function(e){var r,i=t.Deferred(),s=new XMLHttpRequest,o=this,a=o.options.mediaConfig.assetConfig.live,h={sources:[]},u={preset:[]},l=0,c="";this.logger.log("RtvePlayer","ztnrThumbnail","idManager=",e);var g=this.options.mediaConfig.ztnrMvlThumbUrl.replace("{idManager}",e).concat("?q=v2");this.logger.log("RtvePlayer","ztnrThumbnail","ztnrMvlThumbUrl=",g),s.onload=function(t){var e=409==s.status||402==s.status?s.status:void 0;n.call(o,t.currentTarget.responseText,function(t,s){if(s.forEach(function(e){r!==e&&(u.preset.push({type:e,response:{url:o.utils.getUrls(e,t,s,a,o),code:"ok",geolocalizated:"",gmtDisabled:"",gmtEnabled:"",state:"",unpublishDate:""},order:l.toString()}),l++),r=e},this),0===t.length&&i.rejectWith(o,[]),void 0!==t&&t.length>0&&(c=o.utils.getContentType(t[0])),"audio/x-mpegurl"===c)o.m3uParser(t[0],function(t){c=o.utils.getContentType(t),h.sources.push(o.utils.getSourceList(t,c,a,e)),0===h.sources.length?i.rejectWith(o,[]):i.resolveWith(o,[{quality:u,sources:h.sources}]),o.logger.log("RtvePlayer","ztnrThumbnail M3UParser","src=",t)}.bind(o));else{o.utils.needsMp4Format(o)&&(t=o.utils.getMp4Files(t));for(var n=0;n<t.length;++n)h.sources.push(o.utils.getSourceList(t[n],o.utils.getContentType(t[n]),a,e));void 0!==h&&h.sources.length>0&&(c=o.utils.getContentType(h.sources[0].src)),null===h.sources[0]||void 0===h.sources[0]?i.rejectWith(o,[]):i.resolveWith(o,[{quality:u,sources:h.sources}])}})},s.onerror=function(t){o.logger.log("RtvePlayer","ztnrThumbnail","Error ZtnrThumbnail=",t)};try{var d=window.location.href.split("/"),f=-1!==d[2].search("pre")?d[0]+"//ztnr-pre.rtve.es"+g:d[0]+"//ztnr.rtve.es"+g;s.open("GET",f,!0),s.send(null)}catch(t){o.logger.log("RtvePlayer","ztnrThumbnail","Error try/catch ZtnrThumbnail=",t)}return i.promise()}}});