define(["vendor/jquery","vendor/videojs/video"],function(e,r){"use strict";function a(e){window.navigator.userAgent;return this.options.idManager&&(this.logger.warn("RtvePlayer","manager","Changing idManager for",this.options.idManager),e=this.options.idManager),this.utils.checkIfRareCaseOfIE11(this.options)&&(e=this.CONS.desktopIdManager),e}var t=function(e){var r,a,t,i,n,g,l,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",h=0;for(e=o(e);h<e.length;)r=e.charCodeAt(h++),a=e.charCodeAt(h++),t=e.charCodeAt(h++),i=r>>2,n=(3&r)<<4|a>>4,g=(15&a)<<2|t>>6,l=63&t,isNaN(a)?g=l=64:isNaN(t)&&(l=64),s=s+d.charAt(i)+d.charAt(n)+d.charAt(g)+d.charAt(l);return s},o=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var r="",a=0;a<e.length;a++){var t=e.charCodeAt(a);t<128?r+=String.fromCharCode(t):t>127&&t<2048?(r+=String.fromCharCode(t>>6|192),r+=String.fromCharCode(63&t|128)):(r+=String.fromCharCode(t>>12|224),r+=String.fromCharCode(t>>6&63|128),r+=String.fromCharCode(63&t|128))}return r};return{load:function(r){var o=e.Deferred(),i=this.CONS.defaultIdManager,n=i,g=window.navigator.userAgent,l=window.localStorage;if(this.logger.log("RtvePlayer","manager","localStorage=",l&&l.getItem("odin")),this.logger.log("RtvePlayer","manager",-1===g.indexOf("AdobeAIR"),!(l&&l.getItem("odin")||r)),-1!==g.indexOf("AdobeAIR")||l&&l.getItem("odin")||r)n=l&&l.getItem("odin"),this.logger.log("RtvePlayer","manager","No localStorage","cookieSalida=",n),void 0!==n&&"undefined"!==n||(this.logger.warn("RtvePlayer","manager","cookieSalida UNDEFINED"),n=i),n=a.call(this,n),o.resolveWith(this,[n]);else{var d="";r&&(d=l&&l.getItem("odin"));var s=this.options.mediaConfig.lokiUrl.replace("{chunk}",t(g).replace(/\//g,"_").replace(/\+/g,"-"));this.logger.log("RtvePlayer","manager","lokiUrl=",s),require(["vendor/text!"+s],function(e){try{e=JSON.parse(e)}catch(e){this.logger.error("RtvePlayer","manager","Error parse loki URL"),n="undefined"}(r&&e.manager===d||"undefined"===n)&&(this.logger.warn("RtvePlayer","manager","Returning default idManager"),e.manager=i),n=e.manager;try{null!==l&&l.setItem("odin",n)}catch(e){this.logger.log("RtvePlayer","manager","error","AccesLocalStorage")}n=a.call(this,n),o.resolveWith(this,[n])}.bind(this),function(){try{null!==l&&l.setItem("odin",i)}catch(e){rtveplayer.logger.log("RtvePlayer","manager","error","AccesLocalStorage")}n=a.call(this,i),o.resolveWith(this,[n])}.bind(this))}return o.promise()}}});