/*! videojs-teltoo 0.2.33 Copyright (c) Teltoo S.L. - All rights reserved (12-05-20 13:33:11 GMT+0200) */
!function(){function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}return a}()({1:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e=a(4),f=d(e),g=a(3),h=d(g);!function(a){function b(){if(a.videojs&&"undefined"!=typeof teltoo&&"undefined"!=typeof Hls){Hls.DefaultConfig.capLevelToPlayerSize=!0,f["default"].registerConfigPlugin(a.videojs),f["default"].registerSourceHandler(a.videojs),h["default"](Hls);var d=a.videojs.getComponent("Html5");if(d){var e=d.registerSourceHandler;d.registerSourceHandler=function(a,b){0===b&&(b=1),e.call(d,a,b)}}}else setTimeout(b,c)}var c=100;b()}(window)},{3:3,4:4}],2:[function(a,b,c){"undefined"!=typeof window&&function(a,d){"object"==typeof c&&"object"==typeof b?b.exports=d():"function"==typeof define&&define.amd?define([],d):"object"==typeof c?c.Hls=d():a.Hls=d()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})},b.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},b.t=function(a,c){if(1&c&&(a=b(a)),8&c)return a;if(4&c&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&c&&"string"!=typeof a)for(var e in a)b.d(d,e,function(b){return a[b]}.bind(null,e));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(a,b,c){"use strict";function d(){}function e(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function f(a,b,c,d,f){if("function"!=typeof c)throw new TypeError("The listener must be a function");var g=new e(c,d||a,f),h=j?j+b:b;return a._events[h]?a._events[h].fn?a._events[h]=[a._events[h],g]:a._events[h].push(g):(a._events[h]=g,a._eventsCount++),a}function g(a,b){0===--a._eventsCount?a._events=new d:delete a._events[b]}function h(){this._events=new d,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,j="~";Object.create&&(d.prototype=Object.create(null),(new d).__proto__||(j=!1)),h.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)i.call(a,b)&&c.push(j?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},h.prototype.listeners=function(a){var b=j?j+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=new Array(e);e>d;d++)f[d]=c[d].fn;return f},h.prototype.listenerCount=function(a){var b=j?j+a:a,c=this._events[b];return c?c.fn?1:c.length:0},h.prototype.emit=function(a,b,c,d,e,f){var g=j?j+a:a;if(!this._events[g])return!1;var h,i,k=this._events[g],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,f),!0}for(i=1,h=new Array(l-1);l>i;i++)h[i-1]=arguments[i];k.fn.apply(k.context,h)}else{var m,n=k.length;for(i=0;n>i;i++)switch(k[i].once&&this.removeListener(a,k[i].fn,void 0,!0),l){case 1:k[i].fn.call(k[i].context);break;case 2:k[i].fn.call(k[i].context,b);break;case 3:k[i].fn.call(k[i].context,b,c);break;case 4:k[i].fn.call(k[i].context,b,c,d);break;default:if(!h)for(m=1,h=new Array(l-1);l>m;m++)h[m-1]=arguments[m];k[i].fn.apply(k[i].context,h)}}return!0},h.prototype.on=function(a,b,c){return f(this,a,b,c,!1)},h.prototype.once=function(a,b,c){return f(this,a,b,c,!0)},h.prototype.removeListener=function(a,b,c,d){var e=j?j+a:a;if(!this._events[e])return this;if(!b)return g(this,e),this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||g(this,e);else{for(var h=0,i=[],k=f.length;k>h;h++)(f[h].fn!==b||d&&!f[h].once||c&&f[h].context!==c)&&i.push(f[h]);i.length?this._events[e]=1===i.length?i[0]:i:g(this,e)}return this},h.prototype.removeAllListeners=function(a){var b;return a?(b=j?j+a:a,this._events[b]&&g(this,b)):(this._events=new d,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=j,h.EventEmitter=h,a.exports=h},"./node_modules/node-libs-browser/node_modules/events/events.js":function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,"function"==typeof console.trace)),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(a,b,c){!function(b){var c=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,d=/^([^\/?#]*)(.*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,g={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),b=b.trim(),!b){if(!c.alwaysNormalize)return a;var e=g.parseURL(a);if(!e)throw new Error("Error trying to parse base URL.");return e.path=g.normalizePath(e.path),g.buildURLFromParts(e)}var f=g.parseURL(b);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=g.normalizePath(f.path),g.buildURLFromParts(f)):b;var h=g.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var i=d.exec(h.path);h.netLoc=i[1],h.path=i[2]}h.netLoc&&!h.path&&(h.path="/");var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(j.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var k=h.path,l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}else j.path=h.path,f.params||(j.params=h.params,f.query||(j.query=h.query));return null===j.path&&(j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path),g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=g}(this)},"./node_modules/webworkify-webpack/index.js":function(a,b,c){function d(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/",b.oe=function(a){throw a};var d=b(b.s=ENTRY_MODULE);return d["default"]||d}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){return!isNaN(1*a)}function g(a,b,d){var g={};g[d]=[];var h=b.toString(),i=h.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return g;for(var l,m=i[1],n=new RegExp("(\\\\n|\\W)"+e(m)+k,"g");l=n.exec(h);)"dll-reference"!==l[3]&&g[d].push(l[3]);for(n=new RegExp("\\("+e(m)+'\\("(dll-reference\\s('+j+'))"\\)\\)'+k,"g");l=n.exec(h);)a[l[2]]||(g[d].push(l[1]),a[l[2]]=c(l[1]).m),g[l[2]]=g[l[2]]||[],g[l[2]].push(l[4]);for(var o=Object.keys(g),p=0;p<o.length;p++)for(var q=0;q<g[o[p]].length;q++)f(g[o[p]][q])&&(g[o[p]][q]=1*g[o[p]][q]);return g}function h(a){var b=Object.keys(a);return b.reduce(function(b,c){return b||a[c].length>0},!1)}function i(a,b){for(var c={main:[b]},d={main:[]},e={main:{}};h(c);)for(var f=Object.keys(c),i=0;i<f.length;i++){var j=f[i],k=c[j],l=k.pop();if(e[j]=e[j]||{},!e[j][l]&&a[j][l]){e[j][l]=!0,d[j]=d[j]||[],d[j].push(l);for(var m=g(a,a[j][l],j),n=Object.keys(m),o=0;o<n.length;o++)c[n[o]]=c[n[o]]||[],c[n[o]]=c[n[o]].concat(m[n[o]])}}return d}var j="[\\.|\\-|\\+|\\w|/|@]+",k="\\((/\\*.*?\\*/)?s?.*?("+j+").*?\\)";a.exports=function(a,b){b=b||{};var e={main:c.m},f=b.all?{main:Object.keys(e.main)}:i(e,a),g="";Object.keys(f).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;f[a][b];)b++;f[a].push(b),e[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+f[a].map(function(b){return""+JSON.stringify(b)+": "+e[a][b].toString()}).join(",")+"});\n"}),g=g+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.main.map(function(a){return""+JSON.stringify(a)+": "+e.main[a].toString()}).join(",")+"}))(self);";var h=new window.Blob([g],{type:"text/javascript"});if(b.bare)return h;var j=window.URL||window.webkitURL||window.mozURL||window.msURL,k=j.createObjectURL(h),l=new window.Worker(k);return l.objectURL=k,l}},"./src/config.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/controller/abr-controller.js"),e=c("./src/controller/buffer-controller.js"),f=c("./src/controller/cap-level-controller.js"),g=c("./src/controller/fps-controller.js"),h=c("./src/utils/xhr-loader.js"),i=c("./src/controller/audio-track-controller.js"),j=c("./src/controller/audio-stream-controller.js"),k=c("./src/utils/cues.js"),l=c("./src/controller/timeline-controller.js"),m=c("./src/controller/subtitle-track-controller.js"),n=c("./src/controller/subtitle-stream-controller.js"),o=c("./src/controller/eme-controller.js"),p=c("./src/utils/mediakeys-helper.js");b.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:h["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:d["default"],bufferController:e["default"],capLevelController:f["default"],fpsController:g["default"],stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:p.requestMediaKeySystemAccess},b.hlsDefaultConfig.subtitleStreamController=n.SubtitleStreamController,b.hlsDefaultConfig.subtitleTrackController=m["default"],b.hlsDefaultConfig.timelineController=l["default"],b.hlsDefaultConfig.cueHandler=k,b.hlsDefaultConfig.enableCEA708Captions=!0,b.hlsDefaultConfig.enableWebVTT=!0,b.hlsDefaultConfig.captionsTextTrack1Label="English",b.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",b.hlsDefaultConfig.captionsTextTrack2Label="Spanish",b.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",b.hlsDefaultConfig.audioStreamController=j["default"],b.hlsDefaultConfig.audioTrackController=i["default"],b.hlsDefaultConfig.emeController=o["default"]},"./src/controller/abr-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/utils/buffer-helper.js"),h=c("./src/errors.js"),i=c("./src/utils/logger.js"),j=c("./src/utils/ewma-bandwidth-estimator.js"),k=window.performance,l=function(b){function c(a){var c=b.call(this,a,e["default"].FRAG_LOADING,e["default"].FRAG_LOADED,e["default"].FRAG_BUFFERED,e["default"].ERROR)||this;return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.timer=null,c._bwEstimator=null,c.onCheck=c._abandonRulesCheck.bind(c),c}return d(c,b),c.prototype.destroy=function(){this.clearTimer(),f["default"].prototype.destroy.call(this)},c.prototype.onFragLoading=function(a){var b=a.frag;if("main"===b.type&&(this.timer||(this.fragCurrent=b,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var c=this.hls,d=c.config,e=b.level,f=c.levels[e].details.live,g=void 0,h=void 0;f?(g=d.abrEwmaFastLive,h=d.abrEwmaSlowLive):(g=d.abrEwmaFastVoD,h=d.abrEwmaSlowVoD),this._bwEstimator=new j["default"](c,h,g,d.abrEwmaDefaultEstimate)}},c.prototype._abandonRulesCheck=function(){var a=this.hls,b=a.media,c=this.fragCurrent;if(c){var d=c.loader,f=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return i.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var h=d.stats;if(b&&h&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var j=k.now()-h.trequest,l=Math.abs(b.playbackRate);if(j>500*c.duration/l){var m=a.levels,n=Math.max(1,h.bw?h.bw/8:1e3*h.loaded/j),o=m[c.level],p=o.realBitrate?Math.max(o.realBitrate,o.bitrate):o.bitrate,q=h.total?h.total:Math.max(h.loaded,Math.round(c.duration*p/8)),r=b.currentTime,s=(q-h.loaded)/n,t=(g.BufferHelper.bufferInfo(b,r,a.config.maxBufferHole).end-r)/l;if(t<2*c.duration/l&&s>t){var u=void 0,v=void 0;for(v=c.level-1;v>f;v--){var w=m[v].realBitrate?Math.max(m[v].realBitrate,m[v].bitrate):m[v].bitrate;if(u=c.duration*w/(6.4*n),t>u)break}s>u&&(i.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+u.toFixed(1)+"<"+s.toFixed(1)+":"+t.toFixed(1)),a.nextLoadLevel=v,this._bwEstimator.sample(j,h.loaded),d.abort(),this.clearTimer(),a.trigger(e["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:h}))}}}}},c.prototype.onFragLoaded=function(b){var c=b.frag;if("main"===c.type&&a.isFinite(c.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[c.level],e=(d.loaded?d.loaded.bytes:0)+b.stats.loaded,f=(d.loaded?d.loaded.duration:0)+b.frag.duration;d.loaded={bytes:e,duration:f},d.realBitrate=Math.round(8*e/f)}if(b.frag.bitrateTest){var g=b.stats;g.tparsed=g.tbuffered=g.tload,this.onFragBuffered(b)}}},c.prototype.onFragBuffered=function(b){var c=b.stats,d=b.frag;if(c.aborted!==!0&&"main"===d.type&&a.isFinite(d.sn)&&(!d.bitrateTest||c.tload===c.tbuffered)){var e=c.tparsed-c.trequest;i.logger.log("latency/loading/parsing/append/kbps:"+Math.round(c.tfirst-c.trequest)+"/"+Math.round(c.tload-c.tfirst)+"/"+Math.round(c.tparsed-c.tload)+"/"+Math.round(c.tbuffered-c.tparsed)+"/"+Math.round(8*c.loaded/(c.tbuffered-c.trequest))),this._bwEstimator.sample(e,c.loaded),c.bwEstimate=this._bwEstimator.getEstimate(),d.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}},c.prototype.onError=function(a){switch(a.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},c.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(c.prototype,"nextAutoLevel",{get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return-1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_nextABRAutoLevel",{get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,h=this.lastLoadedFragLevel,j=this.fragCurrent?this.fragCurrent.duration:0,k=f?f.currentTime:0,l=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,m=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,n=(g.BufferHelper.bufferInfo(f,k,d.maxBufferHole).end-k)/l,o=this._findBestLevel(h,j,m,e,b,n,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(o>=0)return o;i.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=j?Math.min(j,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor;if(0===n){var s=this.bitrateTestDelay;if(s){var t=j?Math.min(j,d.maxLoadingDelay):d.maxLoadingDelay;p=t-s,i.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),q=r=1}}return o=this._findBestLevel(h,j,m,e,b,n+p,q,r,c),Math.max(o,0)},enumerable:!0,configurable:!0}),c.prototype._findBestLevel=function(a,b,c,d,e,f,g,h,j){for(var k=e;k>=d;k--){var l=j[k];if(l){var m=l.details,n=m?m.totalduration/m.fragments.length:b,o=m?m.live:!1,p=void 0;p=a>=k?g*c:h*c;var q=j[k].realBitrate?Math.max(j[k].realBitrate,j[k].bitrate):j[k].bitrate,r=q*n/p;if(i.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(p)+"/"+q+"/"+n+"/"+f+"/"+r),p>q&&(!r||o&&!this.bitrateTestDelay||f>r))return k}}return-1},c}(f["default"]);b["default"]=l}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/binary-search.js"),f=c("./src/utils/buffer-helper.js"),g=c("./src/demux/demuxer.js"),h=c("./src/events.js"),i=c("./src/controller/level-helper.js"),j=c("./src/utils/time-ranges.js"),k=c("./src/errors.js"),l=c("./src/utils/logger.js"),m=c("./src/utils/discontinuities.js"),n=c("./src/controller/fragment-tracker.js"),o=c("./src/loader/fragment.js"),p=c("./src/controller/base-stream-controller.js"),q=window.performance,r=100,s=function(b){function c(a,c){var d=b.call(this,a,h["default"].MEDIA_ATTACHED,h["default"].MEDIA_DETACHING,h["default"].AUDIO_TRACKS_UPDATED,h["default"].AUDIO_TRACK_SWITCHING,h["default"].AUDIO_TRACK_LOADED,h["default"].KEY_LOADED,h["default"].FRAG_LOADED,h["default"].FRAG_PARSING_INIT_SEGMENT,h["default"].FRAG_PARSING_DATA,h["default"].FRAG_PARSED,h["default"].ERROR,h["default"].BUFFER_RESET,h["default"].BUFFER_CREATED,h["default"].BUFFER_APPENDED,h["default"].BUFFER_FLUSHED,h["default"].INIT_PTS_FOUND)||this;return d.fragmentTracker=c,d.config=a.config,d.audioCodecSwap=!1,d._state=p.State.STOPPED,d.initPTS=[],d.waitingFragment=null,d.videoTrackCC=null,d}return d(c,b),c.prototype.onInitPtsFound=function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,this.videoTrackCC=c,l.logger.log("InitPTS for cc: "+c+" found from video track: "+d),this.state===p.State.WAITING_INIT_PTS&&this.tick())},c.prototype.startLoad=function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.setInterval(r),this.fragLoadError=0,b>0&&-1===a?(l.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=p.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=p.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=p.State.STOPPED},Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(a){if(this.state!==a){var b=this.state;this._state=a,l.logger.log("audio stream:"+b+"->"+a)}},enumerable:!0,configurable:!0}),c.prototype.doTick=function(){var b,c,d,g=this.hls,i=g.config;switch(this.state){case p.State.ERROR:case p.State.PAUSED:case p.State.BUFFER_FLUSHING:break;case p.State.STARTING:this.state=p.State.WAITING_TRACK,this.loadedmetadata=!1;break;case p.State.IDLE:var j=this.tracks;if(!j)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)b=this.media.currentTime;else if(b=this.nextLoadPosition,void 0===b)break;var k=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,r=f.BufferHelper.bufferInfo(k,b,i.maxBufferHole),s=f.BufferHelper.bufferInfo(o,b,i.maxBufferHole),t=r.len,u=r.end,v=this.fragPrevious,w=Math.min(i.maxBufferLength,i.maxMaxBufferLength),x=Math.max(w,s.len),y=this.audioSwitch,z=this.trackId;if((x>t||y)&&z<j.length){if(d=j[z].details,"undefined"==typeof d){this.state=p.State.WAITING_TRACK;break}if(!y&&this._streamEnded(r,d))return this.hls.trigger(h["default"].BUFFER_EOS,{type:"audio"}),void(this.state=p.State.ENDED);var A=d.fragments,B=A.length,C=A[0].start,D=A[B-1].start+A[B-1].duration,E=void 0;if(y)if(d.live&&!d.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),u=0;else if(u=b,d.PTSKnown&&C>b){if(!(r.end>C||r.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=C+.05}if(d.initSegment&&!d.initSegment.data)E=d.initSegment;else if(C>=u){if(E=A[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=m.findFragWithCC(A,this.videoTrackCC)),d.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var F=r.nextStart?r.nextStart:C;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(F+.05)),void(this.media.currentTime=F+.05)}}else{var G=void 0,H=i.maxFragLookUpTolerance,I=v?A[v.sn-A[0].sn+1]:void 0,J=function(a){var b=Math.min(H,a.duration);return a.start+a.duration-b<=u?1:a.start-b>u&&a.start?-1:0};D>u?(u>D-H&&(H=0),G=I&&!J(I)?I:e["default"].search(A,J)):G=A[B-1],G&&(E=G,C=G.start,v&&E.level===v.level&&E.sn===v.sn&&(E.sn<d.endSN?(E=A[E.sn+1-d.startSN],l.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(l.logger.log("Loading key for "+E.sn+" of ["+d.startSN+" ,"+d.endSN+"],track "+z),this.state=p.State.KEY_LOADING,g.trigger(h["default"].KEY_LOADING,{frag:E})):(l.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+d.startSN+" ,"+d.endSN+"],track "+z+", currentTime:"+b+",bufferEnd:"+u.toFixed(3)),this.fragCurrent=E,(y||this.fragmentTracker.getState(E)===n.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,a.isFinite(E.sn)&&(this.nextLoadPosition=E.start+E.duration),g.trigger(h["default"].FRAG_LOADING,{frag:E}),this.state=p.State.FRAG_LOADING)))}break;case p.State.WAITING_TRACK:c=this.tracks[this.trackId],c&&c.details&&(this.state=p.State.IDLE);break;case p.State.FRAG_LOADING_WAITING_RETRY:var K=q.now(),L=this.retryDate;k=this.media;var M=k&&k.seeking;(!L||K>=L||M)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=p.State.IDLE);break;case p.State.WAITING_INIT_PTS:var N=this.videoTrackCC;if(void 0===this.initPTS[N])break;var O=this.waitingFragment;if(O){var P=O.frag.cc;N!==P?(c=this.tracks[this.trackId],c.details&&c.details.live&&(l.logger.warn("Waiting fragment CC ("+P+") does not match video track CC ("+N+")"),this.waitingFragment=null,this.state=p.State.IDLE)):(this.state=p.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=p.State.IDLE;break;case p.State.STOPPED:case p.State.FRAG_LOADING:case p.State.PARSING:case p.State.PARSED:case p.State.ENDED:}},c.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)},c.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},c.prototype.onAudioTracksUpdated=function(a){l.logger.log("audio tracks updated"),this.tracks=a.audioTracks},c.prototype.onAudioTrackSwitching=function(a){var b=!!a.url;this.trackId=a.id,this.fragCurrent=null,this.state=p.State.PAUSED,this.waitingFragment=null,b?this.setInterval(r):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=p.State.IDLE),this.tick()},c.prototype.onAudioTrackLoaded=function(b){var c=b.details,d=b.id,e=this.tracks[d],f=c.totalduration,g=0;if(l.logger.log("track "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+f),c.live){var h=e.details;h&&c.fragments.length>0?(i.mergeDetails(h,c),g=c.fragments[0].start,c.PTSKnown?l.logger.log("live audio playlist sliding:"+g.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(c.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding"))}else c.PTSKnown=!1;if(e.details=c,!this.startFragRequested){if(-1===this.startPosition){var j=c.startTimeOffset;a.isFinite(j)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+j),this.startPosition=j):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===p.State.WAITING_TRACK&&(this.state=p.State.IDLE),this.tick()},c.prototype.onKeyLoaded=function(){this.state===p.State.KEY_LOADING&&(this.state=p.State.IDLE,this.tick())},c.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===p.State.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,i=b.level,j=b.sn,k=b.cc,m=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",n=this.stats=a.stats;if("initSegment"===j)this.state=p.State.IDLE,n.tparsed=n.tbuffered=q.now(),e.initSegment.data=a.payload,this.hls.trigger(h["default"].FRAG_BUFFERED,{stats:n,frag:b,id:"audio"}),this.tick();else{this.state=p.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new g["default"](this.hls,"audio"));var o=this.initPTS[k],r=e.initSegment?e.initSegment.data:[];if(e.initSegment||void 0!==o){this.pendingBuffering=!0,l.logger.log("Demuxing "+j+" of ["+e.startSN+" ,"+e.endSN+"],track "+i);var s=!1;this.demuxer.push(a.payload,r,m,null,b,f,s,o)}else l.logger.log("unknown video PTS for continuity counter "+k+", waiting for video PTS before demuxing audio frag "+j+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.waitingFragment=a,this.state=p.State.WAITING_INIT_PTS}}this.fragLoadError=0},c.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===p.State.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec=e.codec,e.id=a.id,this.hls.trigger(h["default"].BUFFER_CODECS,d),l.logger.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h["default"].BUFFER_APPENDING,g))}this.tick()}}},c.prototype.onFragParsingData=function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"audio"===b.id&&"audio"===b.type&&e.sn===d.sn&&e.level===d.level&&this.state===p.State.PARSING){
var f=this.trackId,g=this.tracks[f],j=this.hls;a.isFinite(b.endPTS)||(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),d.addElementaryStream(o["default"].ElementaryStreamTypes.AUDIO),l.logger.log("parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb),i.updateFragPTSDTS(g.details,d,b.startPTS,b.endPTS);var m=this.audioSwitch,n=this.media,q=!1;if(m&&n)if(n.readyState){var r=n.currentTime;l.logger.log("switching audio track : currentTime:"+r),r>=b.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=p.State.BUFFER_FLUSHING,j.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}),q=!0,this.audioSwitch=!1,j.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:f}))}else this.audioSwitch=!1,j.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:f});var s=this.pendingData;if(!s)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void j.trigger(h["default"].ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([b.data1,b.data2].forEach(function(a){a&&a.length&&s.push({type:b.type,data:a,parent:"audio",content:"data"})}),!q&&s.length&&(s.forEach(function(a){c.state===p.State.PARSING&&(c.pendingBuffering=!0,c.hls.trigger(h["default"].BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}},c.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===p.State.PARSING&&(this.stats.tparsed=q.now(),this.state=p.State.PARSED,this._checkAppendedParsed())},c.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},c.prototype.onBufferCreated=function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},c.prototype.onBufferAppended=function(a){if("audio"===a.parent){var b=this.state;(b===p.State.PARSING||b===p.State.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},c.prototype._checkAppendedParsed=function(){if(!(this.state!==p.State.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=q.now(),c.trigger(h["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;l.logger.log("audio buffered : "+j["default"].toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=p.State.IDLE}this.tick()}},c.prototype.onError=function(b){var c=b.frag;if(!c||"audio"===c.type)switch(b.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:var d=b.frag;if(d&&"audio"!==d.type)break;if(!b.fatal){var e=this.fragLoadError;e?e++:e=1;var g=this.config;if(e<=g.fragLoadingMaxRetry){this.fragLoadError=e;var i=Math.min(Math.pow(2,e-1)*g.fragLoadingRetryDelay,g.fragLoadingMaxRetryTimeout);l.logger.warn("AudioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=q.now()+i,this.state=p.State.FRAG_LOADING_WAITING_RETRY}else l.logger.error("AudioStreamController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=p.State.ERROR}break;case k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==p.State.ERROR&&(this.state=b.fatal?p.State.ERROR:p.State.IDLE,l.logger.warn("AudioStreamController: "+b.details+" while loading frag, now switching to "+this.state+" state ..."));break;case k.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===b.parent&&(this.state===p.State.PARSING||this.state===p.State.PARSED)){var j=this.mediaBuffer,m=this.media.currentTime,n=j&&f.BufferHelper.isBuffered(j,m)&&f.BufferHelper.isBuffered(j,m+.5);if(n){var g=this.config;g.maxMaxBufferLength>=g.maxBufferLength&&(g.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+g.maxMaxBufferLength+"s")),this.state=p.State.IDLE}else l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=p.State.BUFFER_FLUSHING,this.hls.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"})}}},c.prototype.onBufferFlushed=function(){var a=this,b=this.pendingData;b&&b.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),b.forEach(function(b){a.hls.trigger(h["default"].BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=p.State.PARSED):(this.state=p.State.IDLE,this.fragPrevious=null,this.tick())},c}(p["default"]);b["default"]=s}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/task-loop.js"),g=c("./src/utils/logger.js"),h=c("./src/errors.js"),i=function(a){function b(b){var c=a.call(this,b,e["default"].MANIFEST_LOADING,e["default"].MANIFEST_PARSED,e["default"].AUDIO_TRACK_LOADED,e["default"].AUDIO_TRACK_SWITCHED,e["default"].LEVEL_LOADED,e["default"].ERROR)||this;return c._trackId=-1,c._selectDefaultTrack=!0,c.tracks=[],c.trackIdBlacklist=Object.create(null),c.audioGroupId=null,c}return d(b,a),b.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},b.prototype.onManifestParsed=function(a){var b=this.tracks=a.audioTracks||[];this.hls.trigger(e["default"].AUDIO_TRACKS_UPDATED,{audioTracks:b})},b.prototype.onAudioTrackLoaded=function(a){if(a.id>=this.tracks.length)return void g.logger.warn("Invalid audio track id:",a.id);if(g.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.hasInterval()){var b=1e3*a.details.targetduration;this.setInterval(b)}!a.details.live&&this.hasInterval()&&this.clearInterval()},b.prototype.onAudioTrackSwitched=function(a){var b=this.tracks[a.id].groupId;b&&this.audioGroupId!==b&&(this.audioGroupId=b)},b.prototype.onLevelLoaded=function(a){var b=this.hls.levels[a.level];if(b.audioGroupIds){var c=b.audioGroupIds[b.urlId];this.audioGroupId!==c&&(this.audioGroupId=c,this._selectInitialAudioTrack())}},b.prototype.onError=function(a){a.type===h.ErrorTypes.NETWORK_ERROR&&(a.fatal&&this.clearInterval(),a.details===h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(g.logger.warn("Network failure on audio-track id:",a.context.id),this._handleLoadError()))},Object.defineProperty(b.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTrack",{get:function(){return this._trackId},set:function(a){this._setAudioTrack(a),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),b.prototype._setAudioTrack=function(a){if(this._trackId===a&&this.tracks[this._trackId].details)return void g.logger.debug("Same id as current audio-track passed, and track details available -> no-op");if(0>a||a>=this.tracks.length)return void g.logger.warn("Invalid id passed to audio-track controller");var b=this.tracks[a];g.logger.log("Now switching to audio-track index "+a),this.clearInterval(),this._trackId=a;var c=b.url,d=b.type,f=b.id;this.hls.trigger(e["default"].AUDIO_TRACK_SWITCHING,{id:f,type:d,url:c}),this._loadTrackDetailsIfNeeded(b)},b.prototype.doTick=function(){this._updateTrack(this._trackId)},b.prototype._selectInitialAudioTrack=function(){var a=this,b=this.tracks;if(b.length){var c=this.tracks[this._trackId],d=null;if(c&&(d=c.name),this._selectDefaultTrack){var f=b.filter(function(a){return a["default"]});f.length?b=f:g.logger.warn("No default audio tracks defined")}var i=!1,j=function(){b.forEach(function(b){i||a.audioGroupId&&b.groupId!==a.audioGroupId||d&&d!==b.name||(a._setAudioTrack(b.id),i=!0)})};j(),i||(d=null,j()),i||(g.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},b.prototype._needsTrackLoading=function(a){var b=a.details,c=a.url;return!b||b.live?!!c:!1},b.prototype._loadTrackDetailsIfNeeded=function(a){if(this._needsTrackLoading(a)){var b=a.url,c=a.id;g.logger.log("loading audio-track playlist for id: "+c),this.hls.trigger(e["default"].AUDIO_TRACK_LOADING,{url:b,id:c})}},b.prototype._updateTrack=function(a){if(!(0>a||a>=this.tracks.length)){this.clearInterval(),this._trackId=a,g.logger.log("trying to update audio-track "+a);var b=this.tracks[a];this._loadTrackDetailsIfNeeded(b)}},b.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var a=this._trackId,b=this.tracks[a],c=b.name,d=b.language,e=b.groupId;g.logger.warn("Loading failed on audio track id: "+a+", group-id: "+e+', name/language: "'+c+'" / "'+d+'"');for(var f=a,h=0;h<this.tracks.length;h++)if(!this.trackIdBlacklist[h]){var i=this.tracks[h];if(i.name===c){f=h;break}}return f===a?void g.logger.warn('No fallback audio-track found for name/language: "'+c+'" / "'+d+'"'):(g.logger.log("Attempting audio-track fallback id:",f,"group-id:",this.tracks[f].groupId),void this._setAudioTrack(f))},b}(f["default"]);b["default"]=i},"./src/controller/base-stream-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/task-loop.js"),f=c("./src/controller/fragment-tracker.js"),g=c("./src/utils/buffer-helper.js"),h=c("./src/utils/logger.js");b.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var i=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return d(e,c),e.prototype.doTick=function(){},e.prototype.startLoad=function(){},e.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragmentTracker.removeFragment(a)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.State.STOPPED},e.prototype._streamEnded=function(a,b){var c=this,d=c.fragCurrent,e=c.fragmentTracker;if(!b.live&&d&&!d.backtracked&&d.sn===b.endSN&&!a.nextStart){var g=e.getState(d);return g===f.FragmentState.PARTIAL||g===f.FragmentState.OK}return!1},e.prototype.onMediaSeeking=function(){var c=this,d=c.config,e=c.media,f=c.mediaBuffer,i=c.state,j=e?e.currentTime:null,k=g.BufferHelper.bufferInfo(f||e,j,this.config.maxBufferHole);if(a.isFinite(j)&&h.logger.log("media seeking to "+j.toFixed(3)),i===b.State.FRAG_LOADING){var l=this.fragCurrent;if(0===k.len&&l){var m=d.maxFragLookUpTolerance,n=l.start-m,o=l.start+l.duration+m;n>j||j>o?(l.loader&&(h.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),l.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=b.State.IDLE):h.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else i===b.State.ENDED&&(0===k.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=b.State.IDLE);e&&(this.lastCurrentTime=j),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=j),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onHandlerDestroying=function(){this.stopLoad(),c.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=b.State.STOPPED,this.fragmentTracker=null},e}(e["default"]);b["default"]=i}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/utils/logger.js"),h=c("./src/errors.js"),i=c("./src/utils/mediasource-helper.js"),j=i.getMediaSource(),k=function(b){function c(a){var c=b.call(this,a,e["default"].MEDIA_ATTACHING,e["default"].MEDIA_DETACHING,e["default"].MANIFEST_PARSED,e["default"].BUFFER_RESET,e["default"].BUFFER_APPENDING,e["default"].BUFFER_CODECS,e["default"].BUFFER_EOS,e["default"].BUFFER_FLUSHING,e["default"].LEVEL_PTS_UPDATED,e["default"].LEVEL_UPDATED)||this;return c._msDuration=null,c._levelDuration=null,c._levelTargetDuration=10,c._live=null,c._objectUrl=null,c.bufferCodecEventsExpected=0,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return d(c,b),c.prototype.destroy=function(){f["default"].prototype.destroy.call(this)},c.prototype.onLevelPtsUpdated=function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start);if(e>.1){var f=d.updating;try{d.abort()}catch(h){g.logger.warn("can not abort audio buffer: "+h)}f?this.audioTimestampOffset=a.start:(g.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}},c.prototype.onManifestParsed=function(a){this.bufferCodecEventsExpected=a.altAudio?2:1,g.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.prototype.onMediaAttaching=function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new j;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=window.URL.createObjectURL(c),this._objectUrl=b.src}},c.prototype.onMediaDetaching=function(){g.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(b){g.logger.warn("onMediaDetaching:"+b.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):g.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(e["default"].MEDIA_DETACHED)},c.prototype.onMediaSourceOpen=function(){g.logger.log("media source opened"),this.hls.trigger(e["default"].MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},c.prototype.checkPendingTracks=function(){var a=this,b=a.bufferCodecEventsExpected,c=a.pendingTracks,d=Object.keys(c).length;(d&&!b||2===d)&&(this.createSourceBuffers(c),this.pendingTracks={},this.doAppending())},c.prototype.onMediaSourceClose=function(){g.logger.log("media source closed")},c.prototype.onMediaSourceEnded=function(){g.logger.log("media source ended")},c.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;g.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0),d={},f=this.sourceBuffer;for(var h in f)d[h]=f[h].buffered;this.hls.trigger(e["default"].BUFFER_APPENDED,{parent:b,pending:c,timeRanges:d}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===c&&this.flushLiveBackBuffer()},c.prototype.onSBUpdateError=function(a){g.logger.error("sourceBuffer error:",a),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},c.prototype.onBufferReset=function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(d){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},c.prototype.onBufferCodecs=function(a){var b=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(a).forEach(function(c){b.pendingTracks[c]=a[c]});var c=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),c&&"open"===c.readyState&&this.checkPendingTracks()}},c.prototype.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var f=a[d],i=f.levelCodec||f.codec,j=f.container+";codecs="+i;g.logger.log("creating sourceBuffer("+j+")");try{var k=b[d]=c.addSourceBuffer(j);k.addEventListener("updateend",this.onsbue),k.addEventListener("error",this.onsbe),this.tracks[d]={codec:i,container:f.container},f.buffer=k}catch(l){g.logger.error("error while trying to add sourceBuffer:"+l.message),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:l,mimeType:j})}}this.hls.trigger(e["default"].BUFFER_CREATED,{tracks:a})},c.prototype.onBufferAppending=function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())},c.prototype.onBufferAppendFail=function(a){g.logger.error("sourceBuffer error:",a.event),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},c.prototype.onBufferEos=function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,g.logger.log(d+" sourceBuffer now EOS"));this.checkEos()},c.prototype.checkEos=function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}g.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(e){g.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},c.prototype.onBufferFlushing=function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()},c.prototype.flushLiveBackBuffer=function(){if(this._live){var a=this.hls.config.liveBackBufferLength;if(isFinite(a)&&!(0>a))for(var b=this.media.currentTime,c=this.sourceBuffer,d=Object.keys(c),e=b-Math.max(a,this._levelTargetDuration),f=d.length-1;f>=0;f--){var g=d[f],h=c[g].buffered;h.length>0&&e>h.start(0)&&this.removeBufferRange(g,c[g],0,e)}}},c.prototype.onLevelUpdated=function(a){var b=a.details;b.fragments.length>0&&(this._levelDuration=b.totalduration+b.fragments[0].start,this._levelTargetDuration=b.averagetargetduration||b.targetduration||10,this._live=b.live,this.updateMediaElementDuration())},c.prototype.updateMediaElementDuration=function(){var b,c=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var d in this.sourceBuffer)if(this.sourceBuffer[d].updating===!0)return;b=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),this._live===!0&&c.liveDurationInfinity===!0?(g.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>b||!a.isFinite(b))&&(g.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},c.prototype.doFlush=function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(f){g.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(e["default"].BUFFER_FLUSHED)}},c.prototype.doAppending=function(){var a=this,b=a.hls,c=a.segments,d=a.sourceBuffer;if(Object.keys(d).length){if(this.media.error)return this.segments=[],void g.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var f=c.shift();try{var i=f.type,j=d[i];j?j.updating?c.unshift(f):(j.ended=!1,this.parent=f.parent,j.appendBuffer(f.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(k){g.logger.error("error while trying to append buffer:"+k.message),c.unshift(f);var l={type:h.ErrorTypes.MEDIA_ERROR,parent:f.parent};22!==k.code?(this.appendError?this.appendError++:this.appendError=1,l.details=h.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>b.config.appendErrorMaxRetry?(g.logger.log("fail "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],l.fatal=!0,b.trigger(e["default"].ERROR,l)):(l.fatal=!1,b.trigger(e["default"].ERROR,l))):(this.segments=[],l.details=h.ErrorDetails.BUFFER_FULL_ERROR,l.fatal=!1,b.trigger(e["default"].ERROR,l))}}}},c.prototype.flushBuffer=function(a,b,c){var d,e=this.sourceBuffer;if(Object.keys(e).length){if(g.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var f in e)if(!c||f===c){if(d=e[f],d.ended=!1,d.updating)return g.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(f,d,a,b))return this.flushBufferCounter++,!1}}else g.logger.warn("abort flushing too many retries");g.logger.log("buffer flushed")}return!0},c.prototype.removeBufferRange=function(a,b,c,d){try{for(var e=0;e<b.buffered.length;e++){var f=b.buffered.start(e),h=b.buffered.end(e),i=Math.max(f,c),j=Math.min(h,d);if(Math.min(j,h)-i>.5)return g.logger.log("sb remove "+a+" ["+i+","+j+"], of ["+f+","+h+"], pos:"+this.media.currentTime),b.remove(i,j),!0}}catch(k){g.logger.warn("removeBufferRange failed",k)}return!1},c}(f["default"]);b["default"]=k}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=function(b){function c(c){var d=b.call(this,c,e["default"].FPS_DROP_LEVEL_CAPPING,e["default"].MEDIA_ATTACHING,e["default"].MANIFEST_PARSED,e["default"].BUFFER_CODECS,e["default"].MEDIA_DETACHING)||this;return d.autoLevelCapping=a.POSITIVE_INFINITY,d.firstLevel=null,d.levels=[],d.media=null,d.restrictedLevels=[],d.timer=null,d}return d(c,b),c.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},c.prototype.onFpsDropLevelCapping=function(a){c.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)},c.prototype.onMediaAttaching=function(a){this.media=a.media instanceof window.HTMLVideoElement?a.media:null},c.prototype.onManifestParsed=function(a){var b=this.hls;this.restrictedLevels=[],this.levels=a.levels,this.firstLevel=a.firstLevel,b.config.capLevelToPlayerSize&&a.video&&this._startCapping()},c.prototype.onBufferCodecs=function(a){var b=this.hls;b.config.capLevelToPlayerSize&&a.video&&this._startCapping()},c.prototype.onLevelsUpdated=function(a){this.levels=a.levels},c.prototype.onMediaDetaching=function(){this._stopCapping()},c.prototype.detectPlayerSize=function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},c.prototype.getMaxLevel=function(a){var b=this;if(!this.levels)return-1;var d=this.levels.filter(function(d,e){return c.isLevelAllowed(e,b.restrictedLevels)&&a>=e});return c.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},c.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=a.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},c.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=a.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(c.prototype,"mediaWidth",{get:function(){var a,b=this.media;return b&&(a=b.width||b.clientWidth||b.offsetWidth,a*=c.contentScaleFactor),a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"mediaHeight",{get:function(){var a,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight,a*=c.contentScaleFactor),a},enumerable:!0,configurable:!0}),Object.defineProperty(c,"contentScaleFactor",{get:function(){var a=1;try{a=window.devicePixelRatio}catch(b){}return a},enumerable:!0,configurable:!0}),c.isLevelAllowed=function(a,b){return void 0===b&&(b=[]),-1===b.indexOf(a)},c.getMaxLevelByMediaSize=function(a,b,c){if(!a||a&&!a.length)return-1;for(var d=function(a,b){return b?a.width!==b.width||a.height!==b.height:!0},e=a.length-1,f=0;f<a.length;f+=1){var g=a[f];if((g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}}return e},c}(f["default"]);b["default"]=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/event-handler.js"),f=c("./src/events.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=window.XMLHttpRequest,j=3,k={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},l=function(a,b,c){var d={videoCapabilities:[]};return b.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"'})}),[d]},m=function(a,b,c){switch(a){case k.WIDEVINE:return l(b,c);default:throw Error("Unknown key-system: "+a)}},n=function(a){function b(b){var c=a.call(this,b,f["default"].MEDIA_ATTACHED,f["default"].MANIFEST_PARSED)||this;return c._widevineLicenseUrl=b.config.widevineLicenseUrl,c._licenseXhrSetup=b.config.licenseXhrSetup,c._emeEnabled=b.config.emeEnabled,c._requestMediaKeySystemAccess=b.config.requestMediaKeySystemAccessFunc,c._mediaKeysList=[],c._media=null,c._hasSetMediaKeys=!1,c._isMediaEncrypted=!1,c._requestLicenseFailureCount=0,c}return d(b,a),b.prototype.getLicenseServerUrl=function(a){var b;switch(a){case k.WIDEVINE:b=this._widevineLicenseUrl;break;default:b=null}return b||(h.logger.error('No license server URL configured for key-system "'+a+'"'),this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),b},b.prototype._attemptKeySystemAccess=function(a,b,c){var d=this,e=m(a,b,c);return e?(h.logger.log("Requesting encrypted media key-system access"),void this.requestMediaKeySystemAccess(a,e).then(function(b){d._onMediaKeySystemAccessObtained(a,b)})["catch"](function(b){h.logger.error('Failed to obtain key-system "'+a+'" access:',b)})):void h.logger.warn("Can not create config for key-system (maybe because platform is not supported):",a)},Object.defineProperty(b.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),b.prototype._onMediaKeySystemAccessObtained=function(a,b){var c=this;h.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:b,mediaKeySystemDomain:a};this._mediaKeysList.push(d),b.createMediaKeys().then(function(b){d.mediaKeys=b,h.logger.log('Media-keys created for key-system "'+a+'"'),c._onMediaKeysCreated()})["catch"](function(a){h.logger.error("Failed to create media-keys:",a)})},b.prototype._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),a._onNewMediaKeySession(b.mediaKeysSession))})},b.prototype._onNewMediaKeySession=function(a){var b=this;h.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)},b.prototype._onKeySessionMessage=function(a,b){h.logger.log("Got EME message event, creating license request"),this._requestLicense(b,function(b){h.logger.log("Received license data, updating key-session"),a.update(b)})},b.prototype._onMediaEncrypted=function(a,b){h.logger.log('Media is encrypted using "'+a+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=a,this._mediaEncryptionInitData=b,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},b.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var a=this._mediaKeysList[0];if(!a||!a.mediaKeys)return h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});h.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(a.mediaKeys),this._hasSetMediaKeys=!0}},b.prototype._generateRequestWithPreferredKeySession=function(){var a=this,b=this._mediaKeysList[0];if(!b)return h.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(b.mediaKeysSessionInitialized)return void h.logger.warn("Key-Session already initialized but requested again");
var c=b.mediaKeysSession;c||(h.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var d=this._mediaEncryptionInitDataType,e=this._mediaEncryptionInitData;h.logger.log('Generating key-session request for "'+d+'" init data type'),b.mediaKeysSessionInitialized=!0,c.generateRequest(d,e).then(function(){h.logger.debug("Key-session generation succeeded")})["catch"](function(b){h.logger.error("Error generating key-session request:",b),a.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},b.prototype._createLicenseXhr=function(a,b,c){var d=new i,e=this._licenseXhrSetup;try{if(e)try{e(d,a)}catch(j){d.open("POST",a,!0),e(d,a)}d.readyState||d.open("POST",a,!0)}catch(j){return h.logger.error("Error setting up key-system license XHR",j),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return d.responseType="arraybuffer",d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,a,b,c),d},b.prototype._onLicenseRequestReadyStageChange=function(a,b,c,d){switch(a.readyState){case 4:if(200===a.status)this._requestLicenseFailureCount=0,h.logger.log("License request succeeded"),d(a.response);else{if(h.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=j){var e=j-this._requestLicenseFailureCount+1;return h.logger.warn("Retrying license request, "+e+" attempts left"),void this._requestLicense(c,d)}this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},b.prototype._generateLicenseRequestChallenge=function(a,b){var c;return a.mediaKeySystemDomain===k.PLAYREADY?h.logger.error("PlayReady is not supported (yet)"):a.mediaKeySystemDomain===k.WIDEVINE?c=b:h.logger.error("Unsupported key-system:",a.mediaKeySystemDomain),c},b.prototype._requestLicense=function(a,b){h.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c)return h.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var d=this.getLicenseServerUrl(c.mediaKeySystemDomain),e=this._createLicenseXhr(d,a,b);h.logger.log("Sending license request to URL: "+d),e.send(this._generateLicenseRequestChallenge(c,a))},b.prototype.onMediaAttached=function(a){var b=this;if(this._emeEnabled){var c=a.media;this._media=c,c.addEventListener("encrypted",function(a){b._onMediaEncrypted(a.initDataType,a.initData)})}},b.prototype.onManifestParsed=function(a){if(this._emeEnabled){var b=a.levels.map(function(a){return a.audioCodec}),c=a.levels.map(function(a){return a.videoCodec});this._attemptKeySystemAccess(k.WIDEVINE,b,c)}},b}(e["default"]);b["default"]=n},"./src/controller/fps-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/utils/logger.js"),h=window.performance,i=function(a){function b(b){return a.call(this,b,e["default"].MEDIA_ATTACHING)||this}return d(b,a),b.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},b.prototype.onMediaAttaching=function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){var c=this.video=a.media instanceof window.HTMLVideoElement?a.media:null;"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},b.prototype.checkFPS=function(a,b,c){var d=h.now();if(b){if(this.lastTime){var f=d-this.lastTime,i=c-this.lastDroppedFrames,j=b-this.lastDecodedFrames,k=1e3*i/f,l=this.hls;if(l.trigger(e["default"].FPS_DROP,{currentDropped:i,currentDecoded:j,totalDroppedFrames:c}),k>0&&i>l.config.fpsDroppedMonitoringThreshold*j){var m=l.currentLevel;g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=m)&&(m-=1,l.trigger(e["default"].FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:l.currentLevel}),l.autoLevelCapping=m,l.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.prototype.checkFPSInterval=function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)},b}(f["default"]);b["default"]=i},"./src/controller/fragment-finders.js":function(a,b,c){"use strict";(function(a){function d(b,c,d){if(!Array.isArray(b)||!b.length||!a.isFinite(c))return null;if(c<b[0].programDateTime)return null;if(c>=b[b.length-1].endProgramDateTime)return null;d=d||0;for(var e=0;e<b.length;++e){var f=b[e];if(g(c,d,f))return f}return null}function e(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0);var e=a?b[a.sn-b[0].sn+1]:null;return e&&!f(c,d,e)?e:h["default"].search(b,f.bind(null,c,d))}function f(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0);var d=Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-d<=a?1:c.start-d>a&&c.start?-1:0}function g(a,b,c){var d=1e3*Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.endProgramDateTime-d>a}Object.defineProperty(b,"__esModule",{value:!0});var h=c("./src/utils/binary-search.js");b.findFragmentByPDT=d,b.findFragmentByPTS=e,b.fragmentWithinToleranceTest=f,b.pdtWithinToleranceTest=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/event-handler.js"),f=c("./src/events.js");b.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var g=function(c){function g(a){var b=c.call(this,a,f["default"].BUFFER_APPENDED,f["default"].FRAG_BUFFERED,f["default"].FRAG_LOADED)||this;return b.bufferPadding=.2,b.fragments=Object.create(null),b.timeRanges=Object.create(null),b.config=a.config,b}return d(g,c),g.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,e["default"].prototype.destroy.call(this),c.prototype.destroy.call(this)},g.prototype.getBufferedFrag=function(a,b){var c=this.fragments,d=Object.keys(c).filter(function(d){var e=c[d];if(e.body.type!==b)return!1;if(!e.buffered)return!1;var f=e.body;return f.startPTS<=a&&a<=f.endPTS});if(0===d.length)return null;var e=d.pop();return c[e].body},g.prototype.detectEvictedFragments=function(a,b){var c,d,e=this;Object.keys(this.fragments).forEach(function(f){var g=e.fragments[f];if(g.buffered===!0){var h=g.range[a];if(h){c=h.time;for(var i=0;i<c.length;i++)if(d=c[i],e.isTimeBuffered(d.startPTS,d.endPTS,b)===!1){e.removeFragment(g.body);break}}}})},g.prototype.detectPartialFragments=function(a){var b=this,c=this.getFragmentKey(a),d=this.fragments[c];d&&(d.buffered=!0,Object.keys(this.timeRanges).forEach(function(c){if(a.hasElementaryStream(c)){var e=b.timeRanges[c];d.range[c]=b.getBufferedTimes(a.startPTS,a.endPTS,e)}}))},g.prototype.getBufferedTimes=function(a,b,c){for(var d,e,f=[],g=!1,h=0;h<c.length;h++){if(d=c.start(h)-this.bufferPadding,e=c.end(h)+this.bufferPadding,a>=d&&e>=b){f.push({startPTS:Math.max(a,c.start(h)),endPTS:Math.min(b,c.end(h))});break}if(e>a&&b>d)f.push({startPTS:Math.max(a,c.start(h)),endPTS:Math.min(b,c.end(h))}),g=!0;else if(d>=b)break}return{time:f,partial:g}},g.prototype.getFragmentKey=function(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn},g.prototype.getPartialFragment=function(a){var b,c,d,e=this,f=null,g=0;return Object.keys(this.fragments).forEach(function(h){var i=e.fragments[h];e.isPartial(i)&&(c=i.body.startPTS-e.bufferPadding,d=i.body.endPTS+e.bufferPadding,a>=c&&d>=a&&(b=Math.min(a-c,d-a),b>=g&&(f=i.body,g=b)))}),f},g.prototype.getState=function(a){var c=this.getFragmentKey(a),d=this.fragments[c],e=b.FragmentState.NOT_LOADED;return void 0!==d&&(e=d.buffered?this.isPartial(d)===!0?b.FragmentState.PARTIAL:b.FragmentState.OK:b.FragmentState.APPENDING),e},g.prototype.isPartial=function(a){return a.buffered===!0&&(void 0!==a.range.video&&a.range.video.partial===!0||void 0!==a.range.audio&&a.range.audio.partial===!0)},g.prototype.isTimeBuffered=function(a,b,c){for(var d,e,f=0;f<c.length;f++){if(d=c.start(f)-this.bufferPadding,e=c.end(f)+this.bufferPadding,a>=d&&e>=b)return!0;if(d>=b)return!1}return!1},g.prototype.onFragLoaded=function(b){var c=b.frag;a.isFinite(c.sn)&&!c.bitrateTest&&(this.fragments[this.getFragmentKey(c)]={body:c,range:Object.create(null),buffered:!1})},g.prototype.onBufferAppended=function(a){var b=this;this.timeRanges=a.timeRanges,Object.keys(this.timeRanges).forEach(function(a){var c=b.timeRanges[a];b.detectEvictedFragments(a,c)})},g.prototype.onFragBuffered=function(a){this.detectPartialFragments(a.frag)},g.prototype.hasFragment=function(a){var b=this.getFragmentKey(a);return void 0!==this.fragments[b]},g.prototype.removeFragment=function(a){var b=this.getFragmentKey(a);delete this.fragments[b]},g.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},g}(e["default"]);b.FragmentTracker=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/buffer-helper.js"),e=c("./src/errors.js"),f=c("./src/events.js"),g=c("./src/utils/logger.js"),h=1e3,i=.5,j=function(){function a(a,b,c,d){this.config=a,this.media=b,this.fragmentTracker=c,this.hls=d,this.stallReported=!1}return a.prototype.poll=function(a,b){var c=this,e=c.config,f=c.media,i=f.currentTime,j=window.performance.now();if(i!==a)return this.stallReported&&(g.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(j-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(f.ended||!f.buffered.length||f.readyState>2||f.seeking&&d.BufferHelper.isBuffered(f,i))){var k=j-this.stalled,l=d.BufferHelper.bufferInfo(f,i,e.maxBufferHole);if(!this.stalled)return void(this.stalled=j);k>=h&&this._reportStall(l.len),this._tryFixBufferStall(l,k)}},a.prototype._tryFixBufferStall=function(a,b){var c=this,d=c.config,e=c.fragmentTracker,f=c.media,g=f.currentTime,h=e.getPartialFragment(g);h&&this._trySkipBufferHole(h),a.len>i&&b>1e3*d.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},a.prototype._reportStall=function(a){var b=this,c=b.hls,d=b.media,h=b.stallReported;h||(this.stallReported=!0,g.logger.warn("Playback stalling at @"+d.currentTime+" due to low buffer"),c.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},a.prototype._trySkipBufferHole=function(a){for(var b=this,c=b.hls,d=b.media,h=d.currentTime,i=0,j=0;j<d.buffered.length;j++){var k=d.buffered.start(j);if(h>=i&&k>h)return d.currentTime=Math.max(k,d.currentTime+.1),g.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+d.currentTime),this.stalled=null,void c.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+d.currentTime,frag:a});i=d.buffered.end(j)}},a.prototype._tryNudgeBuffer=function(){var a=this,b=a.config,c=a.hls,d=a.media,h=d.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<b.nudgeMaxRetry){var j=h+i*b.nudgeOffset;g.logger.log("adjust currentTime from "+h+" to "+j),d.currentTime=j,c.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else g.logger.error("still stuck in high buffer @"+h+" after "+b.nudgeMaxRetry+", raise fatal error"),c.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},a}();b["default"]=j},"./src/controller/id3-track-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/demux/id3.js"),h=c("./src/utils/texttrack-utils.js"),i=function(a){function b(b){var c=a.call(this,b,e["default"].MEDIA_ATTACHED,e["default"].MEDIA_DETACHING,e["default"].FRAG_PARSING_METADATA)||this;return c.id3Track=void 0,c.media=void 0,c}return d(b,a),b.prototype.destroy=function(){f["default"].prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){this.media=a.media,!this.media},b.prototype.onMediaDetaching=function(){h.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},b.prototype.getID3Track=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("metadata"===c.kind&&"id3"===c.label)return h.sendAddTrackEvent(c,this.media),c}return this.media.addTextTrack("metadata","id3")},b.prototype.onFragParsingMetadata=function(a){var b=a.frag,c=a.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<c.length;e++){var f=g["default"].getID3Frames(c[e].data);if(f){var h=c[e].pts,i=e<c.length-1?c[e+1].pts:b.endPTS;h===i&&(i+=1e-4);for(var j=0;j<f.length;j++){var k=f[j];if(!g["default"].isTimeStampFrame(k)){var l=new d(h,i,"");l.value=k,this.id3Track.addCue(l)}}}}},b}(f["default"]);b["default"]=i},"./src/controller/level-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c("./src/events.js"),g=c("./src/event-handler.js"),h=c("./src/utils/logger.js"),i=c("./src/errors.js"),j=c("./src/utils/codecs.js"),k=c("./src/controller/level-helper.js"),l=(window.performance,function(a){function b(b){var c=a.call(this,b,f["default"].MANIFEST_LOADED,f["default"].LEVEL_LOADED,f["default"].AUDIO_TRACK_SWITCHED,f["default"].FRAG_LOADED,f["default"].ERROR)||this;return c.canload=!1,c.currentLevelIndex=null,c.manualLevelIndex=-1,c.timer=null,e=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c}return d(b,a),b.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},b.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.startLoad=function(){var a=this._levels;this.canload=!0,this.levelRetryCount=0,a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),null!==this.timer&&this.loadLevel()},b.prototype.stopLoad=function(){this.canload=!1},b.prototype.onManifestLoaded=function(a){var b,c=[],d=[],g={},l=null,m=!1,n=!1;if(a.levels.forEach(function(a){var b=a.attrs;a.loadError=0,a.fragmentError=!1,m=m||!!a.videoCodec,n=n||!!a.audioCodec,e&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),l=g[a.bitrate],l?l.url.push(a.url):(a.url=[a.url],a.urlId=0,g[a.bitrate]=a,c.push(a)),b&&(b.AUDIO&&(n=!0,k.addGroupId(l||a,"audio",b.AUDIO)),b.SUBTITLES&&k.addGroupId(l||a,"text",b.SUBTITLES))}),m&&n&&(c=c.filter(function(a){var b=a.videoCodec;return!!b})),c=c.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||j.isCodecSupportedInMp4(b,"audio"))&&(!c||j.isCodecSupportedInMp4(c,"video"))}),a.audioTracks&&(d=a.audioTracks.filter(function(a){return!a.audioCodec||j.isCodecSupportedInMp4(a.audioCodec,"audio")}),d.forEach(function(a,b){a.id=b})),c.length>0){b=c[0].bitrate,c.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=c;for(var o=0;o<c.length;o++)if(c[o].bitrate===b){this._firstLevel=o,h.logger.log("manifest loaded,"+c.length+" level(s) found, first bitrate:"+b);break}this.hls.trigger(f["default"].MANIFEST_PARSED,{levels:c,audioTracks:d,firstLevel:this._firstLevel,stats:a.stats,audio:n,video:m,altAudio:d.some(function(a){return!!a.url})})}else this.hls.trigger(f["default"].ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(b.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(a){var b=this._levels;b&&(a=Math.min(a,b.length-1),this.currentLevelIndex===a&&b[a].details||this.setLevelInternal(a))},enumerable:!0,configurable:!0}),b.prototype.setLevelInternal=function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.clearTimer(),this.currentLevelIndex!==a){h.logger.log("switching to level "+a),this.currentLevelIndex=a;var d=b[a];d.level=a,c.trigger(f["default"].LEVEL_SWITCHING,d)}var e=b[a],g=e.details;if(!g||g.live){var j=e.urlId;c.trigger(f["default"].LEVEL_LOADING,{url:e.url[j],level:a,id:j})}}else c.trigger(f["default"].ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(b.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(a){this._firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a},enumerable:!0,configurable:!0}),b.prototype.onError=function(a){if(a.fatal)return void(a.type===i.ErrorTypes.NETWORK_ERROR&&this.clearTimer());var b,c=!1,d=!1;switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:b=a.frag.level,d=!0;break;case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:b=a.context.level,c=!0;break;case i.ErrorDetails.REMUX_ALLOC_ERROR:b=a.level,c=!0}void 0!==b&&this.recoverLevel(a,b,c,d)},b.prototype.recoverLevel=function(a,b,c,d){var e,f,g,i=this,j=this.hls.config,k=a.details,l=this._levels[b];if(l.loadError++,l.fragmentError=d,c){if(!(this.levelRetryCount+1<=j.levelLoadingMaxRetry))return h.logger.error("level controller, cannot recover from "+k+" error"),this.currentLevelIndex=null,this.clearTimer(),void(a.fatal=!0);f=Math.min(Math.pow(2,this.levelRetryCount)*j.levelLoadingRetryDelay,j.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return i.loadLevel()},f),a.levelRetry=!0,this.levelRetryCount++,h.logger.warn("level controller, "+k+", retry in "+f+" ms, current retry count is "+this.levelRetryCount)}(c||d)&&(e=l.url.length,e>1&&l.loadError<e?(l.urlId=(l.urlId+1)%e,l.details=void 0,h.logger.warn("level controller, "+k+" for level "+b+": switching to redundant URL-id "+l.urlId)):-1===this.manualLevelIndex?(g=0===b?this._levels.length-1:b-1,h.logger.warn("level controller, "+k+": switch to "+g),this.hls.nextAutoLevel=this.currentLevelIndex=g):d&&(h.logger.warn("level controller, "+k+": reload a fragment"),this.currentLevelIndex=null))},b.prototype.onFragLoaded=function(a){var b=a.frag;if(void 0!==b&&"main"===b.type){var c=this._levels[b.level];void 0!==c&&(c.fragmentError=!1,c.loadError=0,this.levelRetryCount=0)}},b.prototype.onLevelLoaded=function(a){var b=this,c=a.level,d=a.details;if(c===this.currentLevelIndex){var e=this._levels[c];if(e.fragmentError||(e.loadError=0,this.levelRetryCount=0),d.live){var f=k.computeReloadInterval(e.details,d,a.stats.trequest);h.logger.log("live playlist, reload in "+Math.round(f)+" ms"),this.timer=setTimeout(function(){return b.loadLevel()},f)}else this.clearTimer()}},b.prototype.onAudioTrackSwitched=function(a){var b=this.hls.audioTracks[a.id].groupId,c=this.hls.levels[this.currentLevelIndex];if(c&&c.audioGroupIds){for(var d=-1,e=0;e<c.audioGroupIds.length;e++)if(c.audioGroupIds[e]===b){d=e;break}d!==c.urlId&&(c.urlId=d,this.startLoad())}},b.prototype.loadLevel=function(){if(h.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var a=this._levels[this.currentLevelIndex];if("object"==typeof a&&a.url.length>0){var b=this.currentLevelIndex,c=a.urlId,d=a.url[c];h.logger.log("Attempt loading level index "+b+" with URL-id "+c),this.hls.trigger(f["default"].LEVEL_LOADING,{url:d,level:b,id:c})}}},Object.defineProperty(b.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)},enumerable:!0,configurable:!0}),b}(g["default"]));b["default"]=l},"./src/controller/level-helper.js":function(a,b,c){"use strict";(function(a){function d(a,b,c){switch(b){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(c);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(c)}}function e(b,c,d){var e=b[c],f=b[d],g=f.startPTS;a.isFinite(g)?d>c?(e.duration=g-e.start,e.duration<0&&l.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!")):(f.duration=e.start-g,f.duration<0&&l.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!")):d>c?f.start=e.start+e.duration:f.start=Math.max(e.start-f.duration,0)}function f(b,c,d,f,g,h){var i=d;if(a.isFinite(c.startPTS)){var j=Math.abs(c.startPTS-d);a.isFinite(c.deltaPTS)?c.deltaPTS=Math.max(j,c.deltaPTS):c.deltaPTS=j,i=Math.max(d,c.startPTS),d=Math.min(d,c.startPTS),f=Math.max(f,c.endPTS),g=Math.min(g,c.startDTS),h=Math.max(h,c.endDTS)}var k=d-c.start;c.start=c.startPTS=d,c.maxStartPTS=i,c.endPTS=f,c.startDTS=g,c.endDTS=h,c.duration=f-d;var l=c.sn;if(!b||l<b.startSN||l>b.endSN)return 0;var m,n,o;for(m=l-b.startSN,n=b.fragments,n[m]=c,o=m;o>0;o--)e(n,o,o-1);for(o=m;o<n.length-1;o++)e(n,o,o+1);return b.PTSKnown=!0,k}function g(b,c){c.initSegment&&b.initSegment&&(c.initSegment=b.initSegment);var d,e=0;if(i(b,c,function(b,f){e=b.cc-f.cc,a.isFinite(b.startPTS)&&(f.start=f.startPTS=b.startPTS,f.endPTS=b.endPTS,f.duration=b.duration,f.backtracked=b.backtracked,f.dropped=b.dropped,d=f),c.PTSKnown=!0}),c.PTSKnown){if(e){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var g=c.fragments,h=0;h<g.length;h++)g[h].cc+=e}d?f(c,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS):j(b,c),c.PTSKnown=b.PTSKnown}}function h(a,b,c){void 0===c&&(c=0);var d=-1;i(a,b,function(a,b,c){b.start=a.start,d=c});var e=b.fragments;if(0>d)return void e.forEach(function(a){a.start+=c});for(var f=d+1;f<e.length;f++)e[f].start=e[f-1].start+e[f-1].duration}function i(a,b,c){if(a&&b)for(var d=Math.max(a.startSN,b.startSN)-b.startSN,e=Math.min(a.endSN,b.endSN)-b.startSN,f=b.startSN-a.startSN,g=d;e>=g;g++){var h=a.fragments[f+g],i=b.fragments[g];if(!h||!i)break;c(h,i,g)}}function j(a,b){var c=b.startSN-a.startSN,d=a.fragments,e=b.fragments;if(!(0>c||c>d.length))for(var f=0;f<e.length;f++)e[f].start+=d[c].start}function k(a,b,c){var d=1e3*(b.averagetargetduration?b.averagetargetduration:b.targetduration),e=d/2;return a&&b.endSN===a.endSN&&(d=e),c&&(d=Math.max(e,d-(window.performance.now()-c))),Math.round(d)}Object.defineProperty(b,"__esModule",{value:!0});var l=c("./src/utils/logger.js");b.addGroupId=d,b.updatePTS=e,b.updateFragPTSDTS=f,b.mergeDetails=g,b.mergeSubtitlePlaylists=h,b.mapFragmentIntersection=i,b.adjustSliding=j,b.computeReloadInterval=k}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/binary-search.js"),f=c("./src/utils/buffer-helper.js"),g=c("./src/demux/demuxer.js"),h=c("./src/events.js"),i=c("./src/controller/fragment-tracker.js"),j=c("./src/loader/fragment.js"),k=c("./src/loader/playlist-loader.js"),l=c("./src/controller/level-helper.js"),m=c("./src/utils/time-ranges.js"),n=c("./src/errors.js"),o=c("./src/utils/logger.js"),p=c("./src/utils/discontinuities.js"),q=c("./src/controller/fragment-finders.js"),r=c("./src/controller/gap-controller.js"),s=c("./src/controller/base-stream-controller.js"),t=100,u=function(b){function c(a,c){var d=b.call(this,a,h["default"].MEDIA_ATTACHED,h["default"].MEDIA_DETACHING,h["default"].MANIFEST_LOADING,h["default"].MANIFEST_PARSED,h["default"].LEVEL_LOADED,h["default"].KEY_LOADED,h["default"].FRAG_LOADED,h["default"].FRAG_LOAD_EMERGENCY_ABORTED,h["default"].FRAG_PARSING_INIT_SEGMENT,h["default"].FRAG_PARSING_DATA,h["default"].FRAG_PARSED,h["default"].ERROR,h["default"].AUDIO_TRACK_SWITCHING,h["default"].AUDIO_TRACK_SWITCHED,h["default"].BUFFER_CREATED,h["default"].BUFFER_APPENDED,h["default"].BUFFER_FLUSHED)||this;return d.fragmentTracker=c,d.config=a.config,d.audioCodecSwap=!1,d._state=s.State.STOPPED,d.stallReported=!1,d.gapController=null,d}return d(c,b),c.prototype.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(t),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&-1===a&&(o.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=s.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=s.State.STOPPED},c.prototype.stopLoad=function(){this.forceStartLoad=!1,b.prototype.stopLoad.call(this)},c.prototype.doTick=function(){switch(this.state){case s.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case s.State.IDLE:this._doTickIdle();break;case s.State.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=s.State.IDLE);break;case s.State.FRAG_LOADING_WAITING_RETRY:var b=window.performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(o.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=s.State.IDLE);break;case s.State.ERROR:case s.State.STOPPED:case s.State.FRAG_LOADING:case s.State.PARSING:case s.State.PARSED:case s.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},c.prototype._doTickIdle=function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&(c||!this.startFragRequested&&b.startFragPrefetch)){var d;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,g=this.levels[e];if(g){var i,j=g.bitrate;i=j?Math.max(8*b.maxBufferSize/j,b.maxBufferLength):b.maxBufferLength,i=Math.min(i,b.maxMaxBufferLength);var k=f.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),l=k.len;if(!(l>=i)){o.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+i.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var m=g.details;if(!m||m.live&&this.levelLastLoaded!==e)return void(this.state=s.State.WAITING_LEVEL);if(this._streamEnded(k,m)){var n={};return this.altAudio&&(n.type="video"),this.hls.trigger(h["default"].BUFFER_EOS,n),void(this.state=s.State.ENDED)}this._fetchPayloadOrEos(d,k,m)}}}},c.prototype._fetchPayloadOrEos=function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h,i=f[0].start,j=f[g-1].start+f[g-1].duration,k=b.end;if(c.initSegment&&!c.initSegment.data)h=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(l>g)return void o.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(h=this._ensureFragmentAtLivePoint(c,k,i,j,d,f,g),null===h)return}else i>k&&(h=f[0]);h||(h=this._findFragment(i,d,g,f,k,j,c)),h&&(h.encrypted?(o.logger.log("Loading key for "+h.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e),this._loadKey(h)):(o.logger.log("Loading "+h.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e+", currentTime:"+a.toFixed(3)+",bufferEnd:"+k.toFixed(3)),this._loadFragment(h)))}},c.prototype._ensureFragmentAtLivePoint=function(a,b,c,d,f,g,h){var i,j=this.hls.config,k=this.media,l=void 0!==j.liveMaxLatencyDuration?j.liveMaxLatencyDuration:j.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-j.maxFragLookUpTolerance,d-l)){var m=this.liveSyncPosition=this.computeLivePosition(c,a);o.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+m.toFixed(3)),b=m,k&&k.readyState&&k.duration>m&&(k.currentTime=m),this.nextLoadPosition=m}if(a.PTSKnown&&b>d&&k&&k.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(f)if(a.hasProgramDateTime)o.logger.log("live playlist, switching playlist, load frag with same PDT: "+f.programDateTime),i=q.findFragmentByPDT(g,f.endProgramDateTime,j.maxFragLookUpTolerance);else{var n=f.sn+1;if(n>=a.startSN&&n<=a.endSN){var p=g[n-a.startSN];f.cc===p.cc&&(i=p,o.logger.log("live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=e["default"].search(g,function(a){return f.cc-a.cc}),i&&o.logger.log("live playlist, switching playlist, load frag with same CC: "+i.sn))}i||(i=g[Math.min(h-1,Math.round(h/2))],o.logger.log("live playlist, switching playlist, unknown, load middle frag : "+i.sn))}return i},c.prototype._findFragment=function(a,b,c,d,e,f,g){var h,i=this.hls.config;if(f>e){var j=e>f-i.maxFragLookUpTolerance?0:i.maxFragLookUpTolerance;h=q.findFragmentByPTS(b,d,e,j)}else h=d[c-1];if(h){var k=h.sn-g.startSN,l=b&&h.level===b.level,m=d[k-1],n=d[k+1];if(b&&h.sn===b.sn)if(l&&!h.backtracked)if(h.sn<g.endSN){var p=b.deltaPTS;p&&p>i.maxBufferHole&&b.dropped&&k?(h=m,o.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(h=n,o.logger.log("SN just loaded, load next one: "+h.sn,h))}else h=null;else h.backtracked&&(n&&n.backtracked?(o.logger.warn("Already backtracked from fragment "+n.sn+", will not backtrack to fragment "+h.sn+". Loading fragment "+n.sn),
h=n):(o.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),h.dropped=0,m?(h=m,h.backtracked=!0):k&&(h=null)))}return h},c.prototype._loadKey=function(a){this.state=s.State.KEY_LOADING,this.hls.trigger(h["default"].KEY_LOADING,{frag:a})},c.prototype._loadFragment=function(b){var c=this.fragmentTracker.getState(b);this.fragCurrent=b,this.startFragRequested=!0,a.isFinite(b.sn)&&!b.bitrateTest&&(this.nextLoadPosition=b.start+b.duration),b.backtracked||c===i.FragmentState.NOT_LOADED||c===i.FragmentState.PARTIAL?(b.autoLevel=this.hls.autoLevelEnabled,b.bitrateTest=this.bitrateTest,this.hls.trigger(h["default"].FRAG_LOADING,{frag:b}),this.demuxer||(this.demuxer=new g["default"](this.hls,"main")),this.state=s.State.FRAG_LOADING):c===i.FragmentState.APPENDING&&this._reduceMaxBufferLength(b.duration)&&this.fragmentTracker.removeFragment(b)},Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(a){if(this.state!==a){var b=this.state;this._state=a,o.logger.log("main stream:"+b+"->"+a),this.hls.trigger(h["default"].STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},enumerable:!0,configurable:!0}),c.prototype.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,k["default"].LevelType.MAIN)},Object.defineProperty(c.prototype,"currentLevel",{get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"nextBufferedFrag",{get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null},enumerable:!0,configurable:!0}),c.prototype.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.endPTS+.5):null},Object.defineProperty(c.prototype,"nextLevel",{get:function(){var a=this.nextBufferedFrag;return a?a.level:-1},enumerable:!0,configurable:!0}),c.prototype._checkFragmentChanged=function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>this.lastCurrentTime&&(this.lastCurrentTime=b),f.BufferHelper.isBuffered(c,b)?a=this.getBufferedFrag(b):f.BufferHelper.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(h["default"].FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(h["default"].LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}},c.prototype.immediateLevelSwitch=function(){if(o.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var b=this.media,c=void 0;b?(c=b.paused,b.pause()):c=!0,this.previouslyPaused=c}var d=this.fragCurrent;d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,a.POSITIVE_INFINITY)},c.prototype.immediateLevelSwitchEnd=function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,f.BufferHelper.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())},c.prototype.nextLevelSwitch=function(){var b=this.media;if(b&&b.readyState){var c=void 0,d=void 0,e=void 0;if(d=this.getBufferedFrag(b.currentTime),d&&d.startPTS>1&&this.flushMainBuffer(0,d.startPTS-1),b.paused)c=0;else{var f=this.hls.nextLoadLevel,g=this.levels[f],h=this.fragLastKbps;c=h&&this.fragCurrent?this.fragCurrent.duration*g.bitrate/(1e3*h)+1:0}if(e=this.getBufferedFrag(b.currentTime+c),e&&(e=this.followingBufferedFrag(e))){var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(e.maxStartPTS,a.POSITIVE_INFINITY)}}},c.prototype.flushMainBuffer=function(a,b){this.state=s.State.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(h["default"].BUFFER_FLUSHING,c)},c.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition),this.gapController=new r["default"](c,b,this.fragmentTracker,this.hls)},c.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(o.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},c.prototype.onMediaSeeked=function(){var b=this.media,c=b?b.currentTime:void 0;a.isFinite(c)&&o.logger.log("media seeked to "+c.toFixed(3)),this.tick()},c.prototype.onManifestLoading=function(){o.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h["default"].BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},c.prototype.onManifestParsed=function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(-1!==b.indexOf("mp4a.40.2")&&(c=!0),-1!==b.indexOf("mp4a.40.5")&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&o.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},c.prototype.onLevelLoaded=function(b){var c=b.details,d=b.level,e=this.levels[this.levelLastLoaded],f=this.levels[d],g=c.totalduration,i=0;if(o.logger.log("level "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+g),c.live){var j=f.details;j&&c.fragments.length>0?(l.mergeDetails(j,c),i=c.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(i,j),c.PTSKnown&&a.isFinite(i)?o.logger.log("live playlist sliding:"+i.toFixed(3)):(o.logger.log("live playlist - outdated PTS, unknown sliding"),p.alignStream(this.fragPrevious,e,c))):(o.logger.log("live playlist - first load, unknown sliding"),c.PTSKnown=!1,p.alignStream(this.fragPrevious,e,c))}else c.PTSKnown=!1;if(f.details=c,this.levelLastLoaded=d,this.hls.trigger(h["default"].LEVEL_UPDATED,{details:c,level:d}),this.startFragRequested===!1){if(-1===this.startPosition||-1===this.lastCurrentTime){var k=c.startTimeOffset;a.isFinite(k)?(0>k&&(o.logger.log("negative start time offset "+k+", count from end of last fragment"),k=i+g+k),o.logger.log("start time offset found in playlist, adjust startPosition to "+k),this.startPosition=k):c.live?(this.startPosition=this.computeLivePosition(i,c),o.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===s.State.WAITING_LEVEL&&(this.state=s.State.IDLE),this.tick()},c.prototype.onKeyLoaded=function(){this.state===s.State.KEY_LOADING&&(this.state=s.State.IDLE,this.tick())},c.prototype.onFragLoaded=function(a){var b=this,c=b.fragCurrent,d=b.hls,e=b.levels,f=b.media,i=a.frag;if(this.state===s.State.FRAG_LOADING&&c&&"main"===i.type&&i.level===c.level&&i.sn===c.sn){var j=a.stats,k=e[c.level],l=k.details;if(this.bitrateTest=!1,this.stats=j,o.logger.log("Loaded "+c.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+c.level),i.bitrateTest&&d.nextLoadLevel)this.state=s.State.IDLE,this.startFragRequested=!1,j.tparsed=j.tbuffered=window.performance.now(),d.trigger(h["default"].FRAG_BUFFERED,{stats:j,frag:c,id:"main"}),this.tick();else if("initSegment"===i.sn)this.state=s.State.IDLE,j.tparsed=j.tbuffered=window.performance.now(),l.initSegment.data=a.payload,d.trigger(h["default"].FRAG_BUFFERED,{stats:j,frag:c,id:"main"}),this.tick();else{o.logger.log("Parsing "+c.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+c.level+", cc "+c.cc),this.state=s.State.PARSING,this.pendingBuffering=!0,this.appended=!1,i.bitrateTest&&(i.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:i}));var m=!(f&&f.seeking)&&(l.PTSKnown||!l.live),n=l.initSegment?l.initSegment.data:[],p=this._getAudioCodec(k),q=this.demuxer=this.demuxer||new g["default"](this.hls,"main");q.push(a.payload,n,p,k.videoCodec,c,l.totalduration,m)}}this.fragLoadError=0},c.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===s.State.PARSING){var d=a.tracks,e=void 0,f=void 0;if(d.audio&&this.altAudio&&delete d.audio,f=d.audio){var g=this.levels[this.level].audioCodec,i=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(o.logger.log("swapping playlist audio codec"),g=-1!==g.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==f.metadata.channelCount&&-1===i.indexOf("firefox")&&(g="mp4a.40.5"),-1!==i.indexOf("android")&&"audio/mpeg"!==f.container&&(g="mp4a.40.2",o.logger.log("Android: force audio codec to "+g)),f.levelCodec=g,f.id=a.id}f=d.video,f&&(f.levelCodec=this.levels[this.level].videoCodec,f.id=a.id),this.hls.trigger(h["default"].BUFFER_CODECS,d);for(e in d){f=d[e],o.logger.log("main track:"+e+",container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]");var j=f.initSegment;j&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h["default"].BUFFER_APPENDING,{type:e,data:j,parent:"main",content:"initSegment"}))}this.tick()}},c.prototype.onFragParsingData=function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"main"===b.id&&e.sn===d.sn&&e.level===d.level&&("audio"!==b.type||!this.altAudio)&&this.state===s.State.PARSING){var f=this.levels[this.level],g=d;if(a.isFinite(b.endPTS)||(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),b.hasAudio===!0&&g.addElementaryStream(j["default"].ElementaryStreamTypes.AUDIO),b.hasVideo===!0&&g.addElementaryStream(j["default"].ElementaryStreamTypes.VIDEO),o.logger.log("Parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb+",dropped:"+(b.dropped||0)),"video"===b.type)if(g.dropped=b.dropped,g.dropped)if(g.backtracked)o.logger.warn("Already backtracked on this fragment, appending with the gap",g.sn);else{var i=f.details;if(!i||g.sn!==i.startSN)return o.logger.warn("missing video frame(s), backtracking fragment",g.sn),this.fragmentTracker.removeFragment(g),g.backtracked=!0,this.nextLoadPosition=b.startPTS,this.state=s.State.IDLE,this.fragPrevious=g,void this.tick();o.logger.warn("missing video frame(s) on first frag, appending with gap",g.sn)}else g.backtracked=!1;var k=l.updateFragPTSDTS(f.details,g,b.startPTS,b.endPTS,b.startDTS,b.endDTS),m=this.hls;m.trigger(h["default"].LEVEL_PTS_UPDATED,{details:f.details,level:this.level,drift:k,type:b.type,start:b.startPTS,end:b.endPTS}),[b.data1,b.data2].forEach(function(a){a&&a.length&&c.state===s.State.PARSING&&(c.appended=!0,c.pendingBuffering=!0,m.trigger(h["default"].BUFFER_APPENDING,{type:b.type,data:a,parent:"main",content:"data"}))}),this.tick()}},c.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===s.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=s.State.PARSED,this._checkAppendedParsed())},c.prototype.onAudioTrackSwitching=function(b){var c=!!b.url,d=b.id;if(!c){if(this.mediaBuffer!==this.media){o.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var e=this.fragCurrent;e.loader&&(o.logger.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=s.State.IDLE}var f=this.hls;f.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}),f.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:d}),this.altAudio=!1}},c.prototype.onAudioTrackSwitched=function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(o.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},c.prototype.onBufferCreated=function(a){var b,c,d=a.tracks,e=!1;for(var f in d){var g=d[f];"main"===g.id?(c=f,b=g,"video"===f&&(this.videoBuffer=d[f].buffer)):e=!0}e&&b?(o.logger.log("alternate track found, use "+c+".buffered to schedule main fragment loading"),this.mediaBuffer=b.buffer):this.mediaBuffer=this.media},c.prototype.onBufferAppended=function(a){if("main"===a.parent){var b=this.state;(b===s.State.PARSING||b===s.State.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},c.prototype._checkAppendedParsed=function(){if(!(this.state!==s.State.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;o.logger.log("main buffered : "+m["default"].toString(b.buffered)),this.fragPrevious=a;var c=this.stats;c.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*c.total/(c.tbuffered-c.tfirst)),this.hls.trigger(h["default"].FRAG_BUFFERED,{stats:c,frag:a,id:"main"}),this.state=s.State.IDLE}this.tick()}},c.prototype.onError=function(b){var c=b.frag||this.fragCurrent;if(!c||"main"===c.type){var d=!!this.media&&f.BufferHelper.isBuffered(this.media,this.media.currentTime)&&f.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(b.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:if(!b.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var e=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);o.logger.warn("mediaController: frag loading failed, retry in "+e+" ms"),this.retryDate=window.performance.now()+e,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=s.State.FRAG_LOADING_WAITING_RETRY}else o.logger.error("mediaController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=s.State.ERROR;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==s.State.ERROR&&(b.fatal?(this.state=s.State.ERROR,o.logger.warn("streamController: "+b.details+",switch to "+this.state+" state ...")):b.levelRetry||this.state!==s.State.WAITING_LEVEL||(this.state=s.State.IDLE));break;case n.ErrorDetails.BUFFER_FULL_ERROR:"main"!==b.parent||this.state!==s.State.PARSING&&this.state!==s.State.PARSED||(d?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=s.State.IDLE):(o.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,a.POSITIVE_INFINITY)))}}},c.prototype._reduceMaxBufferLength=function(a){var b=this.config;return b.maxMaxBufferLength>=a?(b.maxMaxBufferLength/=2,o.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0):!1},c.prototype._checkBuffer=function(){var a=this.media;if(a&&0!==a.readyState){var b=this.mediaBuffer?this.mediaBuffer:a,c=b.buffered;!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,c)}},c.prototype.onFragLoadEmergencyAborted=function(){this.state=s.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},c.prototype.onBufferFlushed=function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;a&&this.fragmentTracker.detectEvictedFragments(j["default"].ElementaryStreamTypes.VIDEO,a.buffered),this.state=s.State.IDLE,this.fragPrevious=null},c.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},c.prototype.computeLivePosition=function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)},c.prototype._seekToStartPos=function(){var a=this.media,b=a.currentTime,c=a.seeking?b:this.startPosition;b!==c&&(o.logger.log("target start position not buffered, seek to buffered.start(0) "+c+" from current time "+b+" "),a.currentTime=c)},c.prototype._getAudioCodec=function(a){var b=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&(o.logger.log("swapping playlist audio codec"),b&&(b=-1!==b.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),b},Object.defineProperty(c.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a},enumerable:!0,configurable:!0}),c}(s["default"]);b["default"]=u}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/utils/logger.js"),g=c("./src/crypt/decrypter.js"),h=c("./src/utils/buffer-helper.js"),i=c("./src/controller/fragment-finders.js"),j=c("./src/controller/fragment-tracker.js"),k=c("./src/controller/base-stream-controller.js"),l=c("./src/controller/level-helper.js"),m=window.performance,n=500,o=function(a){function b(b,c){var d=a.call(this,b,e["default"].MEDIA_ATTACHED,e["default"].MEDIA_DETACHING,e["default"].ERROR,e["default"].KEY_LOADED,e["default"].FRAG_LOADED,e["default"].SUBTITLE_TRACKS_UPDATED,e["default"].SUBTITLE_TRACK_SWITCH,e["default"].SUBTITLE_TRACK_LOADED,e["default"].SUBTITLE_FRAG_PROCESSED,e["default"].LEVEL_UPDATED)||this;return d.fragmentTracker=c,d.config=b.config,d.state=k.State.STOPPED,d.tracks=[],d.tracksBuffered=[],d.currentTrackId=-1,d.decrypter=new g["default"](b,b.config),d.lastAVStart=0,d._onMediaSeeking=d.onMediaSeeking.bind(d),d}return d(b,a),b.prototype.onSubtitleFragProcessed=function(a){var b=a.frag,c=a.success;if(this.fragPrevious=b,this.state=k.State.IDLE,c){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var e,f=b.start,g=0;g<d.length;g++)if(f>=d[g].start&&f<=d[g].end){e=d[g];break}var h=b.start+b.duration;e?e.end=h:(e={start:f,end:h},d.push(e))}}},b.prototype.onMediaAttached=function(a){var b=a.media;this.media=b,b.addEventListener("seeking",this._onMediaSeeking),this.state=k.State.IDLE},b.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=k.State.STOPPED},b.prototype.onError=function(a){var b=a.frag;b&&"subtitle"===b.type&&(this.state=k.State.IDLE)},b.prototype.onSubtitleTracksUpdated=function(a){var b=this;f.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=a.subtitleTracks,this.tracks.forEach(function(a){b.tracksBuffered[a.id]=[]})},b.prototype.onSubtitleTrackSwitch=function(a){if(this.currentTrackId=a.id,!this.tracks||-1===this.currentTrackId)return void this.clearInterval();var b=this.tracks[this.currentTrackId];b&&b.details&&this.setInterval(n)},b.prototype.onSubtitleTrackLoaded=function(a){var b=a.id,c=a.details,d=this,e=d.currentTrackId,f=d.tracks,g=f[e];b>=f.length||b!==e||!g||(c.live&&l.mergeSubtitlePlaylists(g.details,c,this.lastAVStart),g.details=c,this.setInterval(n))},b.prototype.onKeyLoaded=function(){this.state===k.State.KEY_LOADING&&(this.state=k.State.IDLE)},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag.decryptdata,d=a.frag,f=this.hls;if(this.state===k.State.FRAG_LOADING&&b&&"subtitle"===a.frag.type&&b.sn===a.frag.sn&&a.payload.byteLength>0&&c&&c.key&&"AES-128"===c.method){var g=m.now();this.decrypter.decrypt(a.payload,c.key.buffer,c.iv.buffer,function(a){var b=m.now();f.trigger(e["default"].FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:g,tdecrypt:b}})})}},b.prototype.onLevelUpdated=function(a){var b=a.details,c=b.fragments;this.lastAVStart=c.length?c[0].start:0},b.prototype.doTick=function(){if(!this.media)return void(this.state=k.State.IDLE);switch(this.state){case k.State.IDLE:var a=this,b=a.config,c=a.currentTrackId,d=a.fragmentTracker,g=a.media,l=a.tracks;if(!l||!l[c]||!l[c].details)break;var m=b.maxBufferHole,n=b.maxFragLookUpTolerance,o=Math.min(b.maxBufferLength,b.maxMaxBufferLength),p=h.BufferHelper.bufferedInfo(this._getBuffered(),g.currentTime,m),q=p.end,r=p.len,s=l[c].details,t=s.fragments,u=t.length,v=t[u-1].start+t[u-1].duration;if(r>o)return;var w=void 0,x=this.fragPrevious;v>q?(x&&s.hasProgramDateTime&&(w=i.findFragmentByPDT(t,x.endProgramDateTime,n)),w||(w=i.findFragmentByPTS(x,t,q,n))):w=t[u-1],w&&w.encrypted?(f.logger.log("Loading key for "+w.sn),this.state=k.State.KEY_LOADING,this.hls.trigger(e["default"].KEY_LOADING,{frag:w})):w&&d.getState(w)===j.FragmentState.NOT_LOADED&&(this.fragCurrent=w,this.state=k.State.FRAG_LOADING,this.hls.trigger(e["default"].FRAG_LOADING,{frag:w}))}},b.prototype.stopLoad=function(){this.lastAVStart=0,a.prototype.stopLoad.call(this)},b.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},b.prototype.onMediaSeeking=function(){this.fragPrevious=null},b}(k["default"]);b.SubtitleStreamController=o},"./src/controller/subtitle-track-controller.js":function(a,b,c){"use strict";(function(a){function d(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"subtitles"===d.kind&&d.label&&b.push(a[c])}return b}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c("./src/events.js"),g=c("./src/event-handler.js"),h=c("./src/utils/logger.js"),i=c("./src/controller/level-helper.js"),j=function(b){function c(a){var c=b.call(this,a,f["default"].MEDIA_ATTACHED,f["default"].MEDIA_DETACHING,f["default"].MANIFEST_LOADED,f["default"].SUBTITLE_TRACK_LOADED)||this;return c.tracks=[],c.trackId=-1,c.media=null,c.stopped=!0,c.subtitleDisplay=!0,c}return e(c,b),c.prototype.destroy=function(){g["default"].prototype.destroy.call(this)},c.prototype.onMediaAttached=function(a){var b=this;this.media=a.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){b.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},c.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},c.prototype.onManifestLoaded=function(a){var b=this,c=a.subtitles||[];this.tracks=c,this.hls.trigger(f["default"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a["default"]&&(b.media?b.subtitleTrack=a.id:b.queuedDefaultTrack=a.id)})},c.prototype.onSubtitleTrackLoaded=function(a){var b=this,c=a.id,d=a.details,e=this,f=e.trackId,g=e.tracks,j=g[f];if(c>=g.length||c!==f||!j||this.stopped)return void this._clearReloadTimer();if(h.logger.log("subtitle track "+c+" loaded"),d.live){var k=i.computeReloadInterval(j.details,d,a.stats.trequest);h.logger.log("Reloading live subtitle playlist in "+k+"ms"),this.timer=setTimeout(function(){b._loadCurrentTrack()},k)}else this._clearReloadTimer()},c.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},c.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(c.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(a){this.trackId!==a&&(this._toggleTrackModes(a),this._setSubtitleTrackInternal(a))},enumerable:!0,configurable:!0}),c.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},c.prototype._loadCurrentTrack=function(){var a=this,b=a.trackId,c=a.tracks,d=a.hls,e=c[b];0>b||!e||e.details&&!e.details.live||(h.logger.log("Loading subtitle track "+b),d.trigger(f["default"].SUBTITLE_TRACK_LOADING,{url:e.url,id:b}))},c.prototype._toggleTrackModes=function(a){var b=this,c=b.media,e=b.subtitleDisplay,f=b.trackId;if(c){var g=d(c.textTracks);if(-1===a)[].slice.call(g).forEach(function(a){a.mode="disabled"});else{var h=g[f];h&&(h.mode="disabled")}var i=g[a];i&&(i.mode=e?"showing":"hidden")}},c.prototype._setSubtitleTrackInternal=function(b){var c=this,d=c.hls,e=c.tracks;!a.isFinite(b)||-1>b||b>=e.length||(this.trackId=b,h.logger.log("Switching to subtitle track "+b),d.trigger(f["default"].SUBTITLE_TRACK_SWITCH,{id:b}),this._loadCurrentTrack())},c.prototype._onTextTracksChanged=function(){if(this.media){for(var a=-1,b=d(this.media.textTracks),c=0;c<b.length;c++)if("hidden"===b[c].mode)a=c;else if("showing"===b[c].mode){a=c;break}this.subtitleTrack=a}},c}(g["default"]);b["default"]=j}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(a,b,c){"use strict";(function(a){function d(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function e(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c("./src/events.js"),h=c("./src/event-handler.js"),i=c("./src/utils/cea-608-parser.js"),j=c("./src/utils/output-filter.js"),k=c("./src/utils/webvtt-parser.js"),l=c("./src/utils/logger.js"),m=c("./src/utils/texttrack-utils.js"),n=function(b){function c(a){var c=b.call(this,a,g["default"].MEDIA_ATTACHING,g["default"].MEDIA_DETACHING,g["default"].FRAG_PARSING_USERDATA,g["default"].FRAG_DECRYPTED,g["default"].MANIFEST_LOADING,g["default"].MANIFEST_LOADED,g["default"].FRAG_LOADED,g["default"].LEVEL_SWITCHING,g["default"].INIT_PTS_FOUND)||this;if(c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.textTracks=[],c.tracks=[],c.unparsedVttFrags=[],c.initPTS=[],c.cueRanges=[],c.captionsTracks={},c.captionsProperties={textTrack1:{label:c.config.captionsTextTrack1Label,languageCode:c.config.captionsTextTrack1LanguageCode},textTrack2:{label:c.config.captionsTextTrack2Label,languageCode:c.config.captionsTextTrack2LanguageCode}},c.config.enableCEA708Captions){var d=new j["default"](c,"textTrack1"),e=new j["default"](c,"textTrack2");c.cea608Parser=new i["default"](0,d,e)}return c}return f(c,b),c.prototype.addCues=function(a,b,c,d){for(var f=this.cueRanges,g=!1,h=f.length;h--;){var i=f[h],j=e(i[0],i[1],b,c);if(j>=0&&(i[0]=Math.min(i[0],b),i[1]=Math.max(i[1],c),g=!0,j/(c-b)>.5))return}g||f.push([b,c]),this.Cues.newCue(this.captionsTracks[a],b,c,d)},c.prototype.onInitPtsFound=function(a){var b=this;if("main"===a.id&&(this.initPTS[a.frag.cc]=a.initPTS),this.unparsedVttFrags.length){var c=this.unparsedVttFrags;this.unparsedVttFrags=[],c.forEach(function(a){b.onFragLoaded(a)})}},c.prototype.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c];if(d[a])return d}return null},c.prototype.createCaptionsTrack=function(a){var b=this.captionsProperties[a],c=b.label,d=b.languageCode,e=this.captionsTracks;if(!e[a]){var f=this.getExistingTrack(a);if(f)e[a]=f,m.clearCurrentCues(e[a]),m.sendAddTrackEvent(e[a],this.media);else{var g=this.createTextTrack("captions",c,d);g&&(g[a]=!0,e[a]=g)}}},c.prototype.createTextTrack=function(a,b,c){var d=this.media;return d?d.addTextTrack(a,b,c):void 0},c.prototype.destroy=function(){h["default"].prototype.destroy.call(this)},c.prototype.onMediaAttaching=function(a){this.media=a.media,this._cleanTracks()},c.prototype.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){m.clearCurrentCues(a[b]),delete a[b]})},c.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,"new":!1}},this._cleanTracks()},c.prototype._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)m.clearCurrentCues(b[c])}},c.prototype.onManifestLoaded=function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,e){var f;if(e<c.length){for(var g=null,h=0;h<c.length;h++)if(d(c[h],a)){g=c[h];break}g&&(f=g)}f||(f=b.createTextTrack("subtitles",a.name,a.lang)),a["default"]?f.mode=b.hls.subtitleDisplay?"showing":"hidden":f.mode="disabled",b.textTracks.push(f)})}},c.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},c.prototype.onFragLoaded=function(b){var c=b.frag,d=b.payload;if("main"===c.type){var e=c.sn;if(e!==this.lastSn+1){var f=this.cea608Parser;f&&f.reset()}this.lastSn=e}else if("subtitle"===c.type)if(d.byteLength){if(!a.isFinite(this.initPTS[c.cc]))return this.unparsedVttFrags.push(b),void(this.initPTS.length&&this.hls.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c}));var h=c.decryptdata;(null==h||null==h.key||"AES-128"!==h.method)&&this._parseVTTs(c,d)}else this.hls.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c})},c.prototype._parseVTTs=function(a,b){var c=this.vttCCs;c[a.cc]||(c[a.cc]={start:a.start,prevCC:this.prevCC,"new":!0},this.prevCC=a.cc);var d=this.textTracks,e=this.hls;k["default"].parse(b,this.initPTS[a.cc],c,a.cc,function(b){var c=d[a.level];return"disabled"===c.mode?void e.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a}):(b.forEach(function(a){if(!c.cues.getCueById(a.id))try{c.addCue(a)}catch(b){var d=new window.TextTrackCue(a.startTime,a.endTime,a.text);d.id=a.id,c.addCue(d)}}),void e.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a}))},function(b){l.logger.log("Failed to parse VTT cue: "+b),e.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})})},c.prototype.onFragDecrypted=function(b){var c=b.payload,d=b.frag;if("subtitle"===d.type){if(!a.isFinite(this.initPTS[d.cc]))return void this.unparsedVttFrags.push(b);this._parseVTTs(d,c)}},c.prototype.onFragParsingUserdata=function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}},c.prototype.extractCea608Data=function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;g>j;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,(0!==c||0!==d)&&e&&0===f&&(i.push(c),i.push(d));return i},c}(h["default"]);b["default"]=n}).call(this,c("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.subtle=a,this.aesIV=b}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a);
},a}();b["default"]=d},"./src/crypt/aes-decryptor.js":function(a,b,c){"use strict";function d(a){var b=a.byteLength,c=b&&new DataView(a).getUint8(b-1);return c?a.slice(0,b-c):a}Object.defineProperty(b,"__esModule",{value:!0}),b.removePadding=d;var e=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a.prototype.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;4>d;d++)c[d]=b.getUint32(4*d);return c},a.prototype.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;256>p;p++)128>p?m[p]=p<<1:m[p]=p<<1^283;for(p=0;256>p;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},a.prototype.expandKey=function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f,g,h,i,j=this.ksRows=4*(e+6+1),k=this.keySchedule=new Uint32Array(j),l=this.invKeySchedule=new Uint32Array(j),m=this.sBox,n=this.rcon,o=this.invSubMix,p=o[0],q=o[1],r=o[2],s=o[3];for(f=0;j>f;f++)e>f?h=k[f]=b[f]:(i=h,f%e===0?(i=i<<8|i>>>24,i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i],i^=n[f/e|0]<<24):e>6&&f%e===4&&(i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i]),k[f]=h=(k[f-e]^i)>>>0);for(g=0;j>g;g++)f=j-g,i=3&g?k[f]:k[f-4],4>g||4>=f?l[g]=i:l[g]=p[m[i>>>24]]^q[m[i>>>16&255]]^r[m[i>>>8&255]]^s[m[255&i]],l[g]=l[g]>>>0}},a.prototype.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},a.prototype.decrypt=function(a,b,c,e){for(var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this.keySize+6,u=this.invKeySchedule,v=this.invSBox,w=this.invSubMix,x=w[0],y=w[1],z=w[2],A=w[3],B=this.uint8ArrayToUint32Array_(c),C=B[0],D=B[1],E=B[2],F=B[3],G=new Int32Array(a),H=new Int32Array(G.length),I=this.networkToHostOrderSwap;b<G.length;){for(n=I(G[b]),o=I(G[b+1]),p=I(G[b+2]),q=I(G[b+3]),j=n^u[0],k=q^u[1],l=p^u[2],m=o^u[3],r=4,s=1;t>s;s++)f=x[j>>>24]^y[k>>16&255]^z[l>>8&255]^A[255&m]^u[r],g=x[k>>>24]^y[l>>16&255]^z[m>>8&255]^A[255&j]^u[r+1],h=x[l>>>24]^y[m>>16&255]^z[j>>8&255]^A[255&k]^u[r+2],i=x[m>>>24]^y[j>>16&255]^z[k>>8&255]^A[255&l]^u[r+3],j=f,k=g,l=h,m=i,r+=4;f=v[j>>>24]<<24^v[k>>16&255]<<16^v[l>>8&255]<<8^v[255&m]^u[r],g=v[k>>>24]<<24^v[l>>16&255]<<16^v[m>>8&255]<<8^v[255&j]^u[r+1],h=v[l>>>24]<<24^v[m>>16&255]<<16^v[j>>8&255]<<8^v[255&k]^u[r+2],i=v[m>>>24]<<24^v[j>>16&255]<<16^v[k>>8&255]<<8^v[255&l]^u[r+3],r+=3,H[b]=I(f^C),H[b+1]=I(i^D),H[b+2]=I(h^E),H[b+3]=I(g^F),C=n,D=o,E=p,F=q,b+=4}return e?d(H.buffer):H.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a}();b["default"]=e},"./src/crypt/decrypter.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/crypt/aes-crypto.js"),e=c("./src/crypt/fast-aes-key.js"),f=c("./src/crypt/aes-decryptor.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=c("./src/events.js"),j=c("./src/utils/get-self-scope.js"),k=j.getSelfScope(),l=function(){function a(a,b,c){var d=(void 0===c?{}:c).removePKCS7Padding,e=void 0===d?!0:d;if(this.logEnabled=!0,this.observer=a,this.config=b,this.removePKCS7Padding=e,e)try{var f=k.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch(g){}this.disableWebCrypto=!this.subtle}return a.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},a.prototype.decrypt=function(a,b,c,g){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(h.logger.log("JS AES decrypt"),this.logEnabled=!1);var j=this.decryptor;j||(this.decryptor=j=new f["default"]),j.expandKey(b),g(j.decrypt(a,0,c,this.removePKCS7Padding))}else{this.logEnabled&&(h.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var k=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new e["default"](k,b)),this.fastAesKey.expandKey().then(function(e){var f=new d["default"](k,c);f.decrypt(a,e)["catch"](function(d){i.onWebCryptoError(d,a,b,c,g)}).then(function(a){g(a)})})["catch"](function(d){i.onWebCryptoError(d,a,b,c,g)})}},a.prototype.onWebCryptoError=function(a,b,c,d,e){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(h.logger.error("decrypting error : "+a.message),this.observer.trigger(i["default"].ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))},a.prototype.destroy=function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)},a}();b["default"]=l},"./src/crypt/fast-aes-key.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.subtle=a,this.key=b}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}();b["default"]=d},"./src/demux/aacdemuxer.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/adts.js"),e=c("./src/utils/logger.js"),f=c("./src/demux/id3.js"),g=function(){function b(a,b,c){this.observer=a,this.config=c,this.remuxer=b}return b.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},b.prototype.resetTimeStamp=function(){},b.probe=function(a){if(!a)return!1;for(var b=f["default"].getID3Data(a,0)||[],c=b.length,g=a.length;g>c;c++)if(d.probe(a,c))return e.logger.log("ADTS sync word found !"),!0;return!1},b.prototype.append=function(b,c,g,h){for(var i=this._audioTrack,j=f["default"].getID3Data(b,0)||[],k=f["default"].getTimeStamp(j),l=a.isFinite(k)?90*k:9e4*c,m=0,n=l,o=b.length,p=j.length,q=[{pts:n,dts:n,data:j}];o-1>p;)if(d.isHeader(b,p)&&o>p+5){d.initTrackConfig(i,this.observer,b,p,i.manifestCodec);var r=d.appendFrame(i,b,p,l,m);if(!r){e.logger.log("Unable to parse AAC frame");break}p+=r.length,n=r.sample.pts,m++}else f["default"].isHeader(b,p)?(j=f["default"].getID3Data(b,p),q.push({pts:n,dts:n,data:j}),p+=j.length):p++;this.remuxer.remux(i,{samples:[]},{samples:q,inputTimeScale:9e4},{samples:[]},c,g,h)},b.prototype.destroy=function(){},b}();b["default"]=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(a,b,c){"use strict";function d(a,b,c,d){var e,f,g,h,i,j=navigator.userAgent.toLowerCase(),k=d,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=((192&b[c+2])>>>6)+1,f=(60&b[c+2])>>>2,f>l.length-1?void a.trigger(p["default"].ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(h=(1&b[c+2])<<2,h|=(192&b[c+3])>>>6,n.logger.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+f+"["+l[f]+"Hz],channelConfig:"+h),/firefox/i.test(j)?f>=6?(e=5,i=new Array(4),g=f-3):(e=2,i=new Array(2),g=f):-1!==j.indexOf("android")?(e=2,i=new Array(2),g=f):(e=5,i=new Array(4),d&&(-1!==d.indexOf("mp4a.40.29")||-1!==d.indexOf("mp4a.40.5"))||!d&&f>=6?g=f-3:((d&&-1!==d.indexOf("mp4a.40.2")&&(f>=6&&1===h||/vivaldi/i.test(j))||!d&&1===h)&&(e=2,i=new Array(2)),g=f)),i[0]=e<<3,i[0]|=(14&f)>>1,i[1]|=(1&f)<<7,i[1]|=h<<3,5===e&&(i[1]|=(14&g)>>1,i[2]=(1&g)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:l[f],channelCount:h,codec:"mp4a.40."+e,manifestCodec:k})}function e(a,b){return 255===a[b]&&240===(246&a[b+1])}function f(a,b){return 1&a[b+1]?7:9}function g(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function h(a,b){return b+1<a.length&&e(a,b)?!0:!1}function i(a,b){if(b+1<a.length&&e(a,b)){var c=f(a,b),d=c;b+5<a.length&&(d=g(a,b));var h=b+d;if(h===a.length||h+1<a.length&&e(a,h))return!0}return!1}function j(a,b,c,e,f){if(!a.samplerate){var g=d(b,c,e,f);a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,n.logger.log("parsed codec:"+a.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)}}function k(a){return 9216e4/a}function l(a,b,c,d,e){var h,i,j,k=a.length;return h=f(a,b),i=g(a,b),i-=h,i>0&&k>=b+h+i?(j=c+d*e,{headerLength:h,frameLength:i,stamp:j}):void 0}function m(a,b,c,d,e){var f=k(a.samplerate),g=l(b,c,d,e,f);if(g){var h=g.stamp,i=g.headerLength,j=g.frameLength,m={unit:b.subarray(c+i,c+i+j),pts:h,dts:h};return a.samples.push(m),a.len+=j,{sample:m,length:j+i}}return void 0}Object.defineProperty(b,"__esModule",{value:!0});var n=c("./src/utils/logger.js"),o=c("./src/errors.js"),p=c("./src/events.js");b.getAudioConfig=d,b.isHeaderPattern=e,b.getHeaderLength=f,b.getFullFrameLength=g,b.isHeader=h,b.probe=i,b.initTrackConfig=j,b.getFrameDuration=k,b.parseFrameHeader=l,b.appendFrame=m},"./src/demux/demuxer-inline.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d,e=c("./src/events.js"),f=c("./src/errors.js"),g=c("./src/crypt/decrypter.js"),h=c("./src/demux/aacdemuxer.js"),i=c("./src/demux/mp4demuxer.js"),j=c("./src/demux/tsdemuxer.js"),k=c("./src/demux/mp3demuxer.js"),l=c("./src/remux/mp4-remuxer.js"),m=c("./src/remux/passthrough-remuxer.js"),n=c("./src/utils/get-self-scope.js"),o=c("./src/utils/logger.js"),p=n.getSelfScope();try{d=p.performance.now.bind(p.performance)}catch(q){o.logger.debug("Unable to use Performance API on this environment"),d=p.Date.now}var r=function(){function a(a,b,c,d){this.observer=a,this.typeSupported=b,this.config=c,this.vendor=d}return a.prototype.destroy=function(){var a=this.demuxer;a&&a.destroy()},a.prototype.push=function(a,b,c,f,h,i,j,k,l,m,n,o){var p=this;if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var q=this.decrypter;null==q&&(q=this.decrypter=new g["default"](this.observer,this.config));var r=d();q.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var g=d();p.observer.trigger(e["default"].FRAG_DECRYPTED,{stats:{tstart:r,tdecrypt:g}}),p.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),f,h,i,j,k,l,m,n,o)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),f,h,i,j,k,l,m,n,o)},a.prototype.pushDecrypted=function(a,b,c,d,g,n,o,p,q,r,s,t){var u=this.demuxer;if(!u||(o||p)&&!this.probe(a)){for(var v=this.observer,w=this.typeSupported,x=this.config,y=[{demux:j["default"],remux:l["default"]},{demux:i["default"],remux:m["default"]},{demux:h["default"],remux:l["default"]},{demux:k["default"],remux:l["default"]}],z=0,A=y.length;A>z;z++){var B=y[z],C=B.demux.probe;if(C(a)){var D=this.remuxer=new B.remux(v,x,w,this.vendor);u=new B.demux(v,D,x,w),this.probe=C;break}}if(!u)return void v.trigger(e["default"].ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=u}var E=this.remuxer;(o||p)&&(u.resetInitSegment(c,d,g,r),E.resetInitSegment()),o&&(u.resetTimeStamp(t),E.resetTimeStamp(t)),"function"==typeof u.setDecryptData&&u.setDecryptData(b),u.append(a,n,q,s)},a}();b["default"]=r},"./src/demux/demuxer-worker.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/demuxer-inline.js"),e=c("./src/events.js"),f=c("./src/utils/logger.js"),g=c("./node_modules/node-libs-browser/node_modules/events/events.js"),h=function(a){var b=new g.EventEmitter;b.trigger=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];b.emit.apply(b,[a,a].concat(c))},b.off=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];b.removeListener.apply(b,[a].concat(c))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(e){var g=e.data;switch(g.cmd){case"init":var h=JSON.parse(g.config);a.demuxer=new d["default"](b,g.typeSupported,h,g.vendor),f.enableLogs(h.debug),c("init",null);break;case"demux":a.demuxer.push(g.data,g.decryptdata,g.initSegment,g.audioCodec,g.videoCodec,g.timeOffset,g.discontinuity,g.trackSwitch,g.contiguous,g.duration,g.accurateTimeOffset,g.defaultInitPTS)}}),b.on(e["default"].FRAG_DECRYPTED,c),b.on(e["default"].FRAG_PARSING_INIT_SEGMENT,c),b.on(e["default"].FRAG_PARSED,c),b.on(e["default"].ERROR,c),b.on(e["default"].FRAG_PARSING_METADATA,c),b.on(e["default"].FRAG_PARSING_USERDATA,c),b.on(e["default"].INIT_PTS_FOUND,c),b.on(e["default"].FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})};b["default"]=h},"./src/demux/demuxer.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./node_modules/webworkify-webpack/index.js"),e=c("./src/events.js"),f=c("./src/demux/demuxer-inline.js"),g=c("./src/utils/logger.js"),h=c("./src/errors.js"),i=c("./src/utils/mediasource-helper.js"),j=c("./src/utils/get-self-scope.js"),k=c("./src/observer.js"),l=j.getSelfScope(),m=i.getMediaSource(),n=function(){function b(a,b){var c=this;this.hls=a,this.id=b;var i=this.observer=new k.Observer,j=a.config,n=function(b,d){d=d||{},d.frag=c.frag,d.id=c.id,a.trigger(b,d)};i.on(e["default"].FRAG_DECRYPTED,n),i.on(e["default"].FRAG_PARSING_INIT_SEGMENT,n),i.on(e["default"].FRAG_PARSING_DATA,n),i.on(e["default"].FRAG_PARSED,n),i.on(e["default"].ERROR,n),i.on(e["default"].FRAG_PARSING_METADATA,n),i.on(e["default"].FRAG_PARSING_USERDATA,n),i.on(e["default"].INIT_PTS_FOUND,n);var o={mp4:m.isTypeSupported("video/mp4"),mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(j.enableWorker&&"undefined"!=typeof Worker){g.logger.log("demuxing in webworker");var q=void 0;try{q=this.w=d("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(b){a.trigger(e["default"].ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:b.message+" ("+b.filename+":"+b.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:o,vendor:p,id:b,config:JSON.stringify(j)})}catch(r){g.logger.warn("Error in worker:",r),g.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&l.URL.revokeObjectURL(q.objectURL),this.demuxer=new f["default"](i,o,j,p),this.w=void 0}}else this.demuxer=new f["default"](i,o,j,p)}return b.prototype.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)},b.prototype.push=function(b,c,d,e,f,h,i,j){var k=this.w,l=a.isFinite(f.startPTS)?f.startPTS:f.start,m=f.decryptdata,n=this.frag,o=!(n&&f.cc===n.cc),p=!(n&&f.level===n.level),q=n&&f.sn===n.sn+1,r=!p&&q;if(o&&g.logger.log(this.id+":discontinuity detected"),p&&g.logger.log(this.id+":switch detected"),this.frag=f,k)k.postMessage({cmd:"demux",data:b,decryptdata:m,initSegment:c,audioCodec:d,videoCodec:e,timeOffset:l,discontinuity:o,trackSwitch:p,contiguous:r,duration:h,accurateTimeOffset:i,defaultInitPTS:j},b instanceof ArrayBuffer?[b]:[]);else{var s=this.demuxer;s&&s.push(b,m,c,d,e,l,o,p,r,h,i,j)}},b.prototype.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":l.URL.revokeObjectURL(this.w.objectURL);break;case e["default"].FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},b}();b["default"]=n}).call(this,c("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=function(){function a(a){this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}return a.prototype.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},a.prototype.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},a.prototype.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&d.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c},a.prototype.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},a.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},a.prototype.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},a.prototype.readBoolean=function(){return 1===this.readBits(1)},a.prototype.readUByte=function(){return this.readBits(8)},a.prototype.readUShort=function(){return this.readBits(16)},a.prototype.readUInt=function(){return this.readBits(32)},a.prototype.skipScalingList=function(a){var b,c,d=8,e=8;for(b=0;a>b;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e},a.prototype.readSPS=function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),a=n(),b=o(5),r(3),c=n(),t(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var v=p();if(3===v&&r(1),t(),t(),r(1),q())for(h=3!==v?8:12,i=0;h>i;i++)q()&&u(6>i?16:64)}t();var w=p();if(0===w)p();else if(1===w)for(r(1),s(),s(),d=p(),i=0;d>i;i++)s();t(),r(1),e=p(),f=p(),g=o(1),0===g&&r(1),r(1),q()&&(j=p(),k=p(),l=p(),m=p());var x=[1,1];if(q()&&q()){var y=n();switch(y){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}}return{width:Math.ceil(16*(e+1)-2*j-2*k),height:(2-g)*(f+1)*16-(g?2:4)*(l+m),pixelRatio:x}},a.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}();b["default"]=e},"./src/demux/id3.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.isHeader=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128?!0:!1},a.isFooter=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128?!0:!1},a.getID3Data=function(b,c){for(var d=c,e=0;a.isHeader(b,c);){e+=10;var f=a._readSize(b,c+6);e+=f,a.isFooter(b,c+10)&&(e+=10),c+=e}return e>0?b.subarray(d,d+e):void 0},a._readSize=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},a.getTimeStamp=function(b){for(var c=a.getID3Frames(b),d=0;d<c.length;d++){var e=c[d];if(a.isTimeStampFrame(e))return a._readTimeStamp(e)}return void 0},a.isTimeStampFrame=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},a._getFrameData=function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,4),e=10;return{type:c,size:d,data:b.subarray(e,e+d)}},a.getID3Frames=function(b){for(var c=0,d=[];a.isHeader(b,c);){var e=a._readSize(b,c+6);c+=10;for(var f=c+e;f>c+8;){var g=a._getFrameData(b.subarray(c)),h=a._decodeFrame(g);h&&d.push(h),c+=g.size+10}a.isFooter(b,c)&&(c+=10)}return d},a._decodeFrame=function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"T"===b.type[0]?a._decodeTextFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):void 0},a._readTimeStamp=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}return void 0},a._decodePrivFrame=function(b){if(b.size<2)return void 0;var c=a._utf8ArrayToStr(b.data,!0),d=new Uint8Array(b.data.subarray(c.length+1));return{key:b.type,info:c,data:d.buffer}},a._decodeTextFrame=function(b){if(b.size<2)return void 0;if("TXXX"===b.type){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data.subarray(1));return{key:b.type,data:f}},a._decodeURLFrame=function(b){if("WXXX"===b.type){if(b.size<2)return void 0;var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data);return{key:b.type,data:f}},a._utf8ArrayToStr=function(a,b){void 0===b&&(b=!1);for(var c,d,e,f=a.length,g="",h=0;f>h;){if(c=a[h++],0===c&&b)return g;if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(c);break;case 12:case 13:d=a[h++],g+=String.fromCharCode((31&c)<<6|63&d);break;case 14:d=a[h++],e=a[h++],g+=String.fromCharCode((15&c)<<12|(63&d)<<6|(63&e)<<0)}}return g},a}(),e=d._utf8ArrayToStr;b.utf8ArrayToStr=e,b["default"]=d},"./src/demux/mp3demuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/id3.js"),e=c("./src/utils/logger.js"),f=c("./src/demux/mpegaudio.js"),g=function(){function a(a,b,c){this.observer=a,this.config=c,this.remuxer=b}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){var b,c,g=d["default"].getID3Data(a,0);if(g&&void 0!==d["default"].getTimeStamp(g))for(b=g.length,c=Math.min(a.length-1,b+100);c>b;b++)if(f["default"].probe(a,b))return e.logger.log("MPEG Audio sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,e){for(var g=d["default"].getID3Data(a,0),h=d["default"].getTimeStamp(g),i=h?90*h:9e4*b,j=g.length,k=a.length,l=0,m=0,n=this._audioTrack,o=[{pts:i,dts:i,data:g}];k>j;)if(f["default"].isHeader(a,j)){var p=f["default"].appendFrame(n,a,j,i,l);if(!p)break;j+=p.length,m=p.sample.pts,l++}else d["default"].isHeader(a,j)?(g=d["default"].getID3Data(a,j),o.push({pts:m,dts:m,data:g}),j+=g.length):j++;this.remuxer.remux(n,{samples:[]},{samples:o,inputTimeScale:9e4},{samples:[]},b,c,e)},a.prototype.destroy=function(){},a}();b["default"]=g},"./src/demux/mp4demuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=c("./src/events.js"),f=Math.pow(2,32)-1,g=function(){function a(a,b){this.observer=a,this.remuxer=b}return a.prototype.resetTimeStamp=function(a){this.initPTS=a},a.prototype.resetInitSegment=function(b,c,d,f){if(b&&b.byteLength){var g=this.initData=a.parseInitSegment(b);null==c&&(c="mp4a.40.5"),null==d&&(d="avc1.42e01e");var h={};g.audio&&g.video?h.audiovideo={container:"video/mp4",codec:c+","+d,initSegment:f?b:null}:(g.audio&&(h.audio={container:"audio/mp4",codec:c,initSegment:f?b:null}),g.video&&(h.video={container:"video/mp4",codec:d,initSegment:f?b:null})),this.observer.trigger(e["default"].FRAG_PARSING_INIT_SEGMENT,{tracks:h})}else c&&(this.audioCodec=c),d&&(this.videoCodec=d)},a.probe=function(b){return a.findBox({data:b,start:0,end:Math.min(b.length,16384)},["moof"]).length>0},a.bin2str=function(a){return String.fromCharCode.apply(null,a)},a.readUint16=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<8|a[b+1];return 0>c?65536+c:c},a.readUint32=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return 0>c?4294967296+c:c},a.writeUint32=function(a,b,c){a.data&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c},a.findBox=function(b,c){var d,e,f,g,h,i,j,k=[];if(b.data?(i=b.start,g=b.end,b=b.data):(i=0,g=b.byteLength),!c.length)return null;for(d=i;g>d;)e=a.readUint32(b,d),f=a.bin2str(b.subarray(d+4,d+8)),j=e>1?d+e:g,f===c[0]&&(1===c.length?k.push({data:b,start:d+8,end:j}):(h=a.findBox({data:b,start:d+8,end:j},c.slice(1)),h.length&&(k=k.concat(h)))),d=j;return k},a.parseSegmentIndex=function(b){var c,d=a.findBox(b,["moov"])[0],e=d?d.end:null,f=0,g=a.findBox(b,["sidx"]);if(!g||!g[0])return null;c=[],g=g[0];var h=g.data[0];f=0===h?8:16;var i=a.readUint32(g,f);f+=4;var j=0,k=0;f+=0===h?8:16,f+=2;var l=g.end+k,m=a.readUint16(g,f);f+=2;for(var n=0;m>n;n++){var o=f,p=a.readUint32(g,o);o+=4;var q=2147483647&p,r=(2147483648&p)>>>31;if(1===r)return;var s=a.readUint32(g,o);o+=4,c.push({referenceSize:q,subsegmentDuration:s,info:{duration:s/i,start:l,end:l+q-1}}),l+=q,o+=4,f=o}return{earliestPresentationTime:j,timescale:i,version:h,referencesCount:m,references:c,moovEndOffset:e}},a.parseInitSegment=function(b){var c=[],e=a.findBox(b,["moov","trak"]);return e.forEach(function(b){var e=a.findBox(b,["tkhd"])[0];if(e){var f=e.data[e.start],g=0===f?12:20,h=a.readUint32(e,g),i=a.findBox(b,["mdia","mdhd"])[0];if(i){f=i.data[i.start],g=0===f?12:20;var j=a.readUint32(i,g),k=a.findBox(b,["mdia","hdlr"])[0];if(k){var l=a.bin2str(k.data.subarray(k.start+8,k.start+12)),m={soun:"audio",vide:"video"}[l];if(m){var n=a.findBox(b,["mdia","minf","stbl","stsd"]);if(n.length){n=n[0];var o=a.bin2str(n.data.subarray(n.start+12,n.start+16));d.logger.log("MP4Demuxer:"+m+":"+o+" found")}c[h]={timescale:j,type:m},c[m]={timescale:j,id:h}}}}}}),c},a.getStartDTS=function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f,g;return e=a.readUint32(d,4),f=b[e].timescale||9e4,g=a.findBox(c,["tfdt"]).map(function(b){var c,d;return c=b.data[b.start],d=a.readUint32(b,4),1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8)),d})[0],g/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0},a.offsetStartDTS=function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){var g=a.readUint32(e,4),h=b[g].timescale||9e4;a.findBox(c,["tfdt"]).map(function(b){var c=b.data[b.start],e=a.readUint32(b,4);if(0===c)a.writeUint32(b,4,e-d*h);else{e*=Math.pow(2,32),e+=a.readUint32(b,8),e-=d*h,e=Math.max(e,0);var g=Math.floor(e/(f+1)),i=Math.floor(e%(f+1));a.writeUint32(b,4,g),a.writeUint32(b,8,i)}})})})},a.prototype.append=function(b,c,d,f){var g=this.initData;g||(this.resetInitSegment(b,this.audioCodec,this.videoCodec,!1),g=this.initData);var h,i=this.initPTS;if(void 0===i){var j=a.getStartDTS(g,b);this.initPTS=i=j-c,this.observer.trigger(e["default"].INIT_PTS_FOUND,{initPTS:i})}a.offsetStartDTS(g,b,i),h=a.getStartDTS(g,b),this.remuxer.remux(g.audio,g.video,null,null,h,d,f,b)},a.prototype.destroy=function(){},a}();b["default"]=g},"./src/demux/mpegaudio.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(a,b,c,d,e){if(c+24>b.length)return void 0;var f=this.parseHeader(b,c);if(f&&c+f.frameLength<=b.length){var g=9e4*f.samplesPerFrame/f.sampleRate,h=d+e*g,i={unit:b.subarray(c,c+f.frameLength),pts:h,dts:h};return a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(i),a.len+=f.frameLength,{sample:i,length:f.frameLength}}return void 0},parseHeader:function(a,b){var c=a[b+1]>>3&3,e=a[b+1]>>1&3,f=a[b+2]>>4&15,g=a[b+2]>>2&3,h=a[b+2]>>1&1;if(1!==c&&0!==f&&15!==f&&3!==g){var i=3===c?3-e:3===e?3:4,j=1e3*d.BitratesMap[14*i+f-1],k=3===c?0:2===c?1:2,l=d.SamplingRateMap[3*k+g],m=a[b+3]>>6===3?1:2,n=d.SamplesCoefficients[c][e],o=d.BytesInSlot[e],p=8*n*o,q=parseInt(n*j/l+h,10)*o;return{sampleRate:l,channelCount:m,frameLength:q,samplesPerFrame:p}}return void 0},isHeaderPattern:function(a,b){return 255===a[b]&&224===(224&a[b+1])&&0!==(6&a[b+1])},isHeader:function(a,b){return b+1<a.length&&this.isHeaderPattern(a,b)?!0:!1},probe:function(a,b){if(b+1<a.length&&this.isHeaderPattern(a,b)){var c=4,d=this.parseHeader(a,b),e=c;d&&d.frameLength&&(e=d.frameLength);var f=b+e;if(f===a.length||f+1<a.length&&this.isHeaderPattern(a,f))return!0}return!1}};b["default"]=d},"./src/demux/sample-aes.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/crypt/decrypter.js"),e=function(){function a(a,b,c,e){this.decryptdata=c,this.discardEPB=e,this.decrypter=new d["default"](a,b,{removePKCS7Padding:!1})}return a.prototype.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)},a.prototype.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})},a.prototype.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},a.prototype.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},a.prototype.getAvcDecryptedUnit=function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a},a.prototype.decryptAvcSample=function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})},a.prototype.decryptAvcSamples=function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}();b["default"]=e},"./src/demux/tsdemuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/adts.js"),e=c("./src/demux/mpegaudio.js"),f=c("./src/events.js"),g=c("./src/demux/exp-golomb.js"),h=c("./src/demux/sample-aes.js"),i=c("./src/utils/logger.js"),j=c("./src/errors.js"),k={video:1,audio:2,id3:3,text:4},l=function(){function a(a,b,c,d){this.observer=a,
this.config=c,this.typeSupported=d,this.remuxer=b,this.sampleAes=null}return a.prototype.setDecryptData=function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new h["default"](this.observer,this.config,a,this.discardEPB):this.sampleAes=null},a.probe=function(b){var c=a._syncOffset(b);return 0>c?!1:(c&&i.logger.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),!0)},a._syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;b>c;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:k[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===a?0:void 0,isAAC:"audio"===a?!0:void 0,duration:"audio"===a?b:void 0}},a.prototype.resetInitSegment=function(b,c,d,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",e),this._audioTrack=a.createTrack("audio",e),this._id3Track=a.createTrack("id3",e),this._txtTrack=a.createTrack("text",e),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=e},a.prototype.resetTimeStamp=function(){},a.prototype.append=function(b,c,d,e){var g,h,k,l,m,n,o=b.length,p=!1;this.contiguous=d;var q=this.pmtParsed,r=this._avcTrack,s=this._audioTrack,t=this._id3Track,u=r.pid,v=s.pid,w=t.pid,x=this._pmtId,y=r.pesData,z=s.pesData,A=t.pesData,B=this._parsePAT,C=this._parsePMT,D=this._parsePES,E=this._parseAVCPES.bind(this),F=this._parseAACPES.bind(this),G=this._parseMPEGPES.bind(this),H=this._parseID3PES.bind(this),I=a._syncOffset(b);for(o-=(o+I)%188,g=I;o>g;g+=188)if(71===b[g]){if(h=!!(64&b[g+1]),k=((31&b[g+1])<<8)+b[g+2],l=(48&b[g+3])>>4,l>1){if(m=g+5+b[g+4],m===g+188)continue}else m=g+4;switch(k){case u:h&&(y&&(n=D(y))&&void 0!==n.pts&&E(n,!1),y={data:[],size:0}),y&&(y.data.push(b.subarray(m,g+188)),y.size+=g+188-m);break;case v:h&&(z&&(n=D(z))&&void 0!==n.pts&&(s.isAAC?F(n):G(n)),z={data:[],size:0}),z&&(z.data.push(b.subarray(m,g+188)),z.size+=g+188-m);break;case w:h&&(A&&(n=D(A))&&void 0!==n.pts&&H(n),A={data:[],size:0}),A&&(A.data.push(b.subarray(m,g+188)),A.size+=g+188-m);break;case 0:h&&(m+=b[m]+1),x=this._pmtId=B(b,m);break;case x:h&&(m+=b[m]+1);var J=C(b,m,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes);u=J.avc,u>0&&(r.pid=u),v=J.audio,v>0&&(s.pid=v,s.isAAC=J.isAAC),w=J.id3,w>0&&(t.pid=w),p&&!q&&(i.logger.log("reparse from beginning"),p=!1,g=I-188),q=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(f["default"].ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});y&&(n=D(y))&&void 0!==n.pts?(E(n,!0),r.pesData=null):r.pesData=y,z&&(n=D(z))&&void 0!==n.pts?(s.isAAC?F(n):G(n),s.pesData=null):(z&&z.size&&i.logger.log("last AAC PES packet truncated,might overlap between fragments"),s.pesData=z),A&&(n=D(A))&&void 0!==n.pts?(H(n),t.pesData=null):t.pesData=A,null==this.sampleAes?this.remuxer.remux(s,r,t,this._txtTrack,c,d,e):this.decryptAndRemux(s,r,t,this._txtTrack,c,d,e)},a.prototype.decryptAndRemux=function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)},a.prototype.decryptAndRemuxAvc=function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)},a.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},a.prototype._parsePAT=function(a,b){return(31&a[b+10])<<8|a[b+11]},a.prototype._parsePMT=function(a,b,c,d){var e,f,g,h,j={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;f>b;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){i.logger.log("unkown stream type:"+a[b]);break}case 15:-1===j.audio&&(j.audio=h);break;case 21:-1===j.id3&&(j.id3=h);break;case 219:if(!d){i.logger.log("unkown stream type:"+a[b]);break}case 27:-1===j.avc&&(j.avc=h);break;case 3:case 4:c?-1===j.audio&&(j.audio=h,j.isAAC=!1):i.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:i.logger.warn("HEVC stream type found, not supported for now");break;default:i.logger.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return j},a.prototype._parsePES=function(a){var b,c,d,e,f,g,h,j,k,l=0,m=a.data;if(!a||0===a.size)return null;for(;m[0].length<19&&m.length>1;){var n=new Uint8Array(m[0].length+m[1].length);n.set(m[0]),n.set(m[1],m[0].length),m[0]=n,m.splice(1,1)}if(b=m[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e>a.size-6)return null;c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(j=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,j>4294967295&&(j-=8589934592),h-j>54e5&&(i.logger.warn(Math.round((h-j)/9e4)+"s delta between PTS and DTS, align them"),h=j)):j=h),f=b[8],k=f+9,a.size-=k,g=new Uint8Array(a.size);for(var o=0,p=m.length;p>o;o++){b=m[o];var q=b.byteLength;if(k){if(k>q){k-=q;continue}b=b.subarray(k),q-=k,k=0}g.set(b,l),l+=q}return e&&(e-=f+3),{data:g,pts:h,dts:j,len:e}}return null},a.prototype.pushAccesUnit=function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&i.logger.log(a.pts+"/"+a.dts+":"+a.debug)},a.prototype._parseAVCPES=function(a,b){var c,d,e,f=this,h=this._avcTrack,i=this._parseAVCNALu(a.data),j=!1,k=this.avcSample,l=!1,m=this.pushAccesUnit.bind(this),n=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null,k&&i.length&&!h.audFound&&(m(k,h),k=this.avcSample=n(!1,a.pts,a.dts,"")),i.forEach(function(b){switch(b.type){case 1:d=!0,k||(k=f.avcSample=n(!0,a.pts,a.dts,"")),j&&(k.debug+="NDR "),k.frame=!0;var i=b.data;if(l&&i.length>4){var o=new g["default"](i).readSliceType();(2===o||4===o||7===o||9===o)&&(k.key=!0)}break;case 5:d=!0,k||(k=f.avcSample=n(!0,a.pts,a.dts,"")),j&&(k.debug+="IDR "),k.key=!0,k.frame=!0;break;case 6:d=!0,j&&k&&(k.debug+="SEI "),c=new g["default"](f.discardEPB(b.data)),c.readUByte();for(var p=0,q=0,r=!1,s=0;!r&&c.bytesAvailable>1;){p=0;do s=c.readUByte(),p+=s;while(255===s);q=0;do s=c.readUByte(),q+=s;while(255===s);if(4===p&&0!==c.bytesAvailable){r=!0;var t=c.readUByte();if(181===t){var u=c.readUShort();if(49===u){var v=c.readUInt();if(1195456820===v){var w=c.readUByte();if(3===w){var x=c.readUByte(),y=c.readUByte(),z=31&x,A=[x,y];for(e=0;z>e;e++)A.push(c.readUByte()),A.push(c.readUByte()),A.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:A})}}}}}else if(q<c.bytesAvailable)for(e=0;q>e;e++)c.readUByte()}break;case 7:if(d=!0,l=!0,j&&k&&(k.debug+="SPS "),!h.sps){c=new g["default"](b.data);var B=c.readSPS();h.width=B.width,h.height=B.height,h.pixelRatio=B.pixelRatio,h.sps=[b.data],h.duration=f._duration;var C=b.data.subarray(1,4),D="avc1.";for(e=0;3>e;e++){var E=C[e].toString(16);E.length<2&&(E="0"+E),D+=E}h.codec=D}break;case 8:d=!0,j&&k&&(k.debug+="PPS "),h.pps||(h.pps=[b.data]);break;case 9:d=!1,h.audFound=!0,k&&m(k,h),k=f.avcSample=n(!1,a.pts,a.dts,j?"AUD ":"");break;case 12:d=!1;break;default:d=!1,k&&(k.debug+="unknown NAL "+b.type+" ")}if(k&&d){var F=k.units;F.push(b)}}),b&&k&&(m(k,h),this.avcSample=null)},a.prototype._insertSampleInOrder=function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)},a.prototype._getLastNalUnit=function(){var a,b=this.avcSample;if(!b||0===b.units.length){var c=this._avcTrack,d=c.samples;b=d[d.length-1]}if(b){var e=b.units;a=e[e.length-1]}return a},a.prototype._parseAVCNALu=function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(-1===j&&(m=0,f=31&a[0],j=0,g=1);h>g;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&4-k>=g&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}h>g?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var n=this._getLastNalUnit();if(n){var o=new Uint8Array(n.data.byteLength+a.byteLength);o.set(n.data,0),o.set(a,n.data.byteLength),n.data=o}}return i.naluState=j,l},a.prototype.discardEPB=function(a){for(var b,c,d=a.byteLength,e=[],f=1;d-2>f;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;b>f;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c},a.prototype._parseAACPES=function(a){var b,c,e,g,h,k=this._audioTrack,l=a.data,m=a.pts,n=0,o=this.aacOverFlow,p=this.aacLastPTS;if(o){var q=new Uint8Array(o.byteLength+l.byteLength);q.set(o,0),q.set(l,o.byteLength),l=q}for(e=n,h=l.length;h-1>e&&!d.isHeader(l,e);e++);if(e){var r=void 0,s=void 0;if(h-1>e?(r="AAC PES did not start with ADTS header,offset:"+e,s=!1):(r="no ADTS header found in AAC PES",s=!0),i.logger.warn("parsing error:"+r),this.observer.trigger(f["default"].ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),s)return}if(d.initTrackConfig(k,this.observer,l,e,this.audioCodec),c=0,b=d.getFrameDuration(k.samplerate),o&&p){var t=p+b;Math.abs(t-m)>1&&(i.logger.log("AAC: align PTS for overlapping frames by "+Math.round((t-m)/90)),m=t)}for(;h>e;)if(d.isHeader(l,e)&&h>e+5){var u=d.appendFrame(k,l,e,m,c);if(!u)break;e+=u.length,g=u.sample.pts,c++}else e++;o=h>e?l.subarray(e,h):null,this.aacOverFlow=o,this.aacLastPTS=g},a.prototype._parseMPEGPES=function(a){for(var b=a.data,c=b.length,d=0,f=0,g=a.pts;c>f;)if(e["default"].isHeader(b,f)){var h=e["default"].appendFrame(this._audioTrack,b,f,g,d);if(!h)break;f+=h.length,d++}else f++},a.prototype._parseID3PES=function(a){this._id3Track.samples.push(a)},a}();b["default"]=l},"./src/errors.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},b.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=c("./src/errors.js"),f=c("./src/events.js"),g={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function a(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.hls=a,this.onEvent=this.onEvent.bind(this),this.handledEvents=b,this.useGenericHandler=!0,this.registerListeners()}return a.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},a.prototype.onHandlerDestroying=function(){},a.prototype.onHandlerDestroyed=function(){},a.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},a.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if(g[a])throw new Error("Forbidden event-name: "+a);this.hls.on(a,this.onEvent)},this)},a.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)},a.prototype.onEvent=function(a,b){this.onEventGeneric(a,b)},a.prototype.onEventGeneric=function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(g){d.logger.error("An internal error happened while handling event "+a+'. Error message: "'+g.message+'". Here is a stacktrace:',g),this.hls.trigger(f["default"].ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:g})}},a}();b["default"]=h},"./src/events.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};b["default"]=d},"./src/hls.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./node_modules/url-toolkit/src/url-toolkit.js"),f=c("./src/errors.js"),g=c("./src/loader/playlist-loader.js"),h=c("./src/loader/fragment-loader.js"),i=c("./src/loader/key-loader.js"),j=c("./src/controller/fragment-tracker.js"),k=c("./src/controller/stream-controller.js"),l=c("./src/controller/level-controller.js"),m=c("./src/controller/id3-track-controller.js"),n=c("./src/is-supported.js"),o=c("./src/utils/logger.js"),p=c("./src/config.js"),q=c("./src/events.js"),r=c("./src/observer.js"),s=function(a){function b(c){void 0===c&&(c={});var d=a.call(this)||this,e=b.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var f in e)f in c||(c[f]=e[f]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');o.enableLogs(c.debug),d.config=c,d._autoLevelCapping=-1;var n=d.abrController=new c.abrController(d),p=new c.bufferController(d),q=new c.capLevelController(d),r=new c.fpsController(d),s=new g["default"](d),t=new h["default"](d),u=new i["default"](d),v=new m["default"](d),w=d.levelController=new l["default"](d),x=new j.FragmentTracker(d),y=d.streamController=new k["default"](d,x),z=[w,y],A=c.audioStreamController;A&&z.push(new A(d,x)),d.networkControllers=z;var B=[s,t,u,n,p,q,r,v,x];if(A=c.audioTrackController){var C=new A(d);d.audioTrackController=C,B.push(C)}if(A=c.subtitleTrackController){var D=new A(d);d.subtitleTrackController=D,z.push(D)}if(A=c.emeController){var E=new A(d);d.emeController=E,B.push(E)}return A=c.subtitleStreamController,A&&z.push(new A(d,x)),A=c.timelineController,A&&B.push(new A(d)),d.coreComponents=B,d}return d(b,a),Object.defineProperty(b,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),b.isSupported=function(){return n.isSupported()},Object.defineProperty(b,"Events",{get:function(){return q["default"]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorTypes",{get:function(){return f.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorDetails",{get:function(){return f.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultConfig",{get:function(){return b.defaultConfig?b.defaultConfig:p.hlsDefaultConfig},set:function(a){b.defaultConfig=a},enumerable:!0,configurable:!0}),b.prototype.destroy=function(){o.logger.log("destroy"),this.trigger(q["default"].DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},b.prototype.attachMedia=function(a){o.logger.log("attachMedia"),this.media=a,this.trigger(q["default"].MEDIA_ATTACHING,{media:a})},b.prototype.detachMedia=function(){o.logger.log("detachMedia"),this.trigger(q["default"].MEDIA_DETACHING),this.media=null},b.prototype.loadSource=function(a){a=e.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),o.logger.log("loadSource:"+a),this.url=a,this.trigger(q["default"].MANIFEST_LOADING,{url:a})},b.prototype.startLoad=function(a){void 0===a&&(a=-1),o.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},b.prototype.stopLoad=function(){o.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},b.prototype.swapAudioCodec=function(){o.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.prototype.recoverMediaError=function(){o.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)},Object.defineProperty(b.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(a){o.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(a){o.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(a){o.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){o.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(a){o.logger.log("set startLevel:"+a);var b=this;-1!==a&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(a){o.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"minAutoLevel",{get:function(){for(var a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;d>e;e++){var f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate;if(f>c)return e}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxAutoLevel",{get:function(){var a,b=this,c=b.levels,d=b.autoLevelCapping;return a=-1===d&&c&&c.length?c.length-1:d},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextAutoLevel",{get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTracks",{get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTrack",{get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleTracks",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleTrack",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleDisplay",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleDisplay:!1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)},enumerable:!0,configurable:!0}),b}(r.Observer);b["default"]=s},"./src/is-supported.js":function(a,b,c){"use strict";function d(){var a=e.getMediaSource(),b=window.SourceBuffer||window.WebKitSourceBuffer,c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),d=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!d}Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/mediasource-helper.js");b.isSupported=d},"./src/loader/fragment-loader.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=function(b){function c(a){var c=b.call(this,a,e["default"].FRAG_LOADING)||this;return c.loaders={},c}return d(c,b),c.prototype.destroy=function(){var a=this.loaders;for(var c in a){var d=a[c];d&&d.destroy()}this.loaders={},b.prototype.destroy.call(this)},c.prototype.onFragLoading=function(b){var c=b.frag,d=c.type,e=this.loaders,f=this.hls.config,g=f.fLoader,i=f.loader;c.loaded=0;var j=e[d];j&&(h.logger.warn("abort previous fragment loader for type: "+d),j.abort()),j=e[d]=c.loader=f.fLoader?new g(f):new i(f);var k,l,m;k={url:c.url,frag:c,responseType:"arraybuffer",progressData:!1};var n=c.byteRangeStartOffset,o=c.byteRangeEndOffset;a.isFinite(n)&&a.isFinite(o)&&(k.rangeStart=n,k.rangeEnd=o),l={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},j.load(k,l,m)},c.prototype.loadsuccess=function(a,b,c,d){void 0===d&&(d=null);var f=a.data,g=c.frag;g.loader=void 0,this.loaders[g.type]=void 0,this.hls.trigger(e["default"].FRAG_LOADED,{payload:f,frag:g,stats:b,networkDetails:d})},c.prototype.loaderror=function(a,b,c){void 0===c&&(c=null);var d=b.frag,f=d.loader;f&&f.abort(),this.loaders[d.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})},c.prototype.loadtimeout=function(a,b,c){void 0===c&&(c=null);var d=b.frag,f=d.loader;f&&f.abort(),this.loaders[d.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})},c.prototype.loadprogress=function(a,b,c,d){void 0===d&&(d=null);var f=b.frag;f.loaded=a.loaded,this.hls.trigger(e["default"].FRAG_LOAD_PROGRESS,{frag:f,stats:a,networkDetails:d})},c}(f["default"]);b["default"]=i}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./node_modules/url-toolkit/src/url-toolkit.js"),e=c("./src/loader/level-key.js"),f=function(){function b(){var a;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(a={},a[b.ElementaryStreamTypes.AUDIO]=!1,a[b.ElementaryStreamTypes.VIDEO]=!1,a)}return Object.defineProperty(b,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=d.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var a=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c||0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0],this._byteRange=a}return a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"endProgramDateTime",{get:function(){if(!a.isFinite(this.programDateTime))return null;var b=a.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),b.prototype.addElementaryStream=function(a){this._elementaryStreams[a]=!0},b.prototype.hasElementaryStream=function(a){return this._elementaryStreams[a]===!0},b.prototype.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;16>c;c++)b[c]=a>>8*(15-c)&255;return b},b.prototype.fragmentDecryptdataFromLevelkey=function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new e["default"],c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c},b}();b["default"]=f}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=function(a){function b(b){var c=a.call(this,b,e["default"].KEY_LOADING)||this;return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return d(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},f["default"].prototype.destroy.call(this)},b.prototype.onKeyLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],f=b.decryptdata,g=f.uri;if(g!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;d&&(h.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new i.loader(i),this.decrypturl=g,this.decryptkey=null;var j=void 0,k=void 0,l=void 0;j={url:g,frag:b,responseType:"arraybuffer"},k={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(j,k,l)}else this.decryptkey&&(f.key=this.decryptkey,this.hls.trigger(e["default"].KEY_LOADED,{frag:b}))},b.prototype.loadsuccess=function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(e["default"].KEY_LOADED,{frag:d})},b.prototype.loaderror=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.prototype.loadtimeout=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_TIMEOUT,
fatal:!1,frag:c})},b}(f["default"]);b["default"]=i},"./src/loader/level-key.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./node_modules/url-toolkit/src/url-toolkit.js"),e=function(){function a(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(a.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=d.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),a}();b["default"]=e},"./src/loader/level.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function b(a){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=a,this.version=null}return Object.defineProperty(b.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!a.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),b}();b["default"]=c}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(a,b,c){"use strict";(function(a){function d(a,b){for(var c=a[b],d=b-1;d>=0;d--){var e=a[d];e.programDateTime=c.programDateTime-1e3*e.duration,c=e}}function e(b,c){b.rawProgramDateTime?b.programDateTime=Date.parse(b.rawProgramDateTime):c&&c.programDateTime&&(b.programDateTime=c.endProgramDateTime),a.isFinite(b.programDateTime)||(b.programDateTime=null,b.rawProgramDateTime=null)}Object.defineProperty(b,"__esModule",{value:!0});var f=c("./node_modules/url-toolkit/src/url-toolkit.js"),g=c("./src/loader/fragment.js"),h=c("./src/loader/level.js"),i=c("./src/loader/level-key.js"),j=c("./src/utils/attr-list.js"),k=c("./src/utils/logger.js"),l=c("./src/utils/codecs.js"),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,n=/#EXT-X-MEDIA:(.*)/g,o=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),p=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,q=/\.(mp4|m4s|m4v|m4a)$/i,r=function(){function b(){}return b.findGroup=function(a,b){if(!a)return null;for(var c=null,d=0;d<a.length;d++){var e=a[d];e.id===b&&(c=e)}return c},b.convertAVC1ToAVCOTI=function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b},b.resolve=function(a,b){return f.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},b.parseMasterPlaylist=function(a,c){function d(a,b){["video","audio"].forEach(function(c){var d=a.filter(function(a){return l.isCodecType(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return-1===d.indexOf(a)})}}),b.unknownCodecs=a}var e,f=[];for(m.lastIndex=0;null!=(e=m.exec(a));){var g={},h=g.attrs=new j["default"](e[1]);g.url=b.resolve(e[2],c);var i=h.decimalResolution("RESOLUTION");i&&(g.width=i.width,g.height=i.height),g.bitrate=h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),g.name=h.NAME,d([].concat((h.CODECS||"").split(/[ ,]+/)),g),g.videoCodec&&-1!==g.videoCodec.indexOf("avc1")&&(g.videoCodec=b.convertAVC1ToAVCOTI(g.videoCodec)),f.push(g)}return f},b.parseMasterPlaylistMedia=function(a,c,d,e){void 0===e&&(e=[]);var f,g=[],h=0;for(n.lastIndex=0;null!==(f=n.exec(a));){var i={},k=new j["default"](f[1]);if(k.TYPE===d){if(i.groupId=k["GROUP-ID"],i.name=k.NAME,i.type=d,i["default"]="YES"===k.DEFAULT,i.autoselect="YES"===k.AUTOSELECT,i.forced="YES"===k.FORCED,k.URI&&(i.url=b.resolve(k.URI,c)),i.lang=k.LANGUAGE,i.name||(i.name=i.lang),e.length){var l=b.findGroup(e,i.groupId);i.audioCodec=l?l.codec:e[0].codec}i.id=h++,g.push(i)}}return g},b.parseLevelPlaylist=function(b,c,f,l,m){var n,r,s=0,t=0,u=new h["default"](c),v=new i["default"],w=0,x=null,y=new g["default"],z=null;for(o.lastIndex=0;null!==(n=o.exec(b));){var A=n[1];if(A){y.duration=parseFloat(A);var B=(" "+n[2]).slice(1);y.title=B||null,y.tagList.push(B?["INF",A,B]:["INF",A])}else if(n[3]){if(a.isFinite(y.duration)){var C=s++;y.type=l,y.start=t,y.levelkey=v,y.sn=C,y.level=f,y.cc=w,y.urlId=m,y.baseurl=c,y.relurl=(" "+n[3]).slice(1),e(y,x),u.fragments.push(y),x=y,t+=y.duration,y=new g["default"]}}else if(n[4]){if(y.rawByteRange=(" "+n[4]).slice(1),x){var D=x.byteRangeEndOffset;D&&(y.lastByteRangeEndOffset=D)}}else if(n[5])y.rawProgramDateTime=(" "+n[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),null===z&&(z=u.fragments.length);else{for(n=n[0].match(p),r=1;r<n.length&&void 0===n[r];r++);var E=(" "+n[r+1]).slice(1),F=(" "+n[r+2]).slice(1);switch(n[r]){case"#":y.tagList.push(F?[E,F]:[E]);break;case"PLAYLIST-TYPE":u.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(E);break;case"TARGETDURATION":u.targetduration=parseFloat(E);break;case"VERSION":u.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":w++,y.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":w=parseInt(E);break;case"KEY":var G=E,H=new j["default"](G),I=H.enumeratedString("METHOD"),J=H.URI,K=H.hexadecimalInteger("IV");I&&(v=new i["default"],J&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(v.method=I,v.baseuri=c,v.reluri=J,v.key=null,v.iv=K));break;case"START":var L=E,M=new j["default"](L),N=M.decimalFloatingPoint("TIME-OFFSET");a.isFinite(N)&&(u.startTimeOffset=N);break;case"MAP":var O=new j["default"](E);y.relurl=O.URI,y.rawByteRange=O.BYTERANGE,y.baseurl=c,y.level=f,y.type=l,y.sn="initSegment",u.initSegment=y,y=new g["default"],y.rawProgramDateTime=u.initSegment.rawProgramDateTime;break;default:k.logger.warn("line parsed but not handled: "+n)}}}return y=x,y&&!y.relurl&&(u.fragments.pop(),t-=y.duration),u.totalduration=t,u.averagetargetduration=t/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=w,!u.initSegment&&u.fragments.length&&u.fragments.every(function(a){return q.test(a.relurl)})&&(k.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),y=new g["default"],y.relurl=u.fragments[0].relurl,y.baseurl=c,y.level=f,y.type=l,y.sn="initSegment",u.initSegment=y,u.needSidxRanges=!0),z&&d(u.fragments,z),u},b}();b["default"]=r}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=c("./src/demux/mp4demuxer.js"),j=c("./src/loader/m3u8-parser.js"),k=window.performance,l={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},m={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},n=function(b){function c(a){var c=b.call(this,a,e["default"].MANIFEST_LOADING,e["default"].LEVEL_LOADING,e["default"].AUDIO_TRACK_LOADING,e["default"].SUBTITLE_TRACK_LOADING)||this;return c.loaders={},c}return d(c,b),Object.defineProperty(c,"ContextType",{get:function(){return l},enumerable:!0,configurable:!0}),Object.defineProperty(c,"LevelType",{get:function(){return m},enumerable:!0,configurable:!0}),c.canHaveQualityLevels=function(a){return a!==l.AUDIO_TRACK&&a!==l.SUBTITLE_TRACK},c.mapContextToLevelType=function(a){var b=a.type;switch(b){case l.AUDIO_TRACK:return m.AUDIO;case l.SUBTITLE_TRACK:return m.SUBTITLE;default:return m.MAIN}},c.getResponseUrl=function(a,b){var c=a.url;return(void 0===c||0===c.indexOf("data:"))&&(c=b.url),c},c.prototype.createInternalLoader=function(a){var b=this.hls.config,c=b.pLoader,d=b.loader,e=c||d,f=new e(b);return a.loader=f,this.loaders[a.type]=f,f},c.prototype.getInternalLoader=function(a){return this.loaders[a.type]},c.prototype.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},c.prototype.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy(),this.resetInternalLoader(a)}},c.prototype.destroy=function(){this.destroyInternalLoaders(),b.prototype.destroy.call(this)},c.prototype.onManifestLoading=function(a){this.load(a.url,{type:l.MANIFEST,level:0,id:null})},c.prototype.onLevelLoading=function(a){this.load(a.url,{type:l.LEVEL,level:a.level,id:a.id})},c.prototype.onAudioTrackLoading=function(a){this.load(a.url,{type:l.AUDIO_TRACK,level:null,id:a.id})},c.prototype.onSubtitleTrackLoading=function(a){this.load(a.url,{type:l.SUBTITLE_TRACK,level:null,id:a.id})},c.prototype.load=function(a,b){var c=this.hls.config;h.logger.debug("Loading playlist of type "+b.type+", level: "+b.level+", id: "+b.id);var d=this.getInternalLoader(b);if(d){var e=d.context;if(e&&e.url===a)return h.logger.trace("playlist request ongoing"),!1;h.logger.warn("aborting previous loader for type: "+b.type),d.abort()}var f,g,i,j;switch(b.type){case l.MANIFEST:f=c.manifestLoadingMaxRetry,g=c.manifestLoadingTimeOut,i=c.manifestLoadingRetryDelay,j=c.manifestLoadingMaxRetryTimeout;break;case l.LEVEL:f=0,g=c.levelLoadingTimeOut;break;default:f=c.levelLoadingMaxRetry,g=c.levelLoadingTimeOut,i=c.levelLoadingRetryDelay,j=c.levelLoadingMaxRetryTimeout}d=this.createInternalLoader(b),b.url=a,b.responseType=b.responseType||"";var k={timeout:g,maxRetry:f,retryDelay:i,maxRetryDelay:j},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return h.logger.debug("Calling internal loader delegate for URL: "+a),d.load(b,k,m),!0},c.prototype.loadsuccess=function(a,b,c,d){if(void 0===d&&(d=null),c.isSidxRequest)return this._handleSidxRequest(a,c),void this._handlePlaylistLoaded(a,b,c,d);this.resetInternalLoader(c.type);var e=a.data;return b.tload=k.now(),0!==e.indexOf("#EXTM3U")?void this._handleManifestParsingError(a,c,"no EXTM3U delimiter",d):void(e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(a,b,c,d):this._handleMasterPlaylist(a,b,c,d))},c.prototype.loaderror=function(a,b,c){void 0===c&&(c=null),this._handleNetworkError(b,c,!1,a)},c.prototype.loadtimeout=function(a,b,c){void 0===c&&(c=null),this._handleNetworkError(b,c,!0)},c.prototype._handleMasterPlaylist=function(a,b,d,f){var g=this.hls,i=a.data,k=c.getResponseUrl(a,d),l=j["default"].parseMasterPlaylist(i,k);if(!l.length)return void this._handleManifestParsingError(a,d,"no level found in manifest",f);var m=l.map(function(a){return{id:a.attrs.AUDIO,codec:a.audioCodec}}),n=j["default"].parseMasterPlaylistMedia(i,k,"AUDIO",m),o=j["default"].parseMasterPlaylistMedia(i,k,"SUBTITLES");if(n.length){var p=!1;n.forEach(function(a){a.url||(p=!0)}),p===!1&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(h.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main"}))}g.trigger(e["default"].MANIFEST_LOADED,{levels:l,audioTracks:n,subtitles:o,url:k,stats:b,networkDetails:f})},c.prototype._handleTrackOrLevelPlaylist=function(b,d,f,g){var h=this.hls,i=f.id,m=f.level,n=f.type,o=c.getResponseUrl(b,f),p=a.isFinite(i)?i:0,q=a.isFinite(m)?m:p,r=c.mapContextToLevelType(f),s=j["default"].parseLevelPlaylist(b.data,o,q,r,p);if(s.tload=d.tload,n===l.MANIFEST){var t={url:o,details:s};h.trigger(e["default"].MANIFEST_LOADED,{levels:[t],audioTracks:[],url:o,stats:d,networkDetails:g})}if(d.tparsed=k.now(),s.needSidxRanges){var u=s.initSegment.url;return void this.load(u,{isSidxRequest:!0,type:n,level:m,levelDetails:s,id:i,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}f.levelDetails=s,this._handlePlaylistLoaded(b,d,f,g)},c.prototype._handleSidxRequest=function(a,b){var c=i["default"].parseSegmentIndex(new Uint8Array(a.data));if(c){var d=c.references,e=b.levelDetails;d.forEach(function(a,b){var c=a.info,d=e.fragments[b];0===d.byteRange.length&&(d.rawByteRange=String(1+c.end-c.start)+"@"+String(c.start))}),e.initSegment.rawByteRange=String(c.moovEndOffset)+"@0"}},c.prototype._handleManifestParsingError=function(a,b,c,d){this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a.url,reason:c,networkDetails:d})},c.prototype._handleNetworkError=function(a,b,c,d){void 0===c&&(c=!1),void 0===d&&(d=null),h.logger.info("A network error occured while loading a "+a.type+"-type playlist");var f,i,j=this.getInternalLoader(a);switch(a.type){case l.MANIFEST:f=c?g.ErrorDetails.MANIFEST_LOAD_TIMEOUT:g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case l.LEVEL:f=c?g.ErrorDetails.LEVEL_LOAD_TIMEOUT:g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case l.AUDIO_TRACK:f=c?g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;default:i=!1}j&&(j.abort(),this.resetInternalLoader(a.type));var k={type:g.ErrorTypes.NETWORK_ERROR,details:f,fatal:i,url:j.url,loader:j,context:a,networkDetails:b};d&&(k.response=d),this.hls.trigger(e["default"].ERROR,k)},c.prototype._handlePlaylistLoaded=function(a,b,d,f){var g=d.type,h=d.level,i=d.id,j=d.levelDetails;if(!j.targetduration)return void this._handleManifestParsingError(a,d,"invalid target duration",f);var k=c.canHaveQualityLevels(d.type);if(k)this.hls.trigger(e["default"].LEVEL_LOADED,{details:j,level:h||0,id:i||0,stats:b,networkDetails:f});else switch(g){case l.AUDIO_TRACK:this.hls.trigger(e["default"].AUDIO_TRACK_LOADED,{details:j,id:i,stats:b,networkDetails:f});break;case l.SUBTITLE_TRACK:this.hls.trigger(e["default"].SUBTITLE_TRACK_LOADED,{details:j,id:i,stats:b,networkDetails:f})}},c}(f["default"]);b["default"]=n}).call(this,c("./src/polyfills/number.js").Number)},"./src/observer.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./node_modules/eventemitter3/index.js"),f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.trigger=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.emit.apply(this,[a,a].concat(b))},b}(e.EventEmitter);b.Observer=f},"./src/polyfills/number.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/get-self-scope.js"),e=d.getSelfScope(),f=e.Number;b.Number=f,f.isFinite=f.isFinite||function(a){return"number"==typeof a&&isFinite(a)}},"./src/remux/aac-helper.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.getSilentFrame=function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a}();b["default"]=d},"./src/remux/mp4-generator.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=Math.pow(2,32)-1,e=function(){function a(){}return a.init=function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;f>e;e++)b.set(c[e],d),d+=c[e].byteLength;return b},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,g)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,e=b.duration*b.timescale,f=b.width,g=b.height,h=Math.floor(e/(d+1)),i=Math.floor(e%(d+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,f>>8&255,255&f,0,0,g>>8&255,255&g,0,0]))},a.traf=function(b,c){var e=a.sdtp(b),f=b.id,g=Math.floor(c/(d+1)),h=Math.floor(c%(d+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,255&f])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h])),a.trun(b,e.length+16+20+8+16+8+8),e)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;k>d;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c},a}();b["default"]=e},"./src/remux/mp4-remuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/remux/aac-helper.js"),e=c("./src/remux/mp4-generator.js"),f=c("./src/events.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=1e4,j=function(){function a(a,b,c,d){this.observer=a,this.config=b,this.typeSupported=c;var e=navigator.userAgent;this.isSafari=d&&d.indexOf("Apple")>-1&&e&&!e.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(a){this._initPTS=this._initDTS=a},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.remux=function(a,b,c,d,e,g,i){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated){var j=a.samples.length,k=b.samples.length,l=e,m=e;if(j&&k){var n=(a.samples[0].pts-b.samples[0].pts)/b.inputTimeScale;l+=Math.max(0,n),m+=Math.max(0,-n)}if(j){a.timescale||(h.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var o=this.remuxAudio(a,l,g,i);if(k){var p=void 0;o&&(p=o.endPTS-o.startPTS),b.timescale||(h.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,m,g,p,i)}}else if(k){var q=this.remuxVideo(b,m,g,0,i);q&&a.codec&&this.remuxEmptyAudio(a,l,g,q)}}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(f["default"].FRAG_PARSED)},a.prototype.generateIS=function(a,b,c){var d,i,j=this.observer,k=a.samples,l=b.samples,m=this.typeSupported,n="audio/mp4",o={},p={tracks:o},q=void 0===this._initPTS;if(q&&(d=i=1/0),a.config&&k.length&&(a.timescale=a.samplerate,h.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(m.mpeg?(n="audio/mpeg",a.codec=""):m.mp3&&(a.codec="mp3")),o.audio={container:n,codec:a.codec,initSegment:!a.isAAC&&m.mpeg?new Uint8Array:e["default"].initSegment([a]),metadata:{channelCount:a.channelCount}},q&&(d=i=k[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&l.length){var r=b.inputTimeScale;b.timescale=r,o.video={container:"video/mp4",codec:b.codec,initSegment:e["default"].initSegment([b]),metadata:{width:b.width,height:b.height}},q&&(d=Math.min(d,l[0].pts-r*c),i=Math.min(i,l[0].dts-r*c),this.observer.trigger(f["default"].INIT_PTS_FOUND,{initPTS:d}))}Object.keys(o).length?(j.trigger(f["default"].FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,q&&(this._initPTS=d,this._initDTS=i)):j.trigger(f["default"].ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(a,b,c,d,i){var j,k,l,m,n,o,p,q=8,r=a.timescale,s=a.samples,t=[],u=s.length,v=this._PTSNormalize,w=this._initPTS,x=this.nextAvcDts,y=this.isSafari;if(0!==u){y&&(c|=s.length&&x&&(i&&Math.abs(b-x/r)<.1||Math.abs(s[0].pts-x-w)<r/5)),c||(x=b*r),s.forEach(function(a){a.pts=v(a.pts-w,x),a.dts=v(a.dts-w,x)}),s.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||d||a.id-b.id});var z=s.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(0>z){h.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(z/90)+" ms to overcome this issue");for(var A=0;A<s.length;A++)s[A].dts+=z}var B=s[0];n=Math.max(B.dts,0),m=Math.max(B.pts,0);var C=Math.round((n-x)/90);c&&C&&(C>1?h.logger.log("AVC:"+C+" ms hole between fragments detected,filling it"):-1>C&&h.logger.log("AVC:"+-C+" ms overlapping between fragments detected"),n=x,s[0].dts=n,m=Math.max(m-C,x),s[0].pts=m,h.logger.log("Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(n/90)+",delta:"+C+" ms")),B=s[s.length-1],p=Math.max(B.dts,0),o=Math.max(B.pts,0,p),y&&(j=Math.round((p-n)/(s.length-1)));for(var D=0,E=0,A=0;u>A;A++){for(var F=s[A],G=F.units,H=G.length,I=0,J=0;H>J;J++)I+=G[J].data.length;E+=I,D+=H,F.length=I,y?F.dts=n+A*j:F.dts=Math.max(F.dts,n),F.pts=Math.max(F.pts,F.dts)}var K=E+4*D+8;try{k=new Uint8Array(K)}catch(L){return void this.observer.trigger(f["default"].ERROR,{type:g.ErrorTypes.MUX_ERROR,details:g.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:K,reason:"fail allocating video mdat "+K})}var M=new DataView(k.buffer);M.setUint32(0,K),k.set(e["default"].types.mdat,4);for(var A=0;u>A;A++){for(var N=s[A],O=N.units,P=0,Q=void 0,J=0,H=O.length;H>J;J++){var R=O[J],S=R.data,T=R.data.byteLength;M.setUint32(q,T),q+=4,k.set(S,q),q+=T,P+=4+T}if(y)Q=Math.max(0,j*Math.round((N.pts-N.dts)/j));else{if(u-1>A)j=s[A+1].dts-N.dts;else{var U=this.config,V=N.dts-s[A>0?A-1:A].dts;if(U.stretchShortVideoTrack){var W=U.maxBufferHole,X=Math.floor(W*r),Y=(d?m+d*r:this.nextAudioPts)-N.pts;Y>X?(j=Y-V,0>j&&(j=V),h.logger.log("It is approximately "+Y/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=V}else j=V}Q=Math.round(N.pts-N.dts)}t.push({size:P,duration:j,cts:Q,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:N.key?2:1,isNonSync:N.key?0:1}})}this.nextAvcDts=p+j;var Z=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,t.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var $=t[0].flags;$.dependsOn=2,$.isNonSync=0}a.samples=t,l=e["default"].moof(a.sequenceNumber++,n,a),a.samples=[];var _={data1:l,data2:k,startPTS:m/r,endPTS:(o+j)/r,startDTS:n/r,endDTS:this.nextAvcDts/r,type:"video",hasAudio:!1,hasVideo:!0,nb:t.length,dropped:Z};return this.observer.trigger(f["default"].FRAG_PARSING_DATA,_),_}},a.prototype.remuxAudio=function(a,b,c,j){var k,l,m,n,o,p,q,r=a.inputTimeScale,s=a.timescale,t=r/s,u=a.isAAC?1024:1152,v=u*t,w=this._PTSNormalize,x=this._initPTS,y=!a.isAAC&&this.typeSupported.mpeg,z=a.samples,A=[],B=this.nextAudioPts;if(c|=z.length&&B&&(j&&Math.abs(b-B/r)<.1||Math.abs(z[0].pts-B-x)<20*v),z.forEach(function(a){a.pts=a.dts=w(a.pts-x,b*r)}),z=z.filter(function(a){return a.pts>=0}),0!==z.length){if(c||(B=j?b*r:z[0].pts),a.isAAC)for(var C=this.config.maxAudioFramesDrift,D=0,E=B;D<z.length;){var F,G=z[D],H=G.pts;F=H-E;var I=Math.abs(1e3*F/r);if(-C*v>=F)h.logger.warn("Dropping 1 audio frame @ "+(E/r).toFixed(3)+"s due to "+Math.round(I)+" ms overlap."),z.splice(D,1),a.len-=G.unit.length;else if(F>=C*v&&i>I&&E){var J=Math.round(F/v);h.logger.warn("Injecting "+J+" audio frame @ "+(E/r).toFixed(3)+"s due to "+Math.round(1e3*F/r)+" ms gap.");for(var K=0;J>K;K++){var L=Math.max(E,0);m=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),m||(h.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),m=G.unit.subarray()),z.splice(D,0,{unit:m,pts:L,dts:L}),a.len+=m.length,E+=v,D++}G.pts=G.dts=E,E+=v,D++}else Math.abs(F)>.1*v,G.pts=G.dts=E,E+=v,D++}for(var K=0,M=z.length;M>K;K++){var N=z[K],O=N.unit,H=N.pts;if(void 0!==q)l.duration=Math.round((H-q)/t);else{var P=Math.round(1e3*(H-B)/r),Q=0;if(c&&a.isAAC&&P){if(P>0&&i>P)Q=Math.round((H-B)/v),h.logger.log(P+" ms hole between AAC samples detected,filling it"),Q>0&&(m=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),m||(m=O.subarray()),a.len+=Q*m.length);else if(-12>P){h.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(B/r).toFixed(3)+"s/"+(H/r).toFixed(3)+"s/"+-P+"ms"),a.len-=O.byteLength;continue}H=B}if(p=H,!(a.len>0))return;var R=y?a.len:a.len+8;k=y?0:8;try{n=new Uint8Array(R)}catch(S){return void this.observer.trigger(f["default"].ERROR,{type:g.ErrorTypes.MUX_ERROR,details:g.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:R,reason:"fail allocating audio mdat "+R})}if(!y){var T=new DataView(n.buffer);T.setUint32(0,R),n.set(e["default"].types.mdat,4)}for(var D=0;Q>D;D++)m=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),m||(h.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),m=O.subarray()),n.set(m,k),k+=m.byteLength,l={size:m.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(l)}n.set(O,k);var U=O.byteLength;k+=U,l={size:U,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(l),q=H}var V=0,W=A.length;if(W>=2&&(V=A[W-2].duration,l.duration=V),W){this.nextAudioPts=B=q+t*V,a.len=0,a.samples=A,o=y?new Uint8Array:e["default"].moof(a.sequenceNumber++,p/t,a),a.samples=[];var X=p/r,Y=B/r,Z={data1:o,data2:n,startPTS:X,endPTS:Y,startDTS:X,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.observer.trigger(f["default"].FRAG_PARSING_DATA,Z),
Z}return null}},a.prototype.remuxEmptyAudio=function(a,b,c,e){var f=a.inputTimeScale,g=a.samplerate?a.samplerate:f,i=f/g,j=this.nextAudioPts,k=(void 0!==j?j:e.startDTS*f)+this._initDTS,l=e.endDTS*f+this._initDTS,m=1024,n=i*m,o=Math.ceil((l-k)/n),p=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(h.logger.warn("remux empty Audio"),!p)return void h.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var q=[],r=0;o>r;r++){var s=k+r*n;q.push({unit:p,pts:s,dts:s}),a.len+=p.length}a.samples=q,this.remuxAudio(a,b,c)},a.prototype.remuxID3=function(a){var b,c=a.samples.length,d=a.inputTimeScale,e=this._initPTS,g=this._initDTS;if(c){for(var h=0;c>h;h++)b=a.samples[h],b.pts=(b.pts-e)/d,b.dts=(b.dts-g)/d;this.observer.trigger(f["default"].FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[]},a.prototype.remuxText=function(a){a.samples.sort(function(a,b){return a.pts-b.pts});var b,c=a.samples.length,d=a.inputTimeScale,e=this._initPTS;if(c){for(var g=0;c>g;g++)b=a.samples[g],b.pts=(b.pts-e)/d;this.observer.trigger(f["default"].FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[]},a.prototype._PTSNormalize=function(a,b){var c;if(void 0===b)return a;for(c=a>b?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a},a}();b["default"]=j},"./src/remux/passthrough-remuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/events.js"),e=function(){function a(a){this.observer=a}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(){},a.prototype.resetInitSegment=function(){},a.prototype.remux=function(a,b,c,e,f,g,h,i){var j=this.observer,k="";a&&(k+="audio"),b&&(k+="video"),j.trigger(d["default"].FRAG_PARSING_DATA,{data1:i,startPTS:f,startDTS:f,type:k,hasAudio:!!a,hasVideo:!!b,nb:1,dropped:0}),j.trigger(d["default"].FRAG_PARSED)},a}();b["default"]=e},"./src/task-loop.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/event-handler.js"),f=function(a){function b(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=a.apply(this,[b].concat(c))||this;return e._tickInterval=null,e._tickTimer=null,e._tickCallCount=0,e._boundTick=e.tick.bind(e),e}return d(b,a),b.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.prototype.hasInterval=function(){return!!this._tickInterval},b.prototype.hasNextTick=function(){return!!this._tickTimer},b.prototype.setInterval=function(a){return this._tickInterval?!1:(this._tickInterval=setInterval(this._boundTick,a),!0)},b.prototype.clearInterval=function(){return this._tickInterval?(clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.prototype.clearNextTick=function(){return this._tickTimer?(clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},b.prototype.doTick=function(){},b}(e["default"]);b["default"]=f},"./src/utils/attr-list.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c=/^(\d+)x(\d+)$/,d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,e=function(){function b(a){"string"==typeof a&&(a=b.parseAttrList(a));for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}return b.prototype.decimalInteger=function(b){var c=parseInt(this[b],10);return c>a.MAX_SAFE_INTEGER?1/0:c},b.prototype.hexadecimalInteger=function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null},b.prototype.hexadecimalIntegerAsNumber=function(b){var c=parseInt(this[b],16);return c>a.MAX_SAFE_INTEGER?1/0:c},b.prototype.decimalFloatingPoint=function(a){return parseFloat(this[a])},b.prototype.enumeratedString=function(a){return this[a]},b.prototype.decimalResolution=function(a){var b=c.exec(this[a]);return null===b?void 0:{width:parseInt(b[1],10),height:parseInt(b[2],10)}},b.parseAttrList=function(a){var b,c={};for(d.lastIndex=0;null!==(b=d.exec(a));){var e=b[2],f='"';0===e.indexOf(f)&&e.lastIndexOf(f)===e.length-1&&(e=e.slice(1,-1)),c[b[1]]=e}return c},b}();b["default"]=e}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;d>=c;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(0>g))return f;d=e-1}}return null}};b["default"]=d},"./src/utils/buffer-helper.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.isBuffered=function(a,b){try{if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0}catch(e){}return!1},a.bufferInfo=function(a,b,c){try{if(a){var d=a.buffered,e=[],f=void 0;for(f=0;f<d.length;f++)e.push({start:d.start(f),end:d.end(f)});return this.bufferedInfo(e,b,c)}}catch(g){}return{len:0,start:b,end:b,nextStart:void 0}},a.bufferedInfo=function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&m>b)e=l,f=m,d=f-b;else if(l>b+c){g=l;break}}return{len:d,start:e,end:f,nextStart:g}},a}();b.BufferHelper=d},"./src/utils/cea-608-parser.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},e=function(a){var b=a;return d.hasOwnProperty(a)&&(b=d[a]),String.fromCharCode(b)},f=15,g=100,h={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},i={17:2,18:4,21:6,22:8,23:10,19:13,20:15},j={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},k={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c}},n=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},o=function(){function a(a,b,c,d,e){this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1}return a.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.prototype.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},a.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.prototype.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},a.prototype.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},a.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),p=function(){function a(a,b,c,d,e,f){this.uchar=a||" ",this.penState=new o(b,c,d,e,f)}return a.prototype.reset=function(){this.uchar=" ",this.penState.reset()},a.prototype.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},a.prototype.setPenState=function(a){this.penState.copy(a)},a.prototype.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},a.prototype.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},a.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),q=function(){function a(){this.chars=[];for(var a=0;g>a;a++)this.chars.push(new p);this.pos=0,this.currPenState=new o}return a.prototype.equals=function(a){for(var b=!0,c=0;g>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;g>b;b++)this.chars[b].copy(a.chars[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;g>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},a.prototype.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(m.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>g&&(m.log("ERROR","Too large cursor position "+this.pos),this.pos=g)},a.prototype.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;b+1>c;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},a.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.prototype.insertChar=function(a){a>=144&&this.backSpace();var b=e(a);return this.pos>=g?void m.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))},a.prototype.clearFromPos=function(a){var b;for(b=a;g>b;b++)this.chars[b].reset()},a.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.prototype.getTextString=function(){for(var a=[],b=!0,c=0;g>c;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},a.prototype.setPenStyles=function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)},a}(),r=function(){function a(){this.rows=[];for(var a=0;f>a;a++)this.rows.push(new q);this.currRow=f-1,this.nrRollUpRows=null,this.reset()}return a.prototype.reset=function(){for(var a=0;f>a;a++)this.rows[a].clear();this.currRow=f-1},a.prototype.equals=function(a){for(var b=!0,c=0;f>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;f>b;b++)this.rows[b].copy(a.rows[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;f>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},a.prototype.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},a.prototype.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},a.prototype.insertChar=function(a){var b=this.rows[this.currRow];b.insertChar(a)},a.prototype.setPen=function(a){var b=this.rows[this.currRow];b.setPenStyles(a)},a.prototype.moveCursor=function(a){var b=this.rows[this.currRow];b.moveCursor(a)},a.prototype.setCursor=function(a){m.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)},a.prototype.setPAC=function(a){m.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;f>c;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var g=e.rows[d].cueStartTime;if(g&&g<m.time)for(var c=0;c<this.nrRollUpRows;c++)this.rows[b-this.nrRollUpRows+c+1].copy(e.rows[d+c])}}this.currRow=b;var h=this.rows[this.currRow];if(null!==a.indent){var i=a.indent,j=Math.max(i-1,0);h.setCursor(a.indent),a.color=h.chars[j].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)},a.prototype.setBkgData=function(a){m.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},a.prototype.setRollUpRows=function(a){this.nrRollUpRows=a},a.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void m.log("DEBUG","roll_up but nrRollUpRows not set yet");m.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),m.log("INFO","Rolling up")},a.prototype.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;f>e;e++){var g=this.rows[e].getTextString();g&&(d=e+1,a?b.push("Row "+d+": '"+g+"'"):b.push(g.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},a.prototype.getTextAndFormat=function(){return this.rows},a}(),s=function(){function a(a,b){this.chNr=a,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new r,this.nonDisplayedMemory=new r,this.lastOutputScreen=new r,this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},a.prototype.getHandler=function(){return this.outputFilter},a.prototype.setHandler=function(a){this.outputFilter=a},a.prototype.setPAC=function(a){this.writeScreen.setPAC(a)},a.prototype.setBkgData=function(a){this.writeScreen.setBkgData(a)},a.prototype.setMode=function(a){a!==this.mode&&(this.mode=a,m.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},a.prototype.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";m.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(m.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.prototype.ccRCL=function(){m.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.prototype.ccBS=function(){m.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.prototype.ccAOF=function(){},a.prototype.ccAON=function(){},a.prototype.ccDER=function(){m.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.prototype.ccRU=function(a){m.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},a.prototype.ccFON=function(){m.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.prototype.ccRDC=function(){m.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.prototype.ccTR=function(){m.log("INFO","TR"),this.setMode("MODE_TEXT")},a.prototype.ccRTD=function(){m.log("INFO","RTD"),this.setMode("MODE_TEXT")},a.prototype.ccEDM=function(){m.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.prototype.ccCR=function(){m.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.prototype.ccENM=function(){m.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.prototype.ccEOC=function(){if(m.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,m.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.prototype.ccTO=function(a){m.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},a.prototype.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}m.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},a.prototype.outputDataUpdate=function(a){void 0===a&&(a=!1);var b=m.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),a===!0&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},a.prototype.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},a}(),t=function(){function a(a,b,c){this.field=a||1,this.outputs=[b,c],this.channels=[new s(1,b),new s(2,c)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return a.prototype.getHandler=function(a){return this.channels[a].getHandler()},a.prototype.setHandler=function(a,b){this.channels[a].setHandler(b)},a.prototype.addData=function(a,b){var c,d,e,f=!1;this.lastTime=a,m.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(m.log("DATA","["+n([b[g],b[g+1]])+"] -> ("+n([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else m.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,m.log("WARNING","Couldn't parse cleaned data "+n([d,e])+" orig: "+n([b[g],b[g+1]])))}else this.dataCounters.padding+=2},a.prototype.parseCmd=function(a,b){var c=null,d=(20===a||28===a)&&b>=32&&47>=b,e=(23===a||31===a)&&b>=33&&35>=b;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,m.log("DEBUG","Repeated command ("+n([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.parseMidrow=function(a,b){var c=null;if((17===a||25===a)&&b>=32&&47>=b){if(c=17===a?1:2,c!==this.currChNr)return m.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),m.log("DEBUG","MIDROW ("+n([a,b])+")"),!0}return!1},a.prototype.parsePAC=function(a,b){var c=null,d=null,e=(a>=17&&23>=a||a>=25&&31>=a)&&b>=64&&127>=b,f=(16===a||24===a)&&b>=64&&95>=b;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=23>=a?1:2,d=b>=64&&95>=b?1===c?h[a]:j[a]:1===c?i[a]:k[a];var g=this.interpretPAC(d,b),l=this.channels[c-1];return l.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.interpretPAC=function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),13>=c?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:15>=c?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},a.prototype.parseChars=function(a,b){var c=null,d=null,f=null;if(a>=25?(c=2,f=a-8):(c=1,f=a),f>=17&&19>=f){var g=b;g=17===f?b+80:18===f?b+112:b+144,m.log("INFO","Special char '"+e(g)+"' in channel "+c),d=[g]}else a>=32&&127>=a&&(d=0===b?[a]:[a,b]);if(d){var h=n(d);m.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d},a.prototype.parseBackgroundAttributes=function(a,b){var c,d,e,f,g=(16===a||24===a)&&b>=32&&47>=b,h=(23===a||31===a)&&b>=45&&47>=b;return g||h?(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=l[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=24>a?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0):!1},a.prototype.reset=function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null},a.prototype.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)},a}();b["default"]=t},"./src/utils/codecs.js":function(a,b,c){"use strict";function d(a,b){var c=f[b];return!!c&&c[a.slice(0,4)]===!0}function e(a,b){return window.MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}Object.defineProperty(b,"__esModule",{value:!0});var f={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};b.isCodecType=d,b.isCodecSupportedInMp4=e},"./src/utils/cues.js":function(a,b,c){"use strict";function d(a,b,c,d){for(var f,g,h,i,j,k=window.VTTCue||window.TextTrackCue,l=0;l<d.rows.length;l++)if(f=d.rows[l],h=!0,i=0,j="",!f.isEmpty()){for(var m=0;m<f.chars.length;m++)f.chars[m].uchar.match(/\s/)&&h?i++:(j+=f.chars[m].uchar,h=!1);f.cueStartTime=b,b===c&&(c+=1e-4),g=new k(b,c,e.fixLineBreaks(j.trim())),i>=16?i--:i++,navigator.userAgent.match(/Firefox\//)?g.line=l+1:g.line=l>7?l-2:l+1,g.align="left",g.position=Math.max(0,Math.min(100,100*(i/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(g)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/vttparser.js");b.newCue=d},"./src/utils/discontinuities.js":function(a,b,c){"use strict";(function(a){function d(a,b){for(var c=null,d=0;d<a.length;d+=1){var e=a[d];if(e&&e.cc===b){c=e;break}}return c}function e(a,b){return l["default"].search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}function f(a,b,c){var d=!1;return b&&b.details&&c&&(c.endCC>c.startCC||a&&a.cc<c.startCC)&&(d=!0),d}function g(a,b){var c=a.fragments,e=b.fragments;if(!e.length||!c.length)return void m.logger.log("No fragments to align");var f=d(c,e[0].cc);return!f||f&&!f.startPTS?void m.logger.log("No frag in previous level to align on"):f}function h(a,b){b.fragments.forEach(function(b){if(b){var c=b.start+a;b.start=b.startPTS=c,b.endPTS=c+b.duration}}),b.PTSKnown=!0}function i(a,b,c){j(a,c,b),!c.PTSKnown&&b&&k(c,b.details)}function j(a,b,c){if(f(a,c,b)){var d=g(c.details,b);d&&(m.logger.log("Adjusting PTS using last level due to CC increase within current level"),h(d.start,b))}}function k(b,c){if(c&&c.fragments.length){if(!b.hasProgramDateTime||!c.hasProgramDateTime)return;var d=c.fragments[0].programDateTime,e=b.fragments[0].programDateTime,f=(e-d)/1e3+c.fragments[0].start;a.isFinite(f)&&(m.logger.log("adjusting PTS using programDateTime delta, sliding:"+f.toFixed(3)),h(f,b))}}Object.defineProperty(b,"__esModule",{value:!0});var l=c("./src/utils/binary-search.js"),m=c("./src/utils/logger.js");b.findFirstFragWithCC=d,b.findFragWithCC=e,b.shouldAlignOnDiscontinuities=f,b.findDiscontinuousReferenceFrag=g,b.adjustPts=h,b.alignStream=i,b.alignDiscontinuities=j,b.alignPDT=k}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/ewma.js"),e=function(){function a(a,b,c,e){this.hls=a,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new d["default"](b),this.fast_=new d["default"](c)}return a.prototype.sample=function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)},a.prototype.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},a.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.prototype.destroy=function(){},a}();b["default"]=e},"./src/utils/ewma.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a){this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=0,this.totalWeight_=0}return a.prototype.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},a.prototype.getTotalWeight=function(){return this.totalWeight_},a.prototype.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_},a}();b["default"]=d},"./src/utils/get-self-scope.js":function(a,b,c){"use strict";function d(){return"undefined"==typeof window?self:window}Object.defineProperty(b,"__esModule",{value:!0}),b.getSelfScope=d},"./src/utils/logger.js":function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=k.console[a];return b?function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c[0]&&(c[0]=e(a,c[0])),b.apply(k.console,c)}:d}function g(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];b.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}Object.defineProperty(b,"__esModule",{value:!0});var h=c("./src/utils/get-self-scope.js"),i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i,k=h.getSelfScope();b.enableLogs=function(a){if(a===!0||"object"==typeof a){g(a,"debug","log","info","warn","error");try{j.log()}catch(b){j=i}}else j=i},b.logger=j},"./src/utils/mediakeys-helper.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();b.requestMediaKeySystemAccess=d},"./src/utils/mediasource-helper.js":function(a,b,c){"use strict";function d(){return"undefined"!=typeof window?window.MediaSource||window.WebKitMediaSource:void 0}Object.defineProperty(b,"__esModule",{value:!0}),b.getMediaSource=d},"./src/utils/output-filter.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.timelineController=a,this.trackName=b,this.startTime=null,this.endTime=null,this.screen=null}return a.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},a.prototype.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},a}();b["default"]=d},"./src/utils/texttrack-utils.js":function(a,b,c){"use strict";function d(a,b){var c=null;try{c=new window.Event("addtrack")}catch(d){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)}function e(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}Object.defineProperty(b,"__esModule",{value:!0}),b.sendAddTrackEvent=d,b.clearCurrentCues=e},"./src/utils/time-ranges.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={toString:function(a){for(var b="",c=a.length,d=0;c>d;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}};b["default"]=d},"./src/utils/vttcue.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(){function a(a){if("string"!=typeof a)return!1;var b=f[a.toLowerCase()];return b?a.toLowerCase():!1}function b(a){if("string"!=typeof a)return!1;var b=g[a.toLowerCase()];return b?a.toLowerCase():!1}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function d(d,f,g){var h=this,i=function(){return"undefined"!=typeof navigator?/MSIE\s8\.0/.test(navigator.userAgent):void 0}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=d,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";return Object.defineProperty(h,"id",c({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",c({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",c({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",c({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",c({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",c({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",c({},j,{get:function(){return q},set:function(b){var c=a(b);if(c===!1)throw new SyntaxError("An invalid or illegal string was specified.");q=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",c({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",c({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==e)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",c({},j,{get:function(){return t},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",c({},j,{get:function(){return u},set:function(a){if(0>a||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",c({},j,{get:function(){return v},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",c({},j,{get:function(){return w},set:function(a){if(0>a||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",c({},j,{get:function(){return x},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i?h:void 0}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",f={"":!0,lr:!0,rl:!0},g={start:!0,middle:!0,end:!0,left:!0,right:!0};return d.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text);
},d}()},"./src/utils/vttparser.js":function(a,b,c){"use strict";function d(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new k,this.regionList=[]}function e(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function f(){this.values=Object.create(null)}function g(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function h(a,b,c){function d(){var b=e(a);if(null===b)throw new Error("Malformed timestamp: "+j);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function h(a,b){var d=new f;g(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",m,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",m,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",m,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var e=d.get("line","auto");"auto"===e&&-1===l.line&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",m);var h=d.get("position","auto");"auto"===h&&50===l.position&&(h="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=h}function i(){a=a.replace(/^\s+/,"")}var j=a;if(i(),b.startTime=d(),i(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+j);a=a.substr(3),i(),b.endTime=d(),i(),h(a,b)}function i(a){return a.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(b,"__esModule",{value:!0});var j=c("./src/utils/vttcue.js"),k=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};f.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){var c;return(c=b.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(b=parseFloat(b),b>=0&&100>=b)?(this.set(a,b),!0):!1}};var l=new j["default"](0,0,0),m="middle"===l.align?"middle":"center";b.fixLineBreaks=i,d.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=i(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){g(a,function(a,b){switch(a){case"Region":}},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e=void 0;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;e=b();var f=e.match(/^()?WEBVTT([ \t].*)?$/);if(!f||!f[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var k=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(k?k=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new j["default"](0,0,""),d.state="CUE",-1===e.indexOf("-->")){d.cue.id=e;continue}case"CUE":try{h(e,d.cue,d.regionList)}catch(l){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var m=-1!==e.indexOf("-->");if(!e||m&&(k=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(l){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(b){throw b}return a.onflush&&a.onflush(),this}},b["default"]=d},"./src/utils/webvtt-parser.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/vttparser.js"),e=c("./src/demux/id3.js"),f=function(a,b,c){return a.substr(c||0,b.length)===b},g=function(b){var c=parseInt(b.substr(-3)),d=parseInt(b.substr(-6,2)),e=parseInt(b.substr(-9,2)),f=b.length>9?parseInt(b.substr(0,b.indexOf(":"))):0;return a.isFinite(c)&&a.isFinite(d)&&a.isFinite(e)&&a.isFinite(f)?(c+=1e3*d,c+=6e4*e,c+=36e5*f):-1},h=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return(b>>>0).toString()},i=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e["new"]&&d["new"])return a.ccOffset=a.presentationOffset=d.start,void(d["new"]=!1);for(;e&&e["new"];)a.ccOffset+=d.start-e.start,d["new"]=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},j={parse:function(a,b,c,j,k,l){var m,n=/\r\n|\n\r|\n|\r/g,o=e.utf8ArrayToStr(new Uint8Array(a)).trim().replace(n,"\n").split("\n"),p="00:00.000",q=0,r=0,s=0,t=[],u=!0,v=new d["default"];v.oncue=function(a){var b=c[j],d=c.ccOffset;b&&b["new"]&&(void 0!==r?d=c.ccOffset=b.start:i(c,j,s)),s&&(d=s-c.presentationOffset),a.startTime+=d-r,a.endTime+=d-r,a.id=h(a.startTime.toString())+h(a.endTime.toString())+h(a.text),a.text=decodeURIComponent(encodeURIComponent(a.text)),a.endTime>0&&t.push(a)},v.onparsingerror=function(a){m=a},v.onflush=function(){return m&&l?void l(m):void k(t)},o.forEach(function(a){if(u){if(f(a,"X-TIMESTAMP-MAP=")){u=!1,a.substr(16).split(",").forEach(function(a){f(a,"LOCAL:")?p=a.substr(6):f(a,"MPEGTS:")&&(q=parseInt(a.substr(7)))});try{b+(9e4*c[j].start||0)<0&&(b+=8589934592),q-=b,r=g(p)/1e3,s=q/9e4,-1===r&&(m=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(d){m=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(u=!1)}v.parse(a+"\n")}),v.flush()}};b["default"]=j}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=window.performance,f=window.XMLHttpRequest,g=function(){function a(a){a&&a.xhrSetup&&(this.xhrSetup=a.xhrSetup)}return a.prototype.destroy=function(){this.abort(),this.loader=null},a.prototype.abort=function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.prototype.load=function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:e.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()},a.prototype.loadInternal=function(){var a,b=this.context;a=this.loader=new f;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;try{if(d)try{d(a,b.url)}catch(e){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(e){return void this.callbacks.onError({code:a.status,text:e.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},a.prototype.readystatechange=function(a){var b=a.currentTarget,c=b.readyState,f=this.stats,g=this.context,h=this.config;if(!f.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===f.tfirst&&(f.tfirst=Math.max(e.now(),f.trequest)),4===c){var i=b.status;if(i>=200&&300>i){f.tload=Math.max(f.tfirst,e.now());var j=void 0,k=void 0;"arraybuffer"===g.responseType?(j=b.response,k=j.byteLength):(j=b.responseText,k=j.length),f.loaded=f.total=k;var l={url:b.responseURL,data:j};this.callbacks.onSuccess(l,f,g,b)}else f.retry>=h.maxRetry||i>=400&&499>i?(d.logger.error(i+" while loading "+g.url),this.callbacks.onError({code:i,text:b.statusText},g,b)):(d.logger.warn(i+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),f.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),h.timeout)},a.prototype.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.prototype.loadprogress=function(a){var b=a.currentTarget,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null,b)},a}();b["default"]=g}})["default"]})},{}],3:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&"undefined"!=typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof d?d:"undefined"!=typeof self?self:this,e.teltoo_hlsjs_module=a()}}(function(){return function(){function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b||a)},l,l.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}return b}()({1:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){if(d(this,a),b){if(b.levels){this.levels=[];for(var c in b.levels)this.levels[c]=b.levels[c]}b.audioTracks&&(this.audioTracks=b.audioTracks),b.playbackInstance&&(this.playbackInstance=b.playbackInstance),b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}}return e(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var a=void 0,b=this.context,c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;if(this.playbackInstance){var e="VIDEO",f=0;"main"===b.frag.type?(e="VIDEO",this.levels&&this.levels[b.frag.level]&&(f=this.levels[b.frag.level].bitrate)):"video"===b.frag.type?(e=b.frag.type,this.levels&&this.levels[b.frag.level]&&(f=this.levels[b.frag.level].bitrate)):"audio"===b.frag.type?(e=b.frag.type,this.audioLevels&&this.audioLevels[b.frag.level]&&(f=this.audioLevels[b.frag.level].bitrate)):a="subtitle"===b.frag.type?this.loader=new XMLHttpRequest:this.loader=new XMLHttpRequest,a||(f=f||0,a=this.loader=this.playbackInstance.downloadWithTeltoo(b.url,b.frag.duration,e,f))}a||(a=this.loader=new XMLHttpRequest);try{if(d)try{d(a,b.url)}catch(g){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(g){return void this.callbacks.onError({code:a.status,text:g.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}},{key:"readystatechange",value:function(a){var b=a.target,c=b.readyState,d=this.stats,e=this.context,f=this.config;if(!d.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c){var g=b.status;if(g>=200&&300>g){d.tload=Math.max(d.tfirst,performance.now());var h=void 0,i=void 0;"arraybuffer"===e.responseType?(h=b.response,i=h.byteLength):(h=b.responseText,i=h.length),d.loaded=d.total=i;var j={url:b.responseURL,data:h};this.callbacks.onSuccess(j,d,e,b)}else d.retry>=f.maxRetry||g>=400&&499>g?this.callbacks.onError({code:g,text:b.statusText},e,b):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,f.maxRetryDelay),d.retry=d.retry+1)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),f.timeout)}},{key:"loadtimeout",value:function(){this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function(a){var b=a.target,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null,b)}}]),a}();c["default"]=f},{}],2:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){var b={},c=function(a){this._super.call(this,this.config),a.fLoader=i["default"],this.playbackInstance=a.playbackInstance,a.teltooDisabled===!0&&this.playbackInstance.disableTeltoo()};c.prototype=Object.create(a.DefaultConfig.loader.prototype),c.prototype.constructor=c,c.prototype._super=a.DefaultConfig.loader,c.prototype.load=function(a,b,c){"manifest"===a.type?(this.playbackInstance.setPlaylistUrl(a.url),this._super.prototype.load.call(this,a,b,c)):"subtitleTrack"===a.type?this._super.prototype.load.call(this,a,b,c):this._super.prototype.load.call(this,a,b,c)};var d=function(b){function c(){if(d&&d.length>0){var a=d.length-1;e.autoLevelCapping>=0&&(a=e.autoLevelCapping);for(var b=[],c=0;a>=c;c+=1)b.push(d[c].bitrate);b.length>0&&e.config.playbackInstance.setAvailableBitratesPerTrackType("VIDEO",b)}}var d,e=b,f=-1;return e.disableTeltoo=function(){e.config.teltooDisabled=!0},e.config.playbackInstance||(e.config.playbackInstance=teltoo.playbackInstance()),e.on(a.Events.MEDIA_ATTACHED,function(){this.stallMonitor=g["default"](e.config.playbackInstance,e.media)}),e.on(a.Events.MEDIA_DETACHING,function(){this.stallMonitor&&(this.stallMonitor.destroy(),this.stallMonitor=void 0)}),e.on(a.Events.MANIFEST_PARSED,function(a,b){d=b.levels,e.config.levels=JSON.parse(JSON.stringify(b.levels)),e.config.audioTracks=JSON.parse(JSON.stringify(b.audioTracks)),c()}),e.on(a.Events.FRAG_LOADING,function(a,b){e.autoLevelCapping!==f&&(c(),f=e.autoLevelCapping)}),this.destroy=function(){e.config.playbackInstance&&(e.config.playbackInstance.dispose(),e.config.playbackInstance=void 0),this._super.prototype.destroy.call(this)},this._super(e)};return d.prototype=Object.create(a.DefaultConfig.abrController.prototype),d.prototype.constructor=d,d.prototype._super=a.DefaultConfig.abrController,a.isTeltooPlaybackSupported=function(){var a=teltoo.isP2PSupported(),b="undefined"!=typeof window.MediaSource;return b&&a},a.isTeltooPlaybackSupported()&&(a.DefaultConfig.pLoader=c,a.DefaultConfig.abrController=d),b.uninstall=function(){a.DefaultConfig.pLoader=void 0,a.DefaultConfig.abrController=void 0},b}Object.defineProperty(c,"__esModule",{value:!0}),c.install=void 0;var f=a(3),g=d(f),h=a(1),i=d(h);c.install=e,c["default"]=e},{1:1,3:3}],3:[function(a,b,c){"use strict";function d(a,b){function c(a){l=j.PLAYING}function d(a){l=j.ERROR}function e(c){this.currentTime!==n&&(n=this.currentTime,clearTimeout(h),h=void 0,l===j.STALLED?(l=j.PLAYING,void 0===g||((performance.now()-g)/1e3,g=void 0,a.stallEnd())):l===j.PLAYING?h=setTimeout(f,k):l===j.IDLE&&(l=j.PLAYING),m=b.currentTime)}function f(){b.currentTime===m&&0!==m&&(b.paused||b.ended||b.seeking||l===j.ERROR||void 0!==g||(g=performance.now(),l=j.STALLED,a.stallStart()))}var g,h,i={},j={IDLE:"idle",PLAYING:"playing",ERROR:"error",STALLED:"stalled"},k=256,l=j.IDLE,m=0,n=0;return i.destroy=function(){b.removeEventListener("error",d),b.removeEventListener("play",c),b.removeEventListener("timeupdate",e),h&&clearTimeout(h)},b.addEventListener("error",d),b.addEventListener("play",c),b.addEventListener("timeupdate",e),i}Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d},{}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){function d(a){var b=this;a&&(b.srOptions_||(b.srOptions_={}),b.srOptions_.hlsjsConfig||(b.srOptions_.hlsjsConfig=a.hlsjsConfig),b.srOptions_.captionConfig||(b.srOptions_.captionConfig=a.captionConfig))}var e=a(2),f=function(a){function b(b,d){function f(a){if(void 0!==c[a])for(var b=0;b<c[a].length;b++)c[a][b](K,B)}function g(a){1===D[e.ErrorTypes.MEDIA_ERROR]?B.recoverMediaError():2===D[e.ErrorTypes.MEDIA_ERROR]?(B.swapAudioCodec(),B.recoverMediaError()):D[e.ErrorTypes.MEDIA_ERROR]>2&&(d.error=function(){return a},d.trigger("error"))}function h(a,b){var c={message:"HLS.js error: "+b.type+" - fatal: "+b.fatal+" - "+b.details};if(D[b.type]?D[b.type]+=1:D[b.type]=1,b.fatal)switch(b.type){case e.ErrorTypes.NETWORK_ERROR:c.code=2,d.error=function(){return c},d.trigger("error");break;case e.ErrorTypes.MEDIA_ERROR:c.code=3,g(c);break;default:B.destroy(),d.error=function(){return c},d.trigger("error")}}function i(a){B.nextLevel=a}function j(a){return a.height?a.height+"p":a.width?Math.round(9*a.width/16)+"p":a.bitrate?a.bitrate/1e3+"kbps":0}function k(a){for(var b=!0,c=0;c<a.length;c++)if(!a[c]._enabled){b=!1;break}if(b)B.currentLevel=-1;else{var d;for(d=a.length-1;d>=0&&!a[d]._enabled;d--);B.currentLevel=d}}function l(a,b){return"boolean"==typeof b&&(this[a]._enabled=b,k(this)),this[a]._enabled}function m(){if(F){var a=K.qualityLevels&&K.qualityLevels();if(a)for(var b=0;b<F.levels.length;b++){var c=F.levels[b],d={id:b,width:c.width,height:c.height,bandwidth:c.bitrate,bitrate:c.bitrate,_enabled:!0};d.enabled=l.bind(a,b),a.addQualityLevel(d)}}}function n(){if(F){var a=[];if(F.levels.length>1){var b={id:-1,label:"auto",selected:-1===B.manualLevel};a.push(b)}F.levels.forEach(function(b,c){var d={};d.id=c,d.selected=c===B.manualLevel,d.label=j(b),a.push(d)});var c={qualityData:{video:a},qualitySwitchCallback:i};d.trigger("loadedqualitydata",c),C.removeEventListener("playing",n)}}function o(){for(var a=d.audioTracks(),b=0;b<a.length;b++)if(a[b].enabled){B.audioTrack=b;break}}function p(){var b=B.audioTracks,c=d.audioTracks();if(b.length>1&&0===c.length){for(var e=0;e<b.length;e++)c.addTrack(new a.AudioTrack({id:e,kind:"alternative",label:b[e].name||b[e].lang,language:b[e].lang,enabled:e===B.audioTrack}));c.addEventListener("change",o)}}function q(a){var b=a.label?a.label:a.language;return b}function r(a,b){return q(a)===q(b)&&a.kind===b.kind}function s(){for(var a=K.textTracks(),b=null,c=0;c<a.length;c++)if("showing"===a[c].mode){b=a[c];break}for(var d=C.textTracks,e=0;e<d.length;e++)("subtitles"===d[e].kind||"captions"===d[e].kind)&&(d[e].mode=b&&r(d[e],b)?"showing":"disabled")}function t(){B.startLoad(-1),C.removeEventListener("play",t)}function u(a){for(var b={},c=Object.keys(a),d=0;d<c.length;d++)b[c[d]]=a[c[d]];return b}function v(a){for(var b=[],c=0;c<a.length;c++)("subtitles"===a[c].kind||"captions"===a[c].kind)&&b.push(a[c]);return b}function w(){for(var a=v(C.textTracks),b=K.textTracks(),c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)if(r(a[c],b[e])){d=!0;break}if(!d){var f=a[c];K.addRemoteTextTrack({kind:f.kind,label:q(f),language:f.language,srclang:f.language},!1)}}s(),L||(b.addEventListener("change",s),L=!0)}function x(a,b){F=b,m()}function y(a){return{newCue:function(b,c,d,e){for(var f,g,h,i=window.VTTCue||window.TextTrackCue,j=0;j<e.rows.length;j++)if(f=e.rows[j],h="",!f.isEmpty()){for(var k=0;k<f.chars.length;k++)h+=f.chars[k].uchar;if(g=new i(c,d,h.trim()),null!=a&&"object"==typeof a)for(var l=Object.keys(a),m=0;m<l.length;m++)g[l[m]]=a[l[m]];b.addCue(g),d===c&&b.addCue(new i(d+5,""))}}}}function z(){var a=K.srOptions_&&K.srOptions_.hlsjsConfig||d.options_.hlsjsConfig;J=a?u(a):{},-1!==["","auto"].indexOf(C.preload)||C.autoplay||void 0!==J.autoStartLoad||(J.autoStartLoad=!1);var c=K.srOptions_&&K.srOptions_.captionConfig||d.options_.captionConfig;c&&(J.cueHandler=y(c)),J.autoStartLoad===!1&&C.addEventListener("play",t),C.addEventListener("playing",n),B=new e(J),f("beforeinitialize"),B.on(e.Events.ERROR,function(a,b){h(a,b,d,D)}),B.on(e.Events.AUDIO_TRACKS_UPDATED,p),B.on(e.Events.MANIFEST_PARSED,x),B.on(e.Events.LEVEL_LOADED,function(a,b){J.liveSyncDuration?I=J.liveSyncDuration:J.liveSyncDurationCount&&(I=J.liveSyncDurationCount*b.details.targetduration),G=b.details.live,H=b.details.totalduration,E=G?1/0:b.details.totalduration}),B.once(e.Events.FRAG_LOADED,function(){d.trigger("loadedmetadata")}),B.attachMedia(C),C.textTracks.addEventListener("addtrack",w),B.loadSource(b.src)}function A(){z()}d.name_="Hlsjs";var B,C=d.el(),D={},E=null,F=null,G=null,H=null,I=null,J=null,K=a(d.options_.playerId),L=!1;this.duration=function(){return E||C.duration||0},this.seekable=function(){if(B.media){if(!G)return a.createTimeRanges(0,B.media.duration);var b=Math.round(B.media.duration-H),c=Math.round(B.media.duration-I);return a.createTimeRanges(b,c)}return a.createTimeRanges()},this.dispose=function(){C.removeEventListener("play",t),C.textTracks.removeEventListener("addtrack",w),C.removeEventListener("playing",n),K.textTracks().removeEventListener("change",s),L=!1,K.audioTracks().removeEventListener("change",o),B.destroy()},C.addEventListener("error",function(a){var b,c=a.currentTarget.error;switch(c.code){case c.MEDIA_ERR_ABORTED:b="You aborted the video playback";break;case c.MEDIA_ERR_DECODE:b="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",g(c);break;case c.MEDIA_ERR_NETWORK:b="A network error caused the video download to fail part-way";break;case c.MEDIA_ERR_SRC_NOT_SUPPORTED:b="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:b=c.message}}),A()}var c={};if(b.addHook=function(a,b){c[a]=c[a]||[],c[a].push(b)},b.removeHook=function(a,b){if(void 0===c[a])return!1;var d=c[a].indexOf(b);return-1===d?!1:(c[a].splice(d,1),!0)},e.isSupported()){var d;if("function"==typeof a.getTech)d=a.getTech("Html5");else{if("function"!=typeof a.getComponent)return;d=a.getComponent("Html5")}if(!d)return;d.registerSourceHandler({canHandleSource:function(a){var b,c=/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i,d=/\.m3u8/i;return b=c.test(a.type)?"probably":d.test(a.src)?"maybe":""},handleSource:function(a,c){return c.hlsProvider&&c.hlsProvider.dispose(),c.hlsProvider=new b(a,c),c.hlsProvider}},0),a.Html5Hlsjs=b}},g=function(a){var b=a.registerPlugin||a.plugin;b("Hlsjs",d)};window&&(window.Hls=e),b.exports={registerSourceHandler:f,registerConfigPlugin:g}},{2:2}]},{},[1]);