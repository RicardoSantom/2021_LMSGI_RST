/*! teltoo 1.0.0 Copyright (c) Teltoo S.L. - All rights reserved (18-06-20 14:36:06 UTC) */

!function(e){var t,n={},r=[],o=[];function i(e){for(var t=n.getStats(),r=0;r<o.length;r++)o[r](t)}n.addClientMiddleware=function(e){r.push(e),o.length>0&&e.addEventListener("metrics",i)},n.removeClientMiddleware=function(e){for(var t=0;t<r.length;t++)e===r[t]&&r.splice(t,1)},n.getStats=function(){for(var e={players:0,peers:0,totalReceivedBytes:0,p2pReceivedBytes:0,cacheReceivedBytes:0,requestWithoutTeltoo:0},t=0;t<r.length;t++){e.players++;var n=r[t].getStats();if(n)for(var o in n)e[o]=e[o]+n[o]}return e},n.on=function(e,t){if("metrics"===e){o.push(t);for(var n=0;n<r.length;n++)r[n].addEventListener("metrics",i)}},n.off=function(e,t){if("metrics"===e)for(var n=0;n<o.length;n++)t===o[n]&&o.splice(n,1)},n.isP2PSupported=function(){var e=!0;for(var t in teltoo.Modernizr)teltoo.Modernizr.hasOwnProperty(t)&&(e&=teltoo.Modernizr[t]);return e},n.startProbe=function(e){if(!t){var n=teltoo.clientMiddlewareSession();(t=teltoo.sharedFile(e,n)).segmentType="PROBE"}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=n),exports.teltoo=n):e.teltoo=n}(this),teltoo.utils={eventualize:function(e){var t={};function n(e,t,n){e.apply(t,n)}e.addEventListener=function(e,r){if("string"!=typeof e)throw new Error("invalid eventType: "+e);if("function"!=typeof r)throw new Error("invalid listener: "+r);var o,i=t[e]&&t[e].listeners;i||(t[e]||(t[e]={}),t[e].listeners=[],i=t[e].listeners),i.push(r),(o=t[e].postAdditionProcess)&&n(o,void 0,[e,r])},e.setPostAdditionProcessor=function(e,n){if("string"!=typeof e)throw new Error("invalid eventType: "+e);if("function"!=typeof n)throw new Error("invalid processor function: "+n);t[e]||(t[e]={}),t[e].postAdditionProcess=n},e.removePostAdditionProcessor=function(e){if("string"!=typeof e)throw new Error("invalid eventType: "+e);t[e]&&(t[e].postAdditionProcess=void 0)},e.dispatchEvent=function(r){if("string"!=typeof r)throw new Error("invalid eventType: "+r);var o=t[r]&&t[r].listeners,i=t[""]&&t[""].listeners;if(o=o?o.concat(i):i)for(var a,s=Array.prototype.slice.call(arguments,1),c=0;a=o[c];c++)n(a,e,s);else;},e.removeEventListener=function(e,n){if(void 0===e&&void 0===n)t={};else{if("string"!=typeof e)throw new Error("invalid eventType: "+e);var r=t[e]&&t[e].listeners;if(r)if(void 0===n)delete t[e].listeners,t[e].postAdditionProcess||delete t[e];else{for(var o=0;r[o]&&n!==r[o];o++);r[o]&&(r.splice(o,1),0===r.length&&(delete t[e].listeners,t[e].postAdditionProcess||delete t[e]))}else;}}},mixin:function(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})},getApiKey:function(){var e=function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++)if(e[t].hasAttribute("data-teltoo-api-key"))return e[t]}(),t="";return e&&(t=e.getAttribute("data-teltoo-api-key")),t}},function(e){if("undefined"==typeof window)var t=require("string_decoder").StringDecoder;var n={INTEGER_32:0,U_INTEGER_32:1,FLOAT:2,STRING:3,BOOLEAN:4,ENUM:5,OBJECT:6,ARRAY_U_INTEGER_32:7,ARRAY_STRING:8,ARRAYBUFFER:9};e.serializerWithDictionary={TYPES:n,create:function(e,r){var o={},i={},a=!0,s=255;function c(t){if(t.type){var r=0;return r+=1,r+=function e(t,r){var o=0;for(var i in r)if(t[i]){o+=1;var a=t[i].type;if(a===n.BOOLEAN)o+=1;else if(a===n.INTEGER_32||a===n.U_INTEGER_32)o+=4;else if(a===n.FLOAT)o+=8;else if(a===n.STRING){o+=4;var s=0;r[i]&&(s=u(r[i]).length),o+=s}else if(a===n.ENUM)o+=1;else if(a===n.OBJECT)o+=e(t[i].parameters,r[i]),o+=1;else if(a===n.ARRAY_U_INTEGER_32)o+=4,o+=4*r[i].length;else if(a===n.ARRAY_STRING){o+=4;for(var c=r[i].length,d=0;d<c;d++)o+=4,o+=u(r[i][d]).length}else{if(a!==n.ARRAYBUFFER)throw new Error("[serializerWithDictionary]: getObjectLen: got invalid parameterType: ",a);o+=4,o+=r[i].byteLength}}else if("type"===i);else if("function"!=typeof r[i])throw new Error("[serializerWithDictionary]: getObjectLen: parameter not found:"+i+":"+typeof r[i]);return o}(e[t.type].parameters,t)}throw new Error("[serializerWithDictionary]: getMessageLen: message.type undefined")}function d(e){var t={};for(var n in e){var r=e[n];if(255===r)throw new Error("[signallingProtocolSerializer]: invalid enum code 0xFF: it is reserved");t[r]=n}return t}function l(e,t){for(var r in t=t||{},e){var o=e[r];if(255===o.code)throw new Error("[signallingProtocolSerializer]: invalid parameter code 0xFF: it is reserved");t[o.code]={parameterName:r},o.type===n.ENUM?t[o.code].enum=d(o.values):o.type===n.OBJECT&&(t[o.code].object=l(o.parameters))}return t}function u(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):"undefined"!=typeof Buffer?new Uint8Array(Buffer.from(e,"utf8")):new Uint8Array(function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}(e))}function p(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):"undefined"!=typeof Buffer?(new t).write(Buffer.from(e)):function(e){var t,n="";for(t=0;t<e.length;t++){var r=e[t];if(r<128)n+=String.fromCharCode(r);else if(r>191&&r<224)n+=String.fromCharCode((31&r)<<6|63&e[t+1]),t+=1;else if(r>223&&r<240)n+=String.fromCharCode((15&r)<<12|(63&e[t+1])<<6|63&e[t+2]),t+=2;else{var o=((7&r)<<18|(63&e[t+1])<<12|(63&e[t+2])<<6|63&e[t+3])-65536;n+=String.fromCharCode(o>>10|55296,1023&o|56320),t+=3}}return n}(e)}for(var f in r=void 0===r||r,o.messageToArrayBuffer=function(t){if(t.type){var o=c(t),i=new ArrayBuffer(o),d=0,l=new DataView(i,d);return l.setUint8(d,e[t.type].code,a),d+=1,d+=function e(t,o,i,c,d,l){for(var p in o)if(t[p]){d.setUint8(c,t[p].code,a),c+=1;var f=t[p].type;if(f===n.BOOLEAN){if(r&&"boolean"!=typeof o[p])throw new Error("serializerWithDictionary parameter: "+p+" MUST be a boolean");d.setInt8(c,o[p],a),c+=1}else if(f===n.INTEGER_32||f===n.U_INTEGER_32){if(r&&"number"!=typeof o[p])throw new Error("serializerWithDictionary parameter: "+p+" MUST be a number: "+typeof o[p]);f===n.INTEGER_32?d.setInt32(c,o[p],a):d.setUint32(c,o[p],a),c+=4}else if(f===n.FLOAT){if(r&&"number"!=typeof o[p])throw new Error("serializerWithDictionary parameter: "+p+" MUST be a number");d.setFloat64(c,o[p],a),c+=8}else if(f===n.STRING){if(r&&"string"!=typeof o[p]&&void 0!==o[p])throw new Error("serializerWithDictionary parameter: "+p+" MUST be a string");var v,g=u(o[p]);v=g?g.length:0,d.setInt32(c,v,a),c+=4;for(var m=0;m<v;m++){var y=g[m];d.setUint8(c,y,a),c+=1}}else if(f===n.ENUM){if(r){if("string"!=typeof o[p])throw new Error("serializerWithDictionary parameter: "+p+" MUST be a string");if("number"!=typeof t[p].values[o[p]])throw new Error("serializerWithDictionary parameter: "+p+" ENUM value is not defined")}var h=t[p].values[o[p]];d.setInt8(c,h,a),c+=1}else if(f===n.OBJECT){if(r&&"object"!=typeof o[p]&&void 0!==o[p])throw new Error("serializerWithDictionary parameter: "+p+" MUST be a object :"+typeof o[p]);c=e(t[p].parameters,o[p],i,c,d,!0)}else if(f===n.ARRAY_U_INTEGER_32){if(r&&typeof o[p].constructor===Array)throw new Error("serializerWithDictionary parameter: "+p+" MUST be a array");var b=o[p].length;d.setUint32(c,b,a),c+=4;for(var E=0;E<b;E++){if(r&&"number"!=typeof o[p][E])throw new Error("serializerWithDictionary parameter: "+p+" ARRAY_U_INTEGER_32 element MUST be a number");d.setUint32(c,o[p][E],a),c+=4}}else if(f===n.ARRAY_STRING){if(r&&typeof o[p].constructor===Array)throw new Error("serializerWithDictionary parameter: "+p+" MUST be a array");var T=o[p].length;d.setUint32(c,T,a),c+=4;for(var w=0;w<T;w++){if(r&&"string"!=typeof o[p][w])throw new Error("serializerWithDictionary parameter: "+p+" ARRAY_STRING element MUST be a string");var S,R=u(o[p][w]);S=R?R.length:0,d.setInt32(c,S,a),c+=4;for(var C=0;C<S;C++){var L=R[C];d.setUint8(c,L,a),c+=1}}}else{if(f!==n.ARRAYBUFFER)throw new Error("[serializerWithDictionary]: objectToArrayBuffer: got invalid parameter type: "+f);if(r&&!(o[p]instanceof ArrayBuffer))throw new Error("serializerWithDictionary parameter: "+p+" MUST be an ArrayBuffer");var P=o[p].byteLength;d.setUint32(c,P,a),c+=4;for(var O=new Int8Array(o[p]).values(),x=0;x<P;x++)d.setInt8(c,O.next().value,a),c+=1}}else if("type"===p);else if("function"!=typeof o[p])throw new Error("[signallingProtocolSerializer]: objectToArrayBuffer: parameter not found: ",p);return l&&(d.setUint8(c,s,a),c+=1),c}(e[t.type].parameters,t,i,d,l,!1),i}throw new Error("[serializerWithDictionary]: messageToArrayBuffer: message.type undefined")},o.arraybufferToMessage=function(t){var r={},o=0,c=new DataView(t,o),d=c.getUint8(o,a);return o+=1,i[d]&&(r.type=i[d].type,o=function e(t,r,o,i,c,d){for(;i<o.byteLength;){if(c.getUint8(i,a)===s){i+=1;break}var l=c.getUint8(i);i+=1;var u,f=r[l].parameterName,v=t[f].type;if(v===n.BOOLEAN)u=1===c.getInt8(i,a),i+=1;else if(v===n.INTEGER_32)u=c.getInt32(i,a),i+=4;else if(v===n.U_INTEGER_32)u=c.getUint32(i,a),i+=4;else if(v===n.FLOAT)u=c.getFloat64(i,a),i+=8;else if(v===n.STRING){u="";var g=c.getInt32(i,a);i+=4;for(var m=[],y=0;y<g;y++){var h=c.getUint8(i,a);m.push(h),i+=1}u=p(new Uint8Array(m))}else if(v===n.ENUM){var b=c.getInt8(i,a);i+=1,u=r[l].enum[b]}else if(v===n.OBJECT)i=e(t[f].parameters,r[l].object,o,i,c,u={});else if(v===n.ARRAY_U_INTEGER_32){var E=c.getUint32(i,a);i+=4,u=[];for(var T=0;T<E;T++){var w=c.getUint32(i,a);i+=4,u.push(w)}}else if(v===n.ARRAY_STRING){var S=c.getUint32(i,a);i+=4,u=[];for(var R=0;R<S;R++){var C=c.getInt32(i,a);i+=4;for(var L,P=[],O=0;O<C;O++){var x=c.getUint8(i,a);P.push(x),i+=1}L=p(new Uint8Array(P)),u.push(L)}}else{if(v!==n.ARRAYBUFFER)throw new Error("[signallingProtocolSerializer]: arraybufferToObject: invalid parameter type: "+f);var I=c.getUint32(i,a);i+=4,u=new Int8Array(o.slice(i,i+I)).buffer,i+=I}d[f]=u}return i}(e[r.type].parameters,i[d],t,o,c,r)),r},e)i[e[f].code]={type:f},l(e[f].parameters,i[e[f].code]);return o}}}("undefined"==typeof teltoo?exports:teltoo),function(e){e.signalling={createDictionaryWithTypes:function(e){var t=e.U_INTEGER_32,n=e.U_INTEGER_32;return{dictionary:{TELTOO_WEBSOCKET_PROTOCOL:"teltoo-ss-bin-1.0.6",hello:{code:0,parameters:{origin:{code:0,type:e.STRING},from:{code:1,type:t},to:{code:2,type:t},cfg:{code:3,type:e.OBJECT,parameters:{cacheSize:{code:0,type:e.STRING},httpRangeHeaderEnabled:{code:1,type:e.STRING},reconnectTries:{code:2,type:e.STRING},reconnectStart:{code:3,type:e.STRING},reconnectEnd:{code:4,type:e.STRING},maxTimeToFirstByte:{code:5,type:e.STRING},httpFallbackTimeoutDefault:{code:6,type:e.STRING},httpFallbackTimeoutSegmentDurationRate:{code:7,type:e.STRING},stunServer:{code:8,type:e.STRING},directHttpFetchsBeforeActivateP2p:{code:9,type:e.STRING},reportPlayerMetrics:{code:10,type:e.STRING},rxTransferCloseOnAbort:{code:11,type:e.STRING},signallingSerialize:{code:12,type:e.STRING},maxTxTime:{code:13,type:e.STRING},sharedFileUrlBlacklistFilter:{code:14,type:e.STRING},caPlaylistRequestRepetitionTimeout:{code:15,type:e.STRING},mobileSeedingAllowed:{code:16,type:e.STRING},consecutiveDisconnectsBeforeRemovingPeerFromWhitelist:{code:17,type:e.STRING},consecutiveRxAbortsBeforeRemovingPeerFromWhitelist:{code:18,type:e.STRING},txTransferCloseOnAbort:{code:19,type:e.STRING},rtcPeerConnectionTimeout:{code:20,type:e.STRING},disableTrickleIce:{code:21,type:e.STRING},enableP2pConditionalLeeching:{code:22,type:e.STRING},qualityDegradationThresholdRate:{code:23,type:e.STRING},allowSeedingOnDeviceAndConnectionTypeMap:{code:24,type:e.STRING},maxPeerConnections:{code:25,type:e.STRING},enableAdaptiveFallbackTimeout:{code:26,type:e.STRING},adaptiveFallbackTimeoutGuardBand:{code:27,type:e.STRING},websocketIdleTimeout:{code:28,type:e.STRING},enableSRT:{code:29,type:e.STRING}}},apiKey:{code:4,type:e.STRING},deviceType:{code:5,type:e.STRING},connectionType:{code:6,type:e.STRING},outts:{code:204,type:e.FLOAT}}},join:{code:1,parameters:{token:{code:0,type:n},from:{code:1,type:t},seeder:{code:2,type:e.BOOLEAN},leecher:{code:3,type:e.BOOLEAN},wl:{code:4,type:t===e.U_INTEGER_32?e.ARRAY_U_INTEGER_32:e.ARRAY_STRING},bytes:{code:5,type:e.U_INTEGER_32},url:{code:6,type:e.STRING},transferId:{code:7,type:e.U_INTEGER_32},outts:{code:204,type:e.FLOAT}}},soiquery:{code:2,parameters:{from:{code:0,type:t},url:{code:1,type:e.STRING},credentials:{code:2,type:e.STRING},outts:{code:204,type:e.FLOAT}}},transferstatus:{code:3,parameters:{from:{code:0,type:t},status:{code:1,type:e.ENUM,values:{completed:0,aborted:1}},soi:{code:2,type:n},retrievalMethod:{code:3,type:e.ENUM,values:{CACHE:0,HTTP:1,P2P:2,"P2P+HTTP":3}},soiFetchTime:{code:4,type:e.FLOAT},p2pRxTime:{code:5,type:e.FLOAT},httpRxTime:{code:6,type:e.FLOAT},p2pRxBytes:{code:7,type:e.INTEGER_32},httpRxBytes:{code:8,type:e.INTEGER_32},byteLength:{code:9,type:e.INTEGER_32},fft:{code:10,type:e.FLOAT},timeoutValue:{code:11,type:e.FLOAT},reason:{code:12,type:e.ENUM,values:{timeout:0,firstbytetimeout:1,noavailability:2,p2pnotallowedforurl:3,blacklisted:4,directhttpfetchsbeforeactivatep2p:5,signallingsessionnotready:6,error:7,unsupported:8,rangeerror:9,conditionalleeching:10,conditionalleechingconfigerror:11,httpRangeFailed:12,sharedfiletimeout:13,sharedfileabort:14,adaptivetimeout:15}},segmentType:{code:13,type:e.ENUM,values:{UNKNOWN:0,AUDIO:1,VIDEO:2,TEXT:3,PROBE:4}},segmentDuration:{code:14,type:e.FLOAT},bitrate:{code:15,type:e.U_INTEGER_32},playlistId:{code:16,type:e.U_INTEGER_32},peersConnected:{code:17,type:t===e.U_INTEGER_32?e.ARRAY_U_INTEGER_32:e.ARRAY_STRING},pcid:{code:18,type:e.STRING},httpPredictedRxTime:{code:19,type:e.FLOAT},qualityDegradationThreshold:{code:20,type:e.FLOAT},playlistGroupId:{code:21,type:e.U_INTEGER_32},outts:{code:204,type:e.FLOAT}}},peerconnectionstatusmetric:{code:4,parameters:{from:{code:0,type:t},to:{code:1,type:t},status:{code:2,type:e.ENUM,values:{checking:0,connected:1,failed:2,disconnected:3,completed:4,datachannelopen:5,datachannelclosed:6,peerconnectiontimeout:7,connmanconnectionclose:8}},delay:{code:3,type:e.FLOAT},pcid:{code:4,type:e.STRING},outts:{code:204,type:e.FLOAT}}},txTransferFinished:{code:5,parameters:{from:{code:0,type:t},status:{code:1,type:e.ENUM,values:{aborted:0,completed:1,error:2}},target:{code:2,type:t},txBytes:{code:3,type:e.U_INTEGER_32},soi:{code:4,type:n},isPeerConnected:{code:5,type:e.BOOLEAN},txTime:{code:6,type:e.FLOAT},outts:{code:204,type:e.FLOAT}}},clientError:{code:6,parameters:{error:{code:0,type:e.STRING},ua:{code:1,type:e.STRING},message:{code:2,type:e.STRING},outts:{code:204,type:e.FLOAT}}},heartbeat:{code:17,parameters:{outts:{code:204,type:e.FLOAT}}},abortpeerconnection:{code:7,parameters:{to:{code:0,type:t},target:{code:1,type:t}}},push:{code:8,parameters:{to:{code:0,type:t},token:{code:1,type:n},target:{code:2,type:t},transferId:{code:3,type:e.U_INTEGER_32}}},connect:{code:16,parameters:{to:{code:0,type:t},targets:{code:1,type:t===e.U_INTEGER_32?e.ARRAY_U_INTEGER_32:e.ARRAY_STRING}}},soiqueryanswer:{code:9,parameters:{token:{code:0,type:n},url:{code:1,type:e.STRING}}},soistatus:{code:10,parameters:{to:{code:0,type:t},token:{code:1,type:n},availability:{code:2,type:e.INTEGER_32}}},blacklist:{code:14,parameters:{to:{code:0,type:t},blacklisted:{code:1,type:e.BOOLEAN}}},joinanswer:{code:15,parameters:{to:{code:0,type:t},token:{code:1,type:n},url:{code:2,type:e.STRING},availability:{code:3,type:e.INTEGER_32}}},answer:{code:11,parameters:{from:{code:0,type:t},to:{code:1,type:t},sdp:{code:2,type:e.STRING},pcid:{code:3,type:e.STRING},outts:{code:204,type:e.FLOAT}}},offer:{code:12,parameters:{from:{code:0,type:t},to:{code:1,type:t},sdp:{code:2,type:e.STRING},pcid:{code:3,type:e.STRING},outts:{code:204,type:e.FLOAT}}},candidate:{code:13,parameters:{from:{code:0,type:t},to:{code:1,type:t},candidate:{code:2,type:e.STRING},sdpMid:{code:3,type:e.STRING},sdpMLineIndex:{code:4,type:e.INTEGER_32},ufrag:{code:5,type:e.STRING},pcid:{code:6,type:e.STRING},outts:{code:204,type:e.FLOAT}}}},SOI_TYPE:n===e.U_INTEGER_32?"number":"string",PEERID_TYPE:t===e.U_INTEGER_32?"number":"string"}}}}("undefined"!=typeof teltoo?teltoo:exports),function(e){e.datachannelProtocol={createDictionaryWithTypes:function(e){var t=e.U_INTEGER_32,n=e.U_INTEGER_32;return{dictionary:{TELTOO_DATACHANNEL_PROTOCOL:"teltoo-datachhanel-1.0",new_file_piece:{code:0,parameters:{soi:{code:0,type:n},transferId:{code:1,type:e.U_INTEGER_32},fullEntityLength:{code:2,type:e.U_INTEGER_32},offset:{code:3,type:e.U_INTEGER_32},body:{code:4,type:e.ARRAYBUFFER}}},soi_rx_ack:{code:1,parameters:{soi:{code:0,type:n}}}},SOI_TYPE:n===e.U_INTEGER_32?"number":"string",PEERID_TYPE:t===e.U_INTEGER_32?"number":"string"}}}}("undefined"!=typeof teltoo?teltoo:exports),function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){},{}],2:[function(e,t,n){(function(n){"use strict";var r=e("./adapter_factory.js");t.exports=r({window:n.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":3}],3:[function(e,t,n){"use strict";t.exports=function(t){var n=t&&t.window,r=e("./utils"),o=r.log,i=r.detectBrowser(n),a={browserDetails:i,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings},s=e("./chrome/chrome_shim")||null,c=e("./edge/edge_shim")||null,d=e("./firefox/firefox_shim")||null,l=e("./safari/safari_shim")||null;switch(i.browser){case"chrome":if(!s||!s.shimPeerConnection)return o("Chrome shim is not included in this adapter release."),a;o("adapter.js shimming chrome."),a.browserShim=s,s.shimGetUserMedia(n),s.shimMediaStream(n),s.shimPeerConnection(n),s.shimOnTrack(n),s.shimGetSendersWithDtmf(n);break;case"firefox":if(!d||!d.shimPeerConnection)return o("Firefox shim is not included in this adapter release."),a;o("adapter.js shimming firefox."),a.browserShim=d,d.shimGetUserMedia(n),d.shimPeerConnection(n),d.shimOnTrack(n);break;case"edge":if(!c||!c.shimPeerConnection)return o("MS edge shim is not included in this adapter release."),a;o("adapter.js shimming edge."),a.browserShim=c,c.shimGetUserMedia(n),c.shimPeerConnection(n),c.shimReplaceTrack(n);break;case"safari":if(!l)return o("Safari shim is not included in this adapter release."),a;o("adapter.js shimming safari."),a.browserShim=l,l.shimRTCIceServerUrls(n),l.shimCallbacksAPI(n),l.shimLocalStreamsAPI(n),l.shimRemoteStreamsAPI(n),l.shimGetUserMedia(n);break;default:o("Unsupported browser!")}return a}},{"./chrome/chrome_shim":4,"./edge/edge_shim":1,"./firefox/firefox_shim":6,"./safari/safari_shim":8,"./utils":9}],4:[function(e,t,n){"use strict";var r=e("../utils.js"),o=r.log,i={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){var n=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track.id===r.track.id}):{track:r.track};var i=new Event("track");i.track=r.track,i.receiver=o,i.streams=[t.stream],n.dispatchEvent(i)}),t.stream.getTracks().forEach(function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track.id===r.id}):{track:r};var i=new Event("track");i.track=r,i.receiver=o,i.streams=[t.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var t=e.RTCPeerConnection.prototype.addStream,n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.addTrack||(e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r._senders=r._senders||[],r._senders.find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{};var i=r._streams[n.id];if(i)i.addTrack(t),r.removeStream(i),r.addStream(i);else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r.addStream(a)}var s={track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=r.createDTMFSender(t):this._dtmf=null),this._dtmf}};return r._senders.push(s),s}),e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],t.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=n.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],n.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=r.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var i=e.iceServers[o];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?((i=JSON.parse(JSON.stringify(i))).urls=i.url,r.push(i)):r.push(e.iceServers[o])}e.iceServers=r}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof arguments[0]))return i.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return i.apply(this,[function(e){o[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){i.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,o){n.apply(t,[e[0],r,o])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,o){n.apply(e,[r,o,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:i.shimMediaStream,shimOnTrack:i.shimOnTrack,shimGetSendersWithDtmf:i.shimGetSendersWithDtmf,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":9,"./getusermedia":5}],5:[function(e,t,n){"use strict";var r=e("../utils.js"),o=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var i={};"number"==typeof r.ideal?(i[o("min",n)]=r.ideal,t.optional.push(i),(i={})[o("max",n)]=r.ideal,t.optional.push(i)):(i[o("",n)]=r.ideal,t.optional.push(i))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,d=t.version<61;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return n.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==c.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=i(e.video),o("chrome: "+JSON.stringify(e)),r(e)});e.video=i(e.video)}return o("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};n.getUserMedia=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r(s(e))})})};var c=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return c(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":9}],6:[function(e,t,n){"use strict";var r=e("../utils"),o={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var o=[],i=0;i<n.iceServers.length;i++){var a=n.iceServers[i];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),o.push(c)}else o.push(n.iceServers[i])}n.iceServers=o}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return i.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,r)}}}};t.exports={shimOnTrack:o.shimOnTrack,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":9,"./getusermedia":7}],7:[function(e,t,n){"use strict";var r=e("../utils"),o=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,i=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,i){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof r.ideal?o[n]={min:r.ideal,max:r.ideal}:o[n]=r.ideal,e.advanced.push(o),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),o("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){i(a(e))})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){s(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),u(e)},i&&i.prototype.getSettings){var p=i.prototype.getSettings;i.prototype.getSettings=function(){var e=p.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var f=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}n.getUserMedia=function(e,r,o){if(t.version<44)return s(e,r,o);n.mediaDevices.getUserMedia(e).then(r,o)}}},{"../utils":9}],8:[function(e,t,n){"use strict";var r=e("../utils"),o={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};var s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var o=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,o.push(a)):o.push(e.iceServers[i])}e.iceServers=o}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}};t.exports={shimCallbacksAPI:o.shimCallbacksAPI,shimLocalStreamsAPI:o.shimLocalStreamsAPI,shimRemoteStreamsAPI:o.shimRemoteStreamsAPI,shimGetUserMedia:o.shimGetUserMedia,shimRTCIceServerUrls:o.shimRTCIceServerUrls}},{"../utils":9}],9:[function(e,t,n){"use strict";var r=!0,o={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&console.log}},deprecated:function(e,t){},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),i=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return i.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),i.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}}};t.exports={log:o.log,deprecated:o.deprecated,disableLog:o.disableLog,disableWarnings:o.disableWarnings,extractVersion:o.extractVersion,shimCreateObjectURL:o.shimCreateObjectURL,detectBrowser:o.detectBrowser.bind(o)}},{}]},{},[2]),teltoo.streamInfo=function(){var e={},t=[],n=[],r=[];return e.setAvailableBitrates=function(e,o){if(Array.isArray(o)){for(var i=!0,a=0;a<o.length;a++){if("number"!=typeof o[a]){i=!1;break}if(o[a]<=0){i=!1;break}}if(i){var s=o.sort(function(e,t){return t-e});"AUDIO"===e?t=s:"VIDEO"===e?n=s:"TEXT"===e&&(r=s)}}else;},e.getAvailableBitrates=function(e){return"AUDIO"===e?t:"VIDEO"===e?n:"TEXT"===e?r:[]},e},teltoo.bandwidthEstimator=function(){var e={},t=-1,n=0,r=128e3;return e.sample=function(e,r){if(!(e<16e3)){n+=e;var o=8*e/(r/1e3);t=t>0?(t+o)/2:o}},e.getBandwidthEstimate=function(e){return n<r?e||0:t},e.getPredictedRxMsec=function(e,o){var i=-1;if(e&&o)if(e<1e3);else if(t>0&&n>=r){var a=e*o;i=a/t*1e3}else;else;return i},e},teltoo.clientMiddlewareSession=function(e,t,n,r,o,i,a,s,c){var d,l,u,p,f={};function v(e,t){e===d&&t()}function g(){return L.SignallingSession&&L.SignallingSession.getClientDeviceConfig()||{}}function m(){return p||(p=teltoo.bandwidthEstimator()),p}function y(e){d&&("ready"===e&&"ready"!==d?(d="ready",f.dispatchEvent(d)):"ready"!==e&&"error"!==d&&(d="error",f.dispatchEvent(d)))}function h(e){f.dispatchEvent("metrics",e)}f.dispose=function(e){f.dispose=function(e){e&&e()},d="disposed",L.SignallingSession&&(L.SignallingSession.removeEventListener("sessionstatuschange",y),L.SignallingSession.close()),f.removeEventListener(),teltoo.removeClientMiddleware(f),e&&e()},f.getObjectsRetrievalManager=function(){return L.ObjectsRetrievalManager},f.getObjectsCacheManager=function(){return L.ObjectsCacheManager},f.getSignallingSession=function(){return L.SignallingSession},f.setBandwidthEstimatorHttp=function(e){f.updateHttpThroughput=function(){},p=e},f.getClientDeviceConfig=g,f.reportTransferCompleted=function(e,t,n,r,o,i,a,s,c,d,l,p,f,v,g){"HTTP"===o&&P++,u&&u.reportTransferCompleted(t,n,r,o,i,a,s,c,d,l,p,f,v,g)},f.updateHttpThroughput=function(e,t){m().sample(e,t)},f.getHttpPredictedRxMsec=function(e,t){return m().getPredictedRxMsec(e,t)},f.reportError=function(e){u&&u.reportError(e)},f.getStats=function(){return!!u&&u.getStats()},f.isHttpRangeHeaderEnabled=function(){return r},f.setHttpRangeHeaderEnabled=function(e){r=e},f.isP2pEnabled=function(){var e=!1;return c>=0&&(e=O?"ready"===d&&P>=c:P>=c),e},f.isP2pAllowedForUrl=function(e){var t=g();if(!("string"==typeof t.sharedFileUrlBlacklistFilter&&t.sharedFileUrlBlacklistFilter.length>0))return!0;try{var n=!new RegExp(t.sharedFileUrlBlacklistFilter).test(e);return n}catch(e){return!0}},f.isBlacklisted=function(){return!!L.SignallingSession&&L.SignallingSession.isBlacklisted()},f.getQualityDegradationThresholdSeconds=function(e){var t;return e&&(t=e*E),t},f.isP2pPossibleBasedOnConditionalLeeching=function(e,t,n,r){var o=!0;if(b)if(e&&t)if(e<1e3);else{var i=m().getPredictedRxMsec(e,t);if(i<=0)o=!1;else{var a=1e3*f.getQualityDegradationThresholdSeconds(t)-n;i<=0?o=!1:a<=0?(o=!1,r.value="conditionalleechingconfigerror"):o=a>i}}else;else;return o},f.resetInitialMetrics=function(){O=!0,P=0},teltoo.utils.eventualize(f),t=t||31457280,n=n||10,r=r||!1,c=c||0;var b=!1,E=1,T=!0,w=0,S=!0,R=0,C=[],L={},P=0,O=!1;function x(e,t,n,r,o){C[e]||(C[e]={}),C[e][t]={constructor:n,params:r,dependencies:o}}function I(e){setTimeout(function(){switch(R+=1,e){case"ready":S=S&&!0;break;case"error":case"unsupported":S=S&&!1}"disposed"===d?k("disposed"):R===Object.keys(C[w]).length&&(!0===S?(w+=1,R=0,A()):k("unsupported"))},1)}function A(){if(l&&Date.now()-l,l=Date.now(),w<C.length)for(var e in C[w]){for(var t=C[w][e],n=[],o=0;o<t.dependencies.length;o++)n.push(L[t.dependencies[o]]);var i=t.params.concat(n).concat([I]);L[e]=t.constructor.apply(null,i)}else{var a=L.SignallingSession.getClientDeviceConfig();a&&("boolean"==typeof a.httpRangeHeaderEnabled&&(r=a.httpRangeHeaderEnabled),"number"==typeof a.directHttpFetchsBeforeActivateP2p&&(c=a.directHttpFetchsBeforeActivateP2p),"boolean"==typeof a.enableP2pConditionalLeeching&&(b=a.enableP2pConditionalLeeching),"number"==typeof a.qualityDegradationThresholdRate&&(E=a.qualityDegradationThresholdRate),"string"==typeof a.allowSeedingOnDeviceAndConnectionTypeMap&&L.DataExchangeModerator.setAllowSeedingOnDeviceAndConnectionTypeMap(a.allowSeedingOnDeviceAndConnectionTypeMap),"string"==typeof a.mobileSeedingAllowed&&L.DataExchangeModerator.setMobileSeedingAllowedConfig(a.mobileSeedingAllowed)),k("ready")}}function k(e){"disposed"!==e?((u=teltoo.metricsMonitor(e,L.SignallingSession,L.ConnectionsManager)).addEventListener("metrics",h),d=e,L.SignallingSession.addEventListener("sessionstatuschange",y),f.dispatchEvent(d)):L.SignallingSession&&(L.SignallingSession.removeEventListener("sessionstatuschange",y),L.SignallingSession.close())}for(var M in teltoo.Modernizr)teltoo.Modernizr.hasOwnProperty(M)&&(T&=teltoo.Modernizr[M]);return x(0,"DataExchangeModerator",teltoo.dataExchangeModerator,[],[]),x(1,"SignallingSession",teltoo.signallingSession,[e,i,a,s],["DataExchangeModerator"]),x(2,"ObjectsCacheManager",teltoo.objectsCacheManager,[t],["SignallingSession"]),x(3,"WebRtc",teltoo.webRtc,[],["SignallingSession"]),x(3,"ConnectionsManager",teltoo.connectionsManager,[n],["SignallingSession","WebRtc"]),x(4,"TransfersManager",teltoo.transfersManager,[],["SignallingSession","ConnectionsManager"]),x(5,"ObjectsRetrievalManager",teltoo.objectsRetrievalManager,[],["SignallingSession","ObjectsCacheManager","TransfersManager","DataExchangeModerator","ConnectionsManager"]),T?A():(d="unsupported",f.dispatchEvent(d)),f.setPostAdditionProcessor("ready",v),f.setPostAdditionProcessor("error",v),f.setPostAdditionProcessor("unsupported",v),teltoo.addClientMiddleware(f),f},teltoo.connectionsManager=function(e,t,n,r){var o={},i={},a=[],s=[],c=teltoo.datachannelProtocol.createDictionaryWithTypes(teltoo.serializerWithDictionary.TYPES),d=teltoo.serializerWithDictionary.create(c.dictionary);function l(e){var t=e.getRemotePeerId();!function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1)}(t),v(t)&&delete i[t]}function u(e){var t=e.getRemotePeerId();v(t)&&e.close()}function p(t){var n=t.getRemotePeerId();v(n)||(Object.keys(i).length>=e&&u(function(){var e=!1;for(var t in i)if(i.hasOwnProperty(t)){var n=i[t];e?n.lastTimeUsed<e.lastTimeUsed&&(e=n):e=i[t]}return e}()),f(t),i[n]=t)}function f(e){e.lastTimeUsed=Date.now()}function v(e){return i[e]}function g(e){var t=e.target;t.removeEventListener("disposed",g),t.removeEventListener("datachannelopen",y),t.removeEventListener("message",m),function(e){var t;l(e),t={type:"connectionclose",target:e},o.dispatchEvent(t.type,t)}(t)}function m(e,t){var n;try{(n=d.arraybufferToMessage(e.data))&&(f(v(t)),o.dispatchEvent(n.type,n,t,e.pcid),o.dispatchEvent(n.type+t,n,t,e.pcid),n.soi&&o.dispatchEvent(n.type+n.soi,n,t,e.pcid),n.transferId&&o.dispatchEvent(n.type+n.transferId,n,t,e.pcid))}catch(e){}}function y(e){var t,n=e.target;t=n.getRemotePeerId(),a.push(t),o.dispatchEvent(e.type,e)}function h(e){!function(e){var t;p(e),t={type:"newconnection",target:e},o.dispatchEvent(t.type,t)}(e),e.addEventListener("datachannelopen",y),e.addEventListener("message",m),e.addEventListener("disposed",g)}function b(){if(s.length){var e=s.shift();o.connect(e,b,b)}}function E(e,t){var n,r,o;return(n=v(e))&&(o=d.messageToArrayBuffer(t))?(r=n.send(o))&&f(n):r=!1,r}o.connect=function(e,t,r){var o;function i(e){var n=e.target;n.removeEventListener("datachannelopen",i),n.removeEventListener("disposed",a),t.apply(this)}function a(e){var t=e.target;t.removeEventListener("datachannelopen",i),t.removeEventListener("disposed",a),r.apply(this)}(o=v(e))||h(o=n.connect(e)),"datachannelopen"===o.status?t():"disposed"===o.status?r():"new"===o.status&&(o.addEventListener("datachannelopen",i),o.addEventListener("disposed",a))},o.send=E,o.sendSoiRxAck=function(e,t){return E(e,{type:"soi_rx_ack",soi:t})},o.sendAbort=function(e,t){},o.getConnectedPeersList=function(){return a},o.close=function(e){var t;(t=v(e))&&u(t)};var T=t.getClientDeviceConfig()||{};return isNaN(T.maxPeerConnections)||(e=parseInt(T.maxPeerConnections,10)),teltoo.utils.eventualize(o),t.addEventListener("connect",function(e){for(var t=e.targets,n=0;n<t.length;n++){var r=t[n];s.push(r)}b()}),n.addEventListener("incomingconnection",function(e){h(e),e.accept()}),r("ready"),o},teltoo.dataExchangeModerator=function(e){var t={},n="unknown",r="unknown",o=!1,i=["tablet","mobile","unknown","default","all"],a={tablet:["ethernet","other","wimax"],mobile:["ethernet","other","wimax"],unknown:["ethernet","wifi","other","wimax","unknown"],default:["ethernet","wifi","other","wimax","unknown"]};function s(){var e,t=!1;return void 0===(e=void 0!==a[r]?a[r]:a.default?a.default:void 0)||(e.includes(n)?t=!0:e.includes("all")&&(t=!0)),t}return t.setAllowSeedingOnDeviceAndConnectionTypeMap=function(e){try{var t=JSON.parse(e);if("object"!=typeof t||null===t);else for(var n in t)i.includes(n)&&Array.isArray(t[n])&&(a[n]=t[n]);o=s()}catch(e){}},t.setMobileSeedingAllowedConfig=function(e){"1"===e||"always"===e?a={default:["all"]}:"0"===e||"never"===e?a={tablet:[],mobile:[],default:["all"]}:"wifi"===e&&(a={mobile:["wifi"],tablet:["wifi"],unknown:["ethernet","wifi","other","wimax","unknown"],default:["ethernet","wifi","other","wimax","unknown"]}),o=s()},t.isSeedingAllowed=function(){return o},t.getConnectionType=function(){return n},t.getDeviceType=function(){return r},teltoo.utils.eventualize(t),navigator&&navigator.connection&&(n=navigator.connection.type||"unknown",navigator.connection.addEventListener("change",function(){if(navigator.connection.type!==n){n=navigator.connection.type||"unknown";var e=o;if((o=s())!==e){var r={type:"seedingallowed",isseedingallowed:o};t.dispatchEvent(r.type,r)}}})),r=teltoo.uaParser().getDeviceType()||"unknown",o=s(),e&&e("ready"),t},teltoo.metricsMonitor=function(e,t,n){var r={},o=0,i=0,a=0,s=0,c=0,d=!1;function l(e){e.target;!0===d&&t.reportPeerConnectionStatus(e.remotePeerId,e.type,e.delay,e.pcid)}function u(e){var n=e.target;!0===d&&t.reportPeerConnectionStatus(n.getRemotePeerId(),e.type,e.delay,e.pcid)}function p(e){var n=e.target;!0===d&&t.reportPeerConnectionStatus(n.getRemotePeerId(),e.type,e.delay,e.pcid)}function f(e){var t=e.target;o-=1,r.dispatchEvent("metrics",r.getStats()),t.removeEventListener("peerconnectiontimeout",l),t.removeEventListener("datachannelopen",u),t.removeEventListener("datachannelclosed",p),t.removeEventListener("disposed",f)}return r.reportTransferCompleted=function(n,o,l,u,p,f,v,g,m,y,h,b,E,T){"ready"===e&&!0===d&&t.reportTransferCompleted(n,o,l,u,p,f,v,g,m,y,h,b,E,T),"CACHE"===u?s+=o:"p2pnotallowedforurl"===h?c+=1:(i=i+o+l,a+=o),r.dispatchEvent("metrics",r.getStats())},r.reportError=function(e){!0===d&&t.reportError(e)},r.getStats=function(){return{peers:o,totalReceivedBytes:i,p2pReceivedBytes:a,cacheReceivedBytes:s,requestWithoutTeltoo:c}},t&&t.addEventListener("sessionstatuschange",function(e){d="ready"===e}),n&&(n.addEventListener("newconnection",function(e){var t=e.target;o+=1,r.dispatchEvent("metrics",r.getStats()),t.addEventListener("peerconnectiontimeout",l),t.addEventListener("datachannelopen",u),t.addEventListener("datachannelclosed",p),t.addEventListener("disposed",f)}),n.addEventListener("connectionclose",function(e){var n,r;!0===d&&(n="connman"+e.type,r=e.target,t.reportPeerConnectionStatus(r.getRemotePeerId(),n,void 0,r.getPcId()))})),teltoo.utils.eventualize(r),r},teltoo.objectBuilder=function(e,t){var n,r,o,i,a,s={},c=[],d=0,l=!1,u=40,p=0;function f(e,t){(e===o||"error"===e&&l)&&t(v(e))}function v(e){return"load"===e?{type:"load",pcid:a,target:s}:{type:e,target:s}}function g(e){var t;l="error"===(o=e)||l,t=v(e),s.dispatchEvent(t.type,t)}function m(e,t){switch(e){case"disposed":case"load":g(e);break;case"error":g("error")}}function y(){return r||(r=function(){var e,t,r,i,a;if("load"!==o);else{for(e=new ArrayBuffer(n),t=new Uint8Array(e),a=c.length-1;a>=0;a--)i=c[a],r=new Uint8Array(i.body),t.set(r,i.offset);c=null}return e}()),r}function h(e){var t=new FileReader;t.onload=function(e){r=t.result,m("load"),t.onload=void 0,t.onerror=void 0,t=void 0},t.onerror=function(e){m("error"),t.onload=void 0,t.onerror=void 0,t=void 0},t.readAsArrayBuffer(e)}return s.write=function(e,t,r){var o,i;!n&&r<=0?m("error"):(n||(n=r),r&&n!==r?m("error"):function(e,t){var r,o,i,a,l,u,p;for(l={offset:t,body:e},u=0,r=c.length-1;r>=0&&!p;r--)if((o=c[r]).offset<l.offset)if(i=o,a=c[r+1]||void 0,i.offset+i.body.byteLength-1>=l.offset)p=!0;else if(a&&l.offset+l.body.byteLength-1>=a.offset)p=!0;else{if(!(l.offset+l.body.byteLength>n)){u=r+1;break}p=!0}else o.offset===l.offset&&(p=!0);if(!p){c.splice(u,0,l),d+=l.body.byteLength;var f={type:"newrange",newRange:l,target:s};s.dispatchEvent(f.type,f)}return p}(e,t)?m("error"):(i=Math.ceil(n/u),(p<=d-1||d===n)&&(p+=i,o={type:"progress",lengthComputable:!!n,total:n,loaded:d,target:s},s.dispatchEvent("progress",o)),n&&n===d&&m("load")))},s.setBlob=function(e){h(e)},s.getMissingRanges=function(){var e;if(null==c)e=!1;else{for(var t=[],n={s:0,e:""},r=0;r<c.length;r++){var o=c[r];n.s===o.offset?n.s=o.offset+o.body.byteLength:(n.e=o.offset-1,t.push(n),n={s:o.offset+o.body.byteLength,e:""})}t.push(n),e=t.reduce(function(e,t,n,r){var o=t.s+"-"+t.e;return e+=o+=n===r.length-1?"":","},"")}return e},s.getReceivedRanges=function(){return c.slice()},s.getReceivedBytes=function(){return d},s.getMissingBytes=function(){return n-d},s.getSoi=function(){return e},s.setMetadata=function(e){i=e},s.getMetadata=function(e){return i&&e?i[e]:i},s.setPcId=function(e){a=e},s.getPcId=function(){return a},s.setSoi=function(t){e?m("error"):"string"!=typeof t&&"number"!=typeof t?m("error"):e=t},s.dispose=function(){m("disposed")},s.toArrayBuffer=function(){return y().slice(0)},s.toBlob=function(e){var t;return t=y(),new Blob([t])},s.getByteLength=function(){return r?r.byteLength:n},s.read=function(e,t){var n;if(r)return(n=r.slice(e,e+t))&&0===n.byteLength&&(n=void 0),n;throw new Error("[objectBuilder]: read: not ready to read")},s.getStatus=function(){return o},teltoo.utils.eventualize(s),t||"string"!=typeof e&&"number"!=typeof e&&void 0!==e&&(e=void 0,m("error")),t instanceof Blob?h(t):t instanceof ArrayBuffer?(r=t,setTimeout(function(){m("load")},1)):void 0===t||m("error"),s.setPostAdditionProcessor("load",f),s.setPostAdditionProcessor("error",f),s.setPostAdditionProcessor("disposed",f),s},teltoo.objectLeecher=function(e,t,n){var r,o,i,a,s={},c=0,d=-1;function l(e,t){var n;"string"==typeof e?n=function(e){return{type:e,target:s}}(e):(n=e).target=s,t?t(n):s.dispatchEvent(n.type,n)}function u(e){var n=e.objectBuilder,o=(r=e.target).getSoi();i||(i=o,t.setSoi(n,i));var a={};m(!1),a.type="load",a.target=s,a.objectBuilder=n,a.rxTime=e.rxTime,s.dispatchEvent(a.type,a)}function p(e){var t={};0!==e.availability||(t.type="soistatus",t.availability=e.availability,t.target=s,s.dispatchEvent(t.type,t))}function f(e){c>0&&(d=performance.now()-c),i=e.token,t.setSoi(o,i);var n={type:"soistatus"};n.availability=e.availability,n.target=s,n.soi=i,n.url=e.url,s.dispatchEvent(n.type,n)}function v(e){var t;(t={}).type="error",t.target=s,s.dispatchEvent(t.type,t),m(!0),r&&r.abort("error",-1,-1)}function g(e){l(e)}function m(t){r&&(r.removeEventListener("complete",u),r.removeEventListener("error",v)),e.unpublishLeecher(i),a?e.removeEventListener("joinanswer"+a,f):e.removeEventListener("soistatus"+i,p),n.disallowRx(i),o&&(o.removeEventListener("progress",g),t&&o.dispose())}return s.leechBySoi=function(a,s){i=a,(o=t.store(i))?((r=n.allowRx(i,o)).addEventListener("complete",u),r.addEventListener("error",v),o.addEventListener("progress",g),e.publishLeecher(i,s),e.addEventListener("soistatus"+i,p)):v()},s.leechByUrl=function(i,s){if(a=i,o=t.storeByUrl(a)){(r=n.allowRx(void 0,o)).addEventListener("complete",u),r.addEventListener("error",v);var d=r.getTransferId();e.addEventListener("joinanswer"+a,f),c=performance.now(),o.addEventListener("progress",g),e.publishLeecherByUrl(a,d,s)}else v()},s.getSoi=function(){return i},s.getUrl=function(){return a},s.getJoinQueryTime=function(){return d},s.getObjectBuilder=function(){return o},s.abort=function(e,t){r&&r.abort(e,d,t,i),m()},teltoo.utils.eventualize(s),s},teltoo.objectSeeder=function(e,t,n,r,o,i){var a,s={NO:0,PARTIAL:1,FULL:2},c={},d=s.NO,l=!1,u=!1;function p(e){e.target=c,c.dispatchEvent(e.type,e)}function f(e,t){var n;n=function(e){return{type:e,target:c}}(e),t?t(n):c.dispatchEvent(n.type,n)}function v(){d&&(r.unpublishSeeder(e),o.disallowTx(e),o.removeEventListener("txcomplete"+e,b),o.removeEventListener("newtxtransfer"+e,h),o.removeEventListener("txaborted"+e,E),d=s.NO),l=!0}function g(e){!function(e){e.removeEventListener("disposed",m),u||e.removeEventListener("load",T)}(e),v(),f("disposed")}function m(e){g(e.target)}function y(t,n){var r;t||(e=n,l?v():(d===s.NO&&(a.getSoi()||i.setSoi(a,e),o.allowTx(e,a),o.addEventListener("txcomplete"+e,b),o.addEventListener("newtxtransfer"+e,h),o.addEventListener("txaborted"+e,E)),(d=u?s.FULL:s.PARTIAL)===s.FULL?(r={type:"seeding",target:c},c.dispatchEvent(r.type,r)):(r={type:"seedingpartial",target:c},c.dispatchEvent(r.type,r))))}function h(t){s.NO,t.type="newtxtransfer",t.soi=e,p(t)}function b(t){s.NO,t.type="txcomplete",t.soi=e,p(t)}function E(t){s.NO,t.type="txaborted",t.soi=e,p(t)}function T(){a.removeEventListener("load",T),u=!0,d===s.FULL||l||r.publishSeeder(e,t,a.getByteLength(),y)}function w(){d!==s.NO||l||r.publishSeederPartial(e,t,y),a.removeEventListener("progress",w)}return c.seed=function(){u?T():(a.addEventListener("load",T),a.addEventListener("progress",w))},c.stop=function(){v()},c.getSoi=function(){return e},c.getUrl=function(){return t},c.setMetadata=function(e){a&&a.setMetadata(e)},teltoo.utils.eventualize(c),n instanceof Blob?a=i.store(e,n):"object"==typeof n?a=n:f("error"),a.addEventListener("disposed",m),c.setPostAdditionProcessor("seeding",function(e,t){d!==s.NO&&f("seeding",t)}),c},teltoo.objectsCacheManager=function(e,t,n){var r,o={},i={},a={},s=[],c=[],d=0;function l(e,t,n){var r=!1;if(void 0===n&&e!==s)r=!0;else if(void 0===n)s.push(t);else if(i[n]&&e===i){var o=i[n];p(o),o.dispose(),e[n]=t,c.push(t)}else e[n]=t,c.push(t);return r?void 0:t}function u(e,t,n){var r;if(e===s)(r=s.indexOf(t))<0||s.splice(r,1);else{void 0===n||e[n]&&(delete e[n],e===i&&(r=c.indexOf(t),c.splice(r,1)));var o=function(e,t){for(var n in e)if(e[n]===t)return n}(a,t);o&&delete a[o]}}function p(e){e.removeEventListener("load",m),e.removeEventListener("disposed",g),e.removeEventListener("error",y),e.getSoi()?u(i,e,e.getSoi()):u(s,e)}function f(e){var t=e.getSoi();t?l(i,e,t):l(s,e),e.addEventListener("load",m),e.addEventListener("disposed",g),e.addEventListener("error",y)}function v(e){var t;return(t=function(e){for(var t,n,r=c.length,o=0;o<r;o++)if("load"===(n=c[o]).getStatus()&&e!==n){t=n;break}return t}(e))||(t=function(e){for(var t,n,r=s.length,o=0;o<r;o++)if("load"===(n=s[o]).getStatus()&&e!==n){t=n;break}return t}(e)),t&&(p(t),t.dispose()),t}function g(e){p(e.target)}function m(t){var n=t.target;!function(t){var n,r=5e3;for(d+=t.getByteLength();d>e&&r--&&(n=v(t));)d-=n.getByteLength()}(n)}function y(e){!function(e){p(e),setTimeout(e.dispose,0)}(e.target)}return o.getObject=function(e){return i[e]},o.store=function(e,t){var n=teltoo.objectBuilder(e,t);return n&&f(n),n},o.getObjectByUrl=function(e){return a[e]},o.storeByUrl=function(e){if(!a[e]){var t=teltoo.objectBuilder();return t&&(a[e]=t,f(t)),t}},o.setSoi=function(e,t){e.getSoi()||(u(s,e),e.setSoi(t),l(i,e,t))},r=t.getClientDeviceConfig()||{},t.addEventListener("sessionstatuschange",function(e){"reconnecting"===e&&function(){for(var e in i)d-=i[e].getByteLength(),p(i[e]);for(var t=0;t<s.length;t++)d-=s[t].getByteLength(),u(s,s[t])}()}),isNaN(r.cacheSize)?"number"==typeof e||(e=31457280):e=parseInt(r.cacheSize,10),teltoo.Modernizr.blobconstructor?n("ready"):n("unsupported"),o},teltoo.objectsRetrievalManager=function(e,t,n,r,o,i){var a={},s={},c={},d=[];function l(e,t,n){void 0===n||e[n]||(e[n]=t)}function u(e,t,n){void 0===n||e[n]&&delete e[n]}function p(e,t){var n;return void 0===t||e&&e[t]&&(n=e[t]),n}function f(e,t){e.removeEventListener("load",g),e.removeEventListener("error",v),u(s,0,t);var n=e.getUrl();n&&u(s,0,n)}function v(e){var t=e.target;f(t,t.getSoi())}function g(e){var t=e.target,n=e.objectBuilder,r=t.getSoi();f(t,r),R(r,void 0,n)}function m(e){e.removeEventListener("disposed",h),e.removeEventListener("error",y),e.removeEventListener("seeding",b),e.removeEventListener("seedingpartial",b),e.removeEventListener("newtxtransfer",S),e.removeEventListener("txcomplete",T),e.removeEventListener("txaborted",w),u(c,0,e.getSoi())}function y(e){var t,n=e.target;m(n),(t=d.indexOf(n.getSoi()))>=0&&(E("error",void 0,0),d.splice(t,1))}function h(e){m(e.target)}function b(e){var t=e.target,n=t.getSoi();p(c,n)||(u(c,0,t.getUrl()),l(c,t,n)),"seeding"===e.type&&a.dispatchEvent("seeding"+n,n)}function E(t,n,r,o,i,a){e.reportTxTransferFinished(t,n,r,o,i,a)}function T(e){E("completed",e.targetPeerId,e.txBytes,e.soi,e.connected,e.txTime)}function w(e){E("aborted",e.targetPeerId,e.txBytes,e.soi,e.connected,e.txTime)}function S(e){d.push(e.soi)}function R(o,i,a){var s;if(!e.isBlacklisted())return o&&(s=p(c,o)),s||(s=teltoo.objectSeeder(o,i,a,e,n,t),l(c,s,o||i),s.addEventListener("disposed",h),s.addEventListener("error",y),s.addEventListener("seeding",b),s.addEventListener("seedingpartial",b),s.addEventListener("newtxtransfer",S),s.addEventListener("txcomplete",T),s.addEventListener("txaborted",w),r.isSeedingAllowed()&&s.seed()),s}function C(){return n.getWhitelist()}function L(e){var t=e.target,n=e.soi;e.url;t.removeEventListener("soistatus",L),l(s,t,n),R(n,void 0,t.getObjectBuilder())}return a.getWhitelist=function(){return C()},a.fetchBySoi=function(r){var o,i=p(s,r);i||(i=teltoo.objectLeecher(e,t,n),l(s,i,r),i.addEventListener("load",g),i.addEventListener("error",v),o=C(),i.leechBySoi(r,o),R(r,void 0,i.getObjectBuilder()));return i},a.fetchByUrl=function(r){var o=p(s,r);if(o);else{o=teltoo.objectLeecher(e,t,n),l(s,o,r),o.addEventListener("soistatus",L),o.addEventListener("load",g),o.addEventListener("error",v);var i=C();o.leechByUrl(r,i)}return o},a.seed=function(e,t,n){return R(t,n,e)},a.abort=function(e,t,n){var r;(r=p(s,e))&&(f(r,e),r.abort(t,n))},teltoo.utils.eventualize(a),i("ready"),a},teltoo.rxTransfer=function(e,t,n,r,o){var i,a,s,c={},d=[];function l(n,r,o){i||(i=performance.now(),a=n.body.byteLength),e?n.soi:e=n.soi,s=o,d.indexOf(r)<0&&d.push(r),t.setPcId(s),t.write(n.body,n.offset,n.fullEntityLength)}function u(e){var t=e.target,n=t.getRemotePeerId(),r=d.indexOf(n);r>=0&&d.splice(r,1)}function p(n){var o=-1;i&&(o=performance.now()-i,t.getByteLength()>a&&(o=o*t.getByteLength()/(t.getByteLength()-a))),o<=0&&(o=1);var s={};g(),function(){for(var t=d.length-1;t>=0;t--)r.sendSoiRxAck(d[t],e)}(),s.type="complete",s.target=c,s.objectBuilder=t,s.rxTime=o,c.dispatchEvent(s.type,s)}function f(){g()}function v(){var e={};g(),e.type="error",e.target=c,c.dispatchEvent(e.type,e)}function g(){n?r.removeEventListener("new_file_piece"+n,l):r.removeEventListener("new_file_piece"+e,l),r.removeEventListener("connectionclose",u),t.removeEventListener("load",p),t.removeEventListener("disposed",f),t.removeEventListener("error",v)}return c.abort=function(n,a,l,u){var p={},f=-1;i&&(f=performance.now()-i),g();for(var v=r.getConnectedPeersList(),m=0;m<d.length;m++)o.getClientDeviceConfig().rxTransferCloseOnAbort?r.close(d[m]):r.sendAbort(d[m],e);p.type="aborted",p.target=c,p.rxTime=f,c.dispatchEvent(p.type,p),"noavailability"!==n&&"unsupported"!==n&&o.reportTransferAborted(e||u,n,t.getReceivedBytes(),"P2P",f,a,t.getMetadata(),v,s,l)},c.getRemoteSenders=function(){return d},c.getSoi=function(){return e},c.getTransferId=function(){return n},teltoo.utils.eventualize(c),n?r.addEventListener("new_file_piece"+n,l):r.addEventListener("new_file_piece"+e,l),r.addEventListener("connectionclose",u),t.addEventListener("load",p),t.addEventListener("disposed",f),t.addEventListener("error",v),c},teltoo.sharedFile=function(e,t){var n,r,o,i,a,s,c,d,l=.625,u=2e3,p=-1,f=!1,v={};v.retrievalMethod="undefined";var g,m,y,h=0,b=0,E=0,T=0,w=!1,S=!1,R=!1,C=performance.now(),L=t?t.getClientDeviceConfig():{},P=function(n,r,o,i,a,s,c,d,l,u){var p,f,g=performance.now()-C,m={type:v.segmentType,duration:v.segmentDuration,playlistId:v.playlistId,playlistGroupId:v.playlistGroupId,bitrate:v.bitrate};p=t.getHttpPredictedRxMsec(m.bitrate,m.duration),f=L.enableP2pConditionalLeeching?t.getQualityDegradationThresholdSeconds(m.duration):v.qualityThresholdTime,"P2P"===i&&(u=v.adaptiveTimeout),t.reportTransferCompleted(e,n,r,o,i,a,s,g,c,m,d,l,p,u,f),P=function(){}};function O(){window.clearTimeout(s),window.clearTimeout(o),window.clearTimeout(i)}function x(){window.clearTimeout(a)}function I(e){_(),r=void 0,!1===f&&U({reason:"error",error:e})}function A(e){q("seeding"),r.removeEventListener("seeding",A)}function k(e){x();try{var t=e.target;n=t.getSoi(),O(),"blob"===v.responseType?v.response=t.getObjectBuilder().toBlob():"arraybuffer"===v.responseType?v.response=t.getObjectBuilder().toArrayBuffer():v.response=t.getObjectBuilder().toBlob(),"P2P"===t.retrievalMethod?(b=t.p2pRxTime,E=v.response.size||v.response.byteLength):"P2P+HTTP"===t.retrievalMethod?b=t.p2pRxTime:"CACHE"===t.retrievalMethod&&(E=v.response.size||v.response.byteLength);var r=t.getObjectBuilder().getPcId();P(n,E,T,t.retrievalMethod,b,h,t.getSoiQueryTime(),r,c,d),v.retrievalMethod=t.retrievalMethod,v.dispatchEvent(e.type,{type:e.type,target:v})}catch(e){U({reason:"error",error:e})}}function M(e){0===e.availability&&U({reason:"noavailability",error:e,timeout:0})}function N(e){var t=e.loaded;void 0!==i&&t>0&&(window.clearTimeout(i),i=void 0)}function _(){r&&(r.removeEventListener("error",I),r.removeEventListener("progress",N),r.removeEventListener("load",k),r.removeEventListener("soistatus",M),r.removeEventListener("seeding",A))}function D(){f&&(f.onload=void 0,f.onerror=void 0,f.ontimeout=void 0,f.onprogress=void 0)}function B(n,r,o,i){var a={url:e,isRangeRequestInProcess:w,range:g};if(t.setHttpRangeHeaderEnabled(!1),D(),f=!1,U(r),i)for(var s in i)a[s]=i[s];t.reportError("xhrRangeError_"+o,JSON.stringify(a))}var U=function(o){if(c=o.reason,d=o.timeout,O(),!1!==f);else{var i;for(var a in f=new XMLHttpRequest,w=!1,f.open("GET",e),f.responseType=v.responseType||"blob",v.httpRequestHeaders)f.setRequestHeader(a,v.httpRequestHeaders[a]);r&&(r.stopLeeching(o.reason,o.timeout),t.isHttpRangeHeaderEnabled()&&r.getReceivedBytesP2p()>0&&(g=r.getMissingRanges())&&(f.responseType="arraybuffer",f.setRequestHeader("Range","bytes="+g),w=!0,S=-1!==g.indexOf(",")));f.onload=function(a){x();var s=performance.now();if(h=s-i,E=r?r.getReceivedBytesP2p():0,T=a.target.response.byteLength,206===a.target.status){var c=a.target.getResponseHeader("Content-Type");return-1!==c.indexOf("multipart/byteranges")?function(e){T=0;var t=e.target.getResponseHeader("Content-Type");if(!t)return B(0,o,"noContentType");var n=0,i=t.match(/boundary=(.+)$/i);if(i.length<2)return B(0,o,"boundaryLength");i=i[1];for(var a=e.target.response.byteLength;n<a;){var s=a-n<512?a-n:512,c=new Uint8Array(e.target.response,n,s),d=String.fromCharCode.apply(String,c);if(d==="\r\n--"+i+"--\r\n")break;var l=new RegExp("\r\n--"+i+"\r\n((.|\r\n)*)\r\n\r\n"),u=d.match(l);if(!u)return B(0,o,"noPartHeader");if(u.length<2)return B(0,o,"partHeaderLength");for(var p=n+d.indexOf("\r\n\r\n")+4,f=u[1].match(/(.*): (.*)/g),v=0,g=!1,m=0;m<f.length;m++){var y=f[m].match(/Content-Range: bytes (\d+)-(\d+)\/(\d+)/i);if(y&&y.length>=3){var h=parseInt(y[1]),b=parseInt(y[2]),E=parseInt(y[3]);T+=v=b-h+1;var w=e.target.response.slice(p,p+v);r.addMissingRange(w,h,E),g=!0}}if(!g)return B(0,o,"noContentRangeFound");n=p+v}if(r.getMissingBytes()>0){var S={soMissingBytes:r.getMissingBytes()};return B(0,o,"incompleteResponse",S)}D()}(a):S?B(0,o,"expectedMultipart",{contentType:c}):function(t){var n=g.split("-"),i=parseInt(n);if(t.target.response.byteLength,r.addMissingRange(t.target.response,i,0),r.getMissingBytes()>0)return B(0,o,"incompleteResponse",{url:e,soMissingBytes:g});D()}(a)}if(200===a.target.status){var d,l;if(v.retrievalMethod="HTTP",f.retrievalMethod="HTTP",v.responseType=f.responseType,v.response=f.response,"arraybuffer"!==v.responseType&&"blob"!==v.responseType||(l=f.getResponseHeader("content-type"),d=new Blob([f.response],{type:l})),r&&(n=r.getSoi())&&(p=r.getSoiQueryTime()),P(n,0,d.size,"HTTP",b,h,p,void 0,o.reason,o.timeout),v.dispatchEvent(a.type,{type:a.type,target:f}),t.updateHttpThroughput(d.size,performance.now()-i),"arraybuffer"!==v.responseType&&"blob"!==v.responseType);else if(R)if(_(),r)r.setBlob(n,d),r.addEventListener("seeding",A);else switch(o.reason){case"p2pnotallowedforurl":case"blacklisted":break;default:(r=teltoo.sharedObject(d,n||e,t)).addEventListener("seeding",A)}d=void 0,D()}else{if(416===a.target.status){var u={contentRange:a.target.getResponseHeader("Content-Range")};return B(0,o,"unexpectedStatus"+a.target.status,u)}if(w&&400===a.target.status)return B(0,o,"unexpectedStatus"+a.target.status);v.status=a.target.status;var m={type:"error",target:v};v.dispatchEvent(m.type,m);var y={url:e,isRangeRequestInProcess:w,range:g};t.reportError("unexpectedStatus"+a.target.status,JSON.stringify(y))}},f.onerror=function(n){if(x(),D(),w)return B(0,o,"xhrError");var r={};r.type=n.type,r.target=v,v.dispatchEvent(r.type,r);var i={url:e,isRangeRequestInProcess:w,range:g};t.reportError("xhrError",JSON.stringify(i))},f.ontimeout=function(e){x(),D();var t={};t.type=e.type,t.target=e.target,v.dispatchEvent(t.type,t)},f.onprogress=function(e){var t={};t.type=e.type,t.target=v,v.dispatchEvent(t.type,e)},i=performance.now(),f.send()}};function j(){H(),U({reason:"error"})}function G(){H(),U({reason:"unsupported"})}function F(){H(),"abort"!==y&&(L=t.getClientDeviceConfig()||{},!0===m||f||((r=teltoo.sharedObject(e,t)).setMetadata({type:v.segmentType,duration:v.segmentDuration,playlistId:v.playlistId,playlistGroupId:v.playlistGroupId,bitrate:v.bitrate}),r.addEventListener("error",I),r.addEventListener("progress",N),r.addEventListener("load",k),r.addEventListener("soistatus",M),r.addEventListener("seeding",A)))}var z=!1;function H(){z||(z=!0,t.removeEventListener("unsupported",G),t.removeEventListener("error",j),t.removeEventListener("ready",F))}function W(e,t){var r;r=function(e){var t;t="seeding"===e?{type:"seeding",target:v,soi:n}:{type:e,target:v};return t}(e),t?t(r):v.dispatchEvent(r.type,r)}function q(e){y=e,W(e)}if(teltoo.utils.eventualize(v),v.abort=function(){O(),x(),D(),_(),H(),f&&f.abort(),r&&r.abort("sharedfileabort",0),q("abort")},e)try{v.responseType="blob",t||(teltoo.singletonClientMiddleware||(teltoo.singletonClientMiddleware=teltoo.clientMiddlewareSession()),t=teltoo.singletonClientMiddleware),setTimeout(function(){if("abort"!==y)if(v.timeout&&(a=setTimeout(function(){O(),D(),_(),f&&f.abort(),r&&r.abort("sharedfiletimeout",v.timeout);var e={type:"timeout"};e.target=v,v.dispatchEvent(e.type,e)},v.timeout)),t.isP2pAllowedForUrl(e))if(t.isBlacklisted())U({reason:"blacklisted",timeout:0});else{l=L.httpFallbackTimeoutSegmentDurationRate||l,u=L.maxTimeToFirstByte||u;var n=5e3;L.httpFallbackTimeoutDefault?n=L.httpFallbackTimeoutDefault:v.segmentDuration&&(n=1e3*v.segmentDuration*l);var c={};t.isP2pEnabled()?t.isP2pPossibleBasedOnConditionalLeeching(v.bitrate,v.segmentDuration,n,c)?(m=!1,0===v.adaptiveTimeout?U({reason:"adaptivetimeout",timeout:v.adaptiveTimeout}):v.adaptiveTimeout>0&&(s=setTimeout(function(){U({reason:"adaptivetimeout",timeout:v.adaptiveTimeout})},v.adaptiveTimeout)),o=setTimeout(function(){U({reason:"timeout",timeout:n})},n),i=setTimeout(function(){U({reason:"firstbytetimeout",timeout:u})},u)):(m=!0,U({reason:c.value||"conditionalleeching",timeout:0})):(m=!0,U({reason:"directhttpfetchsbeforeactivatep2p",timeout:0})),R=!0,t.addEventListener("unsupported",G),t.addEventListener("error",j),t.addEventListener("ready",F)}else U({reason:"p2pnotallowedforurl",timeout:0})},0)}catch(e){U({reason:"error",error:e})}else;return v.setPostAdditionProcessor("seeding",function(e,t){e===y&&W(e,t)}),v},teltoo.sharedObject=function(e,t,n){var r,o,i,a,s,c,d,l,u={},p=!1,f=!1,v=!1,g=!1;function m(e,t){var n;"string"==typeof e?n=function(e){return{type:e,target:u}}(e):(n=e).target=u,t?t(n):u.dispatchEvent(n.type,n)}function y(e){(i=e).setMetadata(l),p=!0,m("load")}function h(e){v=!0,k(),m("error")}function b(e){v=!0;e.target;k(),m("error")}function E(e){m(e)}function T(e){var t=e.target;a||(a=t.getSoi()),u.retrievalMethod="P2P",u.p2pRxTime=e.rxTime,y(e.objectBuilder)}function w(e){g=!1,u.retrievalMethod||(u.retrievalMethod="P2P+HTTP"),a||(a=e.target.getSoi()),y(e.target),(o=d.getObjectsRetrievalManager().seed(e.target,a,s)).addEventListener("seeding",L),o.addEventListener("error",R),o.addEventListener("disposed",C)}function S(){f=!0,m("seeding"),d.getObjectsRetrievalManager().removeEventListener("seeding"+a,S)}function R(e){v=!0;e.target;k(),m("error")}function C(e){e.target;k(),m("disposed")}function L(e){var t=e.target;a||(a=t.getSoi()),t.setMetadata(l),f=!0,m("seeding")}function P(e){var t=e.target;a||(a=t.getSoi(),d.getObjectsRetrievalManager().addEventListener("seeding"+a,S)),0===e.availability&&m(e)}function O(e,t){p&&m("load",t)}function x(e,t){f&&m("seeding",t)}function I(e,t){v&&m("error",t)}function A(){r&&(r.removeEventListener("load",T),r.removeEventListener("progress",E),r.removeEventListener("error",b),r.removeEventListener("soistatus",P))}function k(){A(),d.getObjectsRetrievalManager()&&d.getObjectsRetrievalManager().removeEventListener("seeding"+a),o&&(o.removeEventListener("seeding",L),o.removeEventListener("disposed",C),o.removeEventListener("error",R)),i&&g&&(i.removeEventListener("load",w),i.removeEventListener("error",h),i=null),u.removePostAdditionProcessor("load",O),u.removePostAdditionProcessor("seeding",x),u.removePostAdditionProcessor("error",I)}function M(){d.removeEventListener("error",N),d.removeEventListener("unsupported",_),d.removeEventListener("ready",M),void 0!==c?(o=d.getObjectsRetrievalManager().seed(c,a,s),c=void 0,o.addEventListener("seeding",L),o.addEventListener("error",R),o.addEventListener("disposed",C)):a?(i=d.getObjectsCacheManager().getObject(a))?(u.retrievalMethod="CACHE",u.loadTime=0,"load"===i.getStatus()?y(i):i.addEventListener("load",w)):(d.getObjectsRetrievalManager().addEventListener("seeding"+a,S),(r=d.getObjectsRetrievalManager().fetchBySoi(a))?(i=r.getObjectBuilder(),r.startTime=performance.now(),r.addEventListener("load",T),r.addEventListener("progress",E),r.addEventListener("error",b),r.addEventListener("soistatus",P)):(v=!0,m("error"))):s&&((i=d.getObjectsCacheManager().getObjectByUrl(s))?(u.retrievalMethod="CACHE",u.loadTime=0,"load"===i.getStatus()?y(i):i.addEventListener("load",w)):(r=d.getObjectsRetrievalManager().fetchByUrl(s))?(i=r.getObjectBuilder(),r.startTime=performance.now(),r.addEventListener("load",T),r.addEventListener("progress",E),r.addEventListener("error",b),r.addEventListener("soistatus",P)):(v=!0,m("error")))}function N(){d.removeEventListener("error",N),d.removeEventListener("unsupported",_),d.removeEventListener("ready",M),k()}function _(){d.removeEventListener("error",N),d.removeEventListener("unsupported",_),d.removeEventListener("ready",M),k()}if(u.getSoi=function(){return a},u.getSoiQueryTime=function(){return r?r.getJoinQueryTime():-1},u.getObjectBuilder=function(){return i},u.getReceivedBytesP2p=function(){return i?i.getReceivedBytes():0},u.getMissingRanges=function(){return!!i&&i.getMissingRanges()},u.getMissingBytes=function(){return i?i.getMissingBytes():-1},u.addMissingRange=function(e,t,n){i&&i.write(e,t,n)},u.setMetadata=function(e){l=e,i&&i.setMetadata(l)},u.setBlob=function(e,t){e!==a||t instanceof Blob&&i&&g&&(u.retrievalMethod="HTTP",i.setBlob(t))},u.abort=function(e,t){k(),d.getObjectsRetrievalManager().abort(a||s,e,t)},u.stopLeeching=function(e,t){r&&(u.p2pRxTime=performance.now()-r.startTime,A(),d.getObjectsRetrievalManager().abort(a||s,e,t)),g=!0,i&&i.addEventListener("load",w)},"string"==typeof e||"number"==typeof e)"number"==typeof e?a=e:s=e,"object"==typeof t&&(d=t);else{if(!(e instanceof Blob||e instanceof ArrayBuffer||e.buffer instanceof ArrayBuffer))throw new Error("param 1 invalid parameter type");if(c=e instanceof Blob?e:new Blob([e]),"string"==typeof t||"number"==typeof t)"number"==typeof t?a=t:s=t;else if(void 0===t);else{if("object"!=typeof t)throw new Error("param 2 invalid parameter type");d=t}if("object"==typeof n&&void 0===d)d=n;else if(n)throw new Error("param 3 invalid parameter type")}return teltoo.utils.eventualize(u),d||(d=teltoo.clientMiddlewareSession()),u.setPostAdditionProcessor("load",O),u.setPostAdditionProcessor("seeding",x),u.setPostAdditionProcessor("error",I),d.addEventListener("error",N),d.addEventListener("unsupported",_),d.addEventListener("ready",M),u},teltoo.signallingSession=function(e,t,n,r,o,i){function a(e){"\n"===e[e.length-1]&&(e=e.substring(0,e.length-1))}var s,c,d={CLOSED:"closed",CONNECTING:"connecting",RECONNECTING:"reconnecting",READY:"ready",UNSUPPORTED:"unsupported",ERROR:"error"},l={},u=d.CONNECTING,p={},f=!1,v=!0,g=0,m=teltoo.signalling.createDictionaryWithTypes(teltoo.serializerWithDictionary.TYPES),y=teltoo.serializerWithDictionary.create(m.dictionary),h="rtve-a.aws.teltoo.com",b="/5c757a95";function E(e,t,n){u=e,l.dispatchEvent("sessionstatuschange",u,t,n)}function T(e){var o;if("string"==typeof e.data)o=JSON.parse(e.data);else try{o=y.arraybufferToMessage(e.data)}catch(e){}if(a("[signallingSession]: ("+c+") handleSignallingMessage: ",o.type),o=function(e){try{if(e.type){switch(e.type){case"hello":e=function(e){var t;e.to&&(void 0!==e.cfg&&"object"!=typeof e.cfg||(t=e));return t}(e);break;case"offer":e=w(e);break;case"answer":e=function(e){return w(e)}(e);break;case"candidate":e=function(e){var t;e.from&&(e.to!==c||e.to&&(e.to===e.from||e.candidate&&(t=e)));return t}(e);break;case"abortpeerconnection":e=function(e){var t;e.target&&e.to&&(e.to!==c||(t=e));return t}(e);break;case"push":e=function(e){var t;e.to&&(e.to!==c||e.target&&(t=e));return t}(e);break;case"soiqueryanswer":e=function(e){var t;e.url&&(t=e);return t}(e);break;case"soistatus":e=function(e){var t;e.to!==c||"string"!=typeof e.token&&"number"!=typeof e.token||"number"!=typeof e.availability||(t=e);return t}(e);break;case"blacklist":e=function(e){var t;e.to!==c||"boolean"!=typeof e.blacklisted||(t=e);return t}(e);break;case"joinanswer":e=function(e){var t;e.to!==c||"string"!=typeof e.token&&"number"!=typeof e.token||"number"!=typeof e.availability||"string"!=typeof e.url||(t=e);return t}(e);break;case"connect":e=function(e){var t;e.to&&(e.to!==c||(t=e));return t}(e);break;default:e=void 0}return e}}catch(e){}}(o)){switch(o.type){case"hello":!function(e){var o=!1;c&&(o=!0);c=e.to,p=function(e){var t={cacheSize:"integer",httpRangeHeaderEnabled:"boolean",reconnectTries:"integer",reconnectStart:"integer",reconnectEnd:"integer",maxTimeToFirstByte:"integer",httpFallbackTimeoutDefault:"integer",httpFallbackTimeoutSegmentDurationRate:"float",stunServer:"string",directHttpFetchsBeforeActivateP2p:"integer",rxTransferCloseOnAbort:"boolean",txTransferCloseOnAbort:"boolean",maxTxTime:"integer",signallingSerialize:"boolean",sharedFileUrlBlacklistFilter:"string",mobileSeedingAllowed:"string",consecutiveRxAbortsBeforeRemovingPeerFromWhitelist:"integer",consecutiveDisconnectsBeforeRemovingPeerFromWhitelist:"integer",rtcPeerConnectionTimeout:"integer",disableTrickleIce:"boolean",enableP2pConditionalLeeching:"boolean",qualityDegradationThresholdRate:"float",allowSeedingOnDeviceAndConnectionTypeMap:"string",maxPeerConnections:"integer",enableAdaptiveFallbackTimeout:"boolean",adaptiveFallbackTimeoutGuardBand:"float",websocketIdleTimeout:"integer",enableSRT:"boolean"},n={};for(var r in e)t[r]&&("boolean"===t[r]?n[r]="1"===e[r]:"integer"===t[r]?isNaN(e[r])||(n[r]=parseInt(e[r])):"float"===t[r]?isNaN(e[r])||(n[r]=parseFloat(e[r])):"string"===t[r]&&(n[r]=e[r]));var o="";return Object.keys(n).forEach(function(e,t){o=o.concat(e,":",n[e],",")}),o.length,n}(e.cfg),t=p.reconnectTries||t,n=p.reconnectStart||n,r=p.reconnectEnd||r,E(d.READY),O(),"function"==typeof i&&(o||i(u))}(o);break;case"soiqueryanswer":l.dispatchEvent("soiqueryanswersuccess"+o.url,o.token);break;case"blacklist":!function(e){f=e.blacklisted}(o);break;case"joinanswer":l.dispatchEvent("joinanswer"+o.url,o)}l.dispatchEvent(o.type,o),o.token&&l.dispatchEvent(o.type+o.token,o),o.from&&l.dispatchEvent(o.type+o.from,o),o.target&&l.dispatchEvent(o.type+o.target,o)}else;}function w(e){var t;return e.from&&(e.to!==c||e.to&&(e.to===e.from||e.sdp&&(t=e))),t}function S(e){}function R(e){if(v&&1002!==e.code)if(g<t){E(d.RECONNECTING),g++;var o=Math.floor(Math.random()*(r-n+1))+n;setTimeout(P,o)}else E(d.ERROR);else E(d.CLOSED)}function C(e){var t;g=0,t={type:"hello",origin:window.location.href,apiKey:teltoo.utils.getApiKey(),deviceType:o.getDeviceType(),connectionType:o.getConnectionType()},c&&(t.from=c),!1===L(t)?i("error"):a("sent origin URL hello: "+t.origin)}function L(e){e.outts=Date.now();try{var t=y.messageToArrayBuffer(e);if(s.readyState!==WebSocket.OPEN)return!1;s.send(t),a("[signallingSession]: ("+c+") sent message: ")}catch(e){}}function P(){var t;if(t=e||"wss://"+h,t+=b,u!==d.CLOSED)try{(s=new WebSocket(t,m.dictionary.TELTOO_WEBSOCKET_PROTOCOL)).binaryType="arraybuffer",s.onmessage=T,s.onopen=C,s.onerror=S,s.onclose=R}catch(e){E(d.ERROR),"function"==typeof i&&i(u)}}function O(){if(u===d.READY&&p&&p.websocketIdleTimeout>0){L({type:"heartbeat"});var e=1e3*p.websocketIdleTimeout;setTimeout(O,e)}}return t=t||5,n=n||500,r=r||3e3,l.publishSeeder=function(e,t,n,r){if("function"!=typeof r)throw new Error("invalid parameter types: ("+e+","+r);if("ready"!==u)r(new Error("session not ready. Current status: "+u));else{if(e||t){var o={type:"join",from:c,seeder:!0,leecher:!1,bytes:n};return e?o.token=e:o.url=t,L(o),a("[signallingSession]: published seeder to soi: "+e),e?r(null,e):l.addEventListener("joinanswer"+t,function n(o){l.removeEventListener("joinanswer"+t,n),e=o.token,r(null,e)}),l}r(new Error("[signalingSession]: publishSeeder no soi nor url"))}},l.publishSeederPartial=function(e,t,n){if("function"!=typeof n)throw new Error("invalid parameter types: ("+e+","+n);if("ready"===u){var r={type:"join",from:c,seeder:!0,leecher:!0};return e?r.token=e:r.url=t,L(r),a("[signallingSession]: published seeder to soi: "+e),e?n(null,e):l.addEventListener("joinanswer"+t,function r(o){l.removeEventListener("joinanswer"+t,r),e=o.token,n(null,e)}),l}n(new Error("session not ready. Current status: "+u))},l.unpublishSeeder=function(e){if("ready"!==u);else if(void 0!==e)return L({type:"join",token:e,from:c,seeder:!1}),a("[signallingSession]: Unpublished seeder ("+c+") to soi: "+e),l},l.publishLeecher=function(e,t){if("ready"!==u)throw new Error("session not ready. Current status: "+u);if(void 0===e)throw new Error("cannot create a leecher without a SOI");return L({type:"join",token:e,from:c,leecher:!0,wl:t}),a("[signallingSession]: published leecher to soi: "+e),l},l.publishLeecherByUrl=function(e,t,n){if("ready"!==u)throw new Error("session not ready. Current status: "+u);return L({type:"join",url:e,transferId:t,from:c,leecher:!0,wl:n}),a("[signallingSession]: published leecher to url: "+e),l},l.unpublishLeecher=function(e){},l.getSoiFromUrlAndCredentials=function(e,t,n,r){var o={type:"soiquery",from:c,url:e,credentials:t};l.addEventListener("soiqueryanswersuccess"+e,function t(r){var o=performance.now()-i;l.removeEventListener("soiqueryanswersuccess"+e,t);n(r,o)});var i=performance.now();L(o)},l.getPeerId=function(){return c},l.isBlacklisted=function(){return f},l.sendAnswer=function(e,t,n){L({type:"answer",from:c,to:e,sdp:t,pcid:n})},l.sendOffer=function(e,t,n){L({type:"offer",from:c,to:e,sdp:t,pcid:n})},l.sendCandidate=function(e,t,n){L({type:"candidate",from:c,to:e,candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,ufrag:t.usernameFragment||"",pcid:n})},l.reportTransferCompleted=function(e,t,n,r,o,i,a,s,d,l,u,p,f,v){var g={type:"transferstatus",from:c,status:"completed",p2pRxTime:o,httpRxTime:i,retrievalMethod:r,soiFetchTime:s,fft:a};e>0&&(g.soi=e),l&&(g.pcid=l),u&&(g.reason=u),p&&(g.httpPredictedRxTime=p),f&&(g.timeoutValue=f),v&&(g.qualityDegradationThreshold=v),"CACHE"===r?(g.byteLength=t,g.httpRxBytes=0,g.p2pRxBytes=0):(g.p2pRxBytes=t,g.httpRxBytes=n,g.byteLength=n+t),d&&(d.type&&(g.segmentType=d.type),d.duration&&(g.segmentDuration=d.duration),void 0!==d.bitrate&&(g.bitrate=d.bitrate),d.playlistId&&(g.playlistId=d.playlistId),d.playlistGroupId&&(g.playlistGroupId=d.playlistGroupId)),L(g)},l.reportTransferAborted=function(e,t,n,r,o,i,a,s,d,l){var u={type:"transferstatus",from:c,status:"aborted",reason:t,p2pRxTime:o,p2pRxBytes:n,retrievalMethod:r,soiFetchTime:i,peersConnected:s,pcid:d};e>0&&(u.soi=e),a&&(a.type&&(u.segmentType=a.type),a.duration&&(u.segmentDuration=a.duration),void 0!==a.bitrate&&(u.bitrate=a.bitrate),a.playlistId&&(u.playlistId=a.playlistId),a.playlistGroupId&&(u.playlistGroupId=a.playlistGroupId)),l&&(u.timeoutValue=l),L(u)},l.reportPeerConnectionStatus=function(e,t,n,r){var o={type:"peerconnectionstatusmetric",from:c,to:e,status:t,pcid:r};n&&(o.delay=n),L(o)},l.reportTxTransferFinished=function(e,t,n,r,o,i){var a={type:"txTransferFinished",from:c,status:e,txBytes:n,soi:r,isPeerConnected:o,txTime:i};t&&(a.target=t),L(a)},l.reportError=function(e,t){L({type:"clientError",error:e,message:t,ua:navigator?navigator.userAgent:"unknown"})},l.getClientDeviceConfig=function(){return p},l.close=function(){v=!1,s&&s.close(),u!==d.ERROR&&E(d.CLOSED)},teltoo.utils.eventualize(l),o.addEventListener("seedingallowed",function(e){e.isseedingallowed?"ready"===u&&L({type:"join",from:c,seeder:!0}):"ready"===u&&L({type:"join",from:c,seeder:!1})}),l.setPostAdditionProcessor("sessionstatuschange",function(e,t){switch(u){case d.CONNECTING:case d.RECONNECTING:case d.READY:case d.ERROR:case d.UNSUPPORTED:case d.CLOSED:t(u)}}),teltoo.Modernizr.websockets?(E(d.CONNECTING),setTimeout(function(){P()},1)):(u="unsupported","function"==typeof i&&i("unsupported")),l},teltoo.transfersManager=function(e,t,n){var r={},o={},i=[],a={},s={},c=new Uint32Array(1);window.crypto.getRandomValues(c);var d=c[0];function l(n){var i,a=n.token,s=e.getClientDeviceConfig(),c=teltoo.txTransfer(a,n.target,o[a],n.transferId,s.maxTxTime,t,s.txTransferCloseOnAbort);(i=c).addEventListener("txcomplete",u),i.addEventListener("txaborted",p),r.dispatchEvent("newtxtransfer"+a,c),c.start()}function u(e){var t=e.soi;m(e.target),e.target=r,r.dispatchEvent(e.type,e),r.dispatchEvent(e.type+t,e)}function p(e){var t=e.soi;m(e.target),e.target=r,r.dispatchEvent(e.type,e),r.dispatchEvent(e.type+t,e)}function f(e){y(e.target)}function v(t){var n=t.target,r=e.getClientDeviceConfig().consecutiveRxAbortsBeforeRemovingPeerFromWhitelist,o=n.getRemoteSenders();y(n),void 0===r&&(r=1),o.forEach(function(e){void 0===a[e]&&(a[e]=0),a[e]=a[e]+1,a[e]>=r&&0!==r&&(g(e),delete a[e])})}function g(e){var t=i.indexOf(e);t>=0&&i.splice(t,1)}function m(e){e.removeEventListener("txcomplete",u),e.removeEventListener("txaborted",p)}function y(e){e.removeEventListener("complete",f),e.removeEventListener("aborted",v)}function h(e){o[e]&&delete o[e]}function b(e){var t=e.target,n=t.getSoi();t.removeEventListener("disposed",b),h(n)}function E(){return d++}return r.allowRx=function(n,r){var o,i=E(),a=teltoo.rxTransfer(n,r,i,t,e);return(o=a).addEventListener("complete",f),o.addEventListener("aborted",v),a},r.disallowRx=function(e){},r.allowTx=function(t,n){o[t]?e.reportError("transferManager_doubleAllowTx"):(o[t]=n,n.addEventListener("disposed",b),e.addEventListener("push"+t,l))},r.disallowTx=function(t){e.removeEventListener("push"+t,l),h(t)},r.getWhitelist=function(){return i},t.addEventListener("datachannelopen",function(e){var t,n=e.target;t=n.getRemotePeerId(),-1===i.indexOf(t)&&i.push(t)}),t.addEventListener("connectionclose",function(t){var n=t.target.getRemotePeerId(),r=e.getClientDeviceConfig().consecutiveDisconnectsBeforeRemovingPeerFromWhitelist;void 0===r&&(r=1),void 0===s[n]&&(s[n]=0),s[n]=s[n]+1,s[n]>=r&&(g(n),delete s[n])}),teltoo.utils.eventualize(r),n("ready"),r},teltoo.txTransfer=function(e,t,n,r,o,i,a){var s,c,d,l,u,p,f,v={IDLE:"idle",INPROGRESS:"inprogress",ALLSENT:"allsent",COMPLETED:"completed",ABORTED:"aborted",ERROR:"error",DISPOSED:"disposed"},g=100,m={},y=v.IDLE,h=!1;if(!o||o<=0){var b=parseInt(n.getMetadata("duration"));o=1e3*b||8e3}function E(){var e;if(p){if(p.length>0){var t=p.pop();e={offset:t.offset,buffer:t.body}}}else{var r=n.read(c,s);r&&(e={offset:c,buffer:r})}return e}function T(n){var o,a;return c>=u?o=!1:(a={soi:e,transferId:r,type:"new_file_piece",fullEntityLength:u,offset:n.offset,body:n.buffer},(o=i.send(t,a))&&(c+=a.body.byteLength)),o}function w(){var e;f||(f=performance.now());try{for(e=performance.now();y===v.INPROGRESS;)if(c===u)y=v.ALLSENT;else{var t=E();if(t)if(T(t)){if(performance.now()-e>=g){l=setTimeout(w,1);break}}else y=v.ERROR;else{if(p)break;y=v.ERROR}}}catch(e){y=v.ERROR}finally{y===v.INPROGRESS||y===v.ALLSENT||y===v.ABORTED||y===v.ERROR&&L()}}function S(){y===v.ABORTED||y===v.DISPOSED||(y=v.ABORTED,(void 0===a||a)&&i.close(t),L())}function R(){y===v.ERROR||y===v.ABORTED||y===v.COMPLETED||y===v.DISPOSED||y!==v.INPROGRESS&&y!==v.ALLSENT||S()}function C(n,r){r!==t||n.soi!==e||y===v.ERROR||y===v.ABORTED||y===v.DISPOSED||y===v.ALLSENT&&(y=v.COMPLETED,L())}function L(){var r,o=-1;f&&(o=performance.now()-f),y===v.DISPOSED||(y===v.COMPLETED?(r={type:"txcomplete",soi:e,targetPeerId:t,txBytes:c,connected:h,txTime:o,target:m},m.dispatchEvent(r.type,r)):(r={type:"txaborted",soi:e,targetPeerId:t,txBytes:c,connected:h,txTime:o,target:m},m.dispatchEvent(r.type,r))),function(){y=v.DISPOSED,clearTimeout(d),clearTimeout(l),i.removeEventListener("soi_rx_ack"+t,C),n&&(n.removeEventListener("error",O),n.removeEventListener("disposed",P),p&&n.removeEventListener("newrange",I));n=void 0}()}function P(e){}function O(e){S()}function x(e){S()}function I(e){p.push(e.newRange),w()}function A(){h=!0,"load"===n.getStatus()||(p=n.getReceivedRanges(),n.addEventListener("newrange",I)),w()}return m.start=function(){y!==v.IDLE||(y=v.INPROGRESS,i.addEventListener("soi_rx_ack"+t,C),d=setTimeout(R,o),i.connect(t,A,x))},teltoo.utils.eventualize(m),s=15360,c=0,u=n.getByteLength(),n.addEventListener("disposed",P),n.addEventListener("error",O),m},teltoo.webRtc=function(e,t){var n={},r=0;return n.connect=function(t){var n=e.getPeerId()+"-"+t+"-"+r;r++;var o=teltoo.webRtc.peerConnection(t,e,n);return o.connect(),o},teltoo.utils.eventualize(n),e.addEventListener("offer",function(t){var o=t.pcid;r++;var i=teltoo.webRtc.peerConnection(t,e,o);n.dispatchEvent("incomingconnection",i)}),teltoo.Modernizr.datachannel&&teltoo.Modernizr.peerconnection?t("ready"):t("unsupported"),n},teltoo.webRtc.peerConnection=function(e,t,n){var r,o,i,a,s={},c=!1,d=[],l=!1,u=5e3,p=!1,f=!1,v=!1,g=!1,m=performance.now(),y=!1,h=t.getClientDeviceConfig()||{},b={iceServers:[{urls:h.stunServer||"stun:stun.l.google.com:19302"}],iceTransportPolicy:"all",rtcpMuxPolicy:"require",iceCandidatePoolSize:20},E={ordered:!1,negotiated:!0,id:0},T="arraybuffer";function w(e){var t=e.split("b=AS:30");return t.length>1?t[0]+"b=AS:1638400"+t[1]:e}function S(e){if(e.candidate)e.candidate.candidate&&("new"!==s.status||v||-1===e.candidate.candidate.indexOf("TCP")&&t.sendCandidate(a,e.candidate,n));else if(v){var i=r.localDescription;i.sdp=w(i.sdp),o?t.sendAnswer(o.from,i.sdp,n):t.sendOffer(a,i.sdp,n)}}function R(e){t.reportError("icecandidateerror",JSON.stringify(e))}function C(e){t.reportError("fingerprintfailure",JSON.stringify(e))}function L(e){e.target.iceConnectionState,"gathering"===e.target.iceGatheringState?g=performance.now():!1!==g&&"complete"===e.target.iceGatheringState&&(performance.now()-g,g=!1),"new"===e.target.iceConnectionState||"checking"===e.target.iceConnectionState||"connected"===e.target.iceConnectionState||"completed"===e.target.iceConnectionState||("failed"===e.target.iceConnectionState?(y=performance.now()-m,B(),t.reportError("iceConnectionFailed",JSON.stringify(e))):"disconnected"===e.target.iceConnectionState?B():(e.target.iceConnectionState,B()))}function P(e){e.pcid=n,s.dispatchEvent("message",e,a)}function O(e){var r=e.target,o=r.readyState;"open"===e.type?(y=performance.now()-m,s.status="datachannelopen",M()):"close"===e.type?N():"error"===e.type?(N(),t.reportError("datachannelerror",JSON.stringify(e))):N();var i={type:"datachannel"+o};!1!==y&&(i.delay=y),i.pcid=n,i.target=s,s.dispatchEvent(i.type,i)}function x(e){e.binaryType=T,e.onmessage=P,e.onopen=O,e.onclose=O,e.onerror=O}function I(e){var n={type:"answer",sdp:e.sdp};r.setRemoteDescription(n).then(function(){f=!0,j()}).catch(function(e){s.dispatchEvent("error",e);var n={where:"handleAnswer",error:e.message};t.reportError("setRemoteDescription",JSON.stringify(n))})}function A(e){var n={candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.ufrag};!0!==f?d.push(n):!0!==p?d.push(n):(n=new RTCIceCandidate(n),r.addIceCandidate(n).catch(function(e){t.reportError("addIceCandidate",JSON.stringify(e))}))}function k(){!1===l&&(l=setTimeout(U,u))}function M(){!1!==l&&(window.clearTimeout(l),l=!1)}var N=function(){N=function(){},M(),o||t.removeEventListener("answer"+a,I),t.removeEventListener("abortpeerconnection"+a,D),t.removeEventListener("candidate"+a,A),t.removeEventListener("sessionstatuschange",_),i&&(i.onmessage=void 0,i.onopen=void 0,i.onclose=void 0,i.onerror=void 0,i.close&&i.close(),i=void 0),r&&(r.ondatachannel=void 0,r.onicecandidate=void 0,r.oniceconnectionstatechange=void 0,r.onnegotiationneeded=void 0,r.close&&r.close(),r=void 0);var e={type:"disposed"};e.pcid=n,e.target=s,s.status="disposed",s.dispatchEvent(e.type,e),c=!0};function _(e){"ready"!==e&&N()}function D(){N()}function B(){N()}function U(){if("datachannelopen"===s.status);else{var e={type:"peerconnectiontimeout"};e.pcid=n,e.remotePeerId=a,e.target=s,!1!==y&&(e.delay=y),s.dispatchEvent(e.type,e),N()}}function j(){var e;if(r){e=d.shift();for(var n=function(e){t.reportError("addIceCandidate",JSON.stringify(e))};e;)e=new RTCIceCandidate(e),r.addIceCandidate(e).catch(n),e=d.shift()}}if(s.accept=function(){if(o&&"offer"===o.type){k(),t.addEventListener("candidate"+a,A),t.addEventListener("abortpeerconnection"+a,D),(r=new RTCPeerConnection(b)).onicecandidate=S,r.oniceconnectionstatechange=L,r.onicecandidateerror=R,r.onfingerprintfailure=C;var e={type:"offer",sdp:o.sdp};r.setRemoteDescription(e).then(function(){f=!0,r.createAnswer().then(function(e){e.sdp=w(e.sdp),r.setLocalDescription(e).then(function(){p=!0,j()}).catch(function(e){M();var n={where:"accept",error:e.message};t.reportError("setLocalDescription",JSON.stringify(n))}),v||t.sendAnswer(o.from,e.sdp,n)}).catch(function(e){M(),s.dispatchEvent("error",e);var n={where:"accept",error:e.message};t.reportError("createAnswer",JSON.stringify(n))})}).catch(function(e){M(),s.dispatchEvent("error",e);var n={where:"accept",error:e.message};t.reportError("setLocalDescription",JSON.stringify(n))});try{x(i=r.createDataChannel(n,E))}catch(e){t.reportError("createDatachannelError",e.message)}}},s.connect=function(){k(),t.addEventListener("answer"+a,I),t.addEventListener("candidate"+a,A),t.addEventListener("abortpeerconnection"+a,D),(r=new RTCPeerConnection(b)).onicecandidate=S,r.oniceconnectionstatechange=L,r.onnegotiationneeded=function(){r.createOffer().then(function(e){e.sdp=w(e.sdp),r.setLocalDescription(e).then(function(){p=!0,v||t.sendOffer(a,e.sdp,n)}).catch(function(e){M(),s.dispatchEvent("error",e);var n={where:"connect",error:e.message};t.reportError("setLocalDescription",JSON.stringify(n))})}).catch(function(e){M(),s.dispatchEvent("error",e);var n={where:"connect",error:e.message};t.reportError("createOffer",JSON.stringify(n))})};try{x(i=r.createDataChannel(n,E))}catch(e){t.reportError("createDatachannelError",e.message)}},s.send=function(){var e=!1;try{i&&(i.send.apply(i,arguments),e=!0)}catch(e){N(),t.reportError("datachannelSend",e.message)}finally{return e}},s.getRemotePeerId=function(){return a},s.getPcId=function(){return n},s.close=function(){N()},s.status="new",teltoo.utils.eventualize(s),"string"==typeof e||"number"==typeof e)a=e;else{if("object"!=typeof e)return;a=(o=e).from}return void 0!==h.rtcPeerConnectionTimeout&&(u=h.rtcPeerConnectionTimeout),void 0!==h.disableTrickleIce&&(v=h.disableTrickleIce),t.addEventListener("sessionstatuschange",_),s.setPostAdditionProcessor("datachannelopen",function(e,t){var n;i&&"datachannel"+i.readyState===e&&((n={type:"datachannel"+i.readyState}).target=s,t(n))}),s.setPostAdditionProcessor("disposed",function(e,t){var n;!0===c&&((n={type:"disposed"}).target=s,t(n))}),s},teltoo.uaParser=function(e){var t,n={};return e=e||navigator.userAgent,n.getDeviceType=function(){return t.getDevice().type},n.getOS=function(){return t.getOS()},n.getBrowser=function(){return t.getBrowser()},t=new teltoo.vendor.UAParser(e),n},teltoo.apiMiddleware=function(e,t,n,r){e=e||"//rtve-a.aws.teltoo.com/5c757a95/api",n=n||5e3,t=t||("undefined"!=typeof location?location.host:void 0),r=r||teltoo.utils.getApiKey();var o,i,a={};var s=180;function c(){return void 0!==i}function d(){clearTimeout(i),i=void 0}function l(e,t,n,r){return void 0===t&&(t=s),d(),0===t||c()||(i=setTimeout(function(){a.playlistInfo(e,r,n)},1e3*t)),i}function u(e,t){var n=document.head,r=document.createElement("script");r.type="text/javascript",r.src=e,r.id=t,n.appendChild(r)}return a.clearCAPlaylistRequestRepetitionTimeout=d,a.isCAPlaylistRequestRepetitionTimeoutDefined=c,a.setCAPlaylistRequestRepetitionTimeout=l,a.dispose=function(){d()},a.peerId=function(){var e;return o||(e=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})),o},a.get=function(o,i){var a=e+"/"+t+o;r&&(a+="&apiKey="+r);var s=new XMLHttpRequest;s.withCredentials=!1,s.open("GET",a),s.timeout=n,s.onload=function(e){if(200!==e.target.status)i(!0,void 0,r||t);else try{if(e.target.response.length){var n=JSON.parse(e.target.response);i(null,n,r||t)}else i(null,void 0,r||t)}catch(e){i(!0,void 0,r||t)}},s.onerror=function(e){i(!0,void 0,r||t)},s.ontimeout=function(e){i({timeout:n},void 0,r||t)},s.send()},a.playlistInfo=function(e,t,n){d();var r="/p?u="+encodeURIComponent(e);t&&(r+="&cid="+t),a.get(r,function(r,o,i){var a;return r||("number"==typeof o.caPlaylistRequestRepetitionTimeout&&(a=o.caPlaylistRequestRepetitionTimeout),o.dynamicScripts&&function(e){var t,n=e.length;if(e)for(var r=0;r<n;r++){var o=e[r];!0===o.on&&(t=o.name,null===document.getElementById(t))&&u(o.url,o.name)}}(o.dynamicScripts),o.allow?o.signallingSessionEndpointBaseUrl&&teltoo.setSsEndpointBaseUrl&&teltoo.setSsEndpointBaseUrl(i,o.signallingSessionEndpointBaseUrl):r="Not Allowed","number"==typeof o.cid&&(t=o.cid),o.sharedFileProbeUrl&&teltoo.startProbe(o.sharedFileProbeUrl)),l(e,a,n,t),n(r,o)})},a},teltoo.playlistInfo=function(e,t,n){n?n.playlistInfo(e,void 0,t):t("No apiMiddleware provided to the arguments",null)},teltoo.reportPlayerInterruption=function(e,t,n){if(n){var r="/i?p="+n.peerId();t&&(r+="&h="+t),e&&(r+="&g="+e),n.get(r,function(e,t){})}},teltoo.reportPlayerInterruptionEnd=function(e,t,n,r){if(r){var o="/ie?p="+r.peerId()+"&t="+e;n&&(o+="&h="+n),t&&(o+="&g="+t),r.get(o,function(e,t){})}},function(e,t,n,r){var o=[],i={_version:"3.11.2",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){o.push({name:e,fn:t,options:n})},addAsyncTest:function(e){o.push({name:null,fn:e})}},a=function(){};a.prototype=i,a=new a;var s,c,d=[];function l(e,t){return typeof e===t}s=l(c={}.hasOwnProperty,"undefined")||l(c.call,"undefined")?function(e,t){return t in e&&l(e.constructor.prototype[t],"undefined")}:function(e,t){return c.call(e,t)};var u=n.documentElement,p="svg"===u.nodeName.toLowerCase();function f(e,t){if("object"==typeof e)for(var n in e)s(e,n)&&f(n,e[n]);else{var r=(e=e.toLowerCase()).split("."),o=a[r[0]];if(2===r.length&&(o=o[r[1]]),void 0!==o)return a;t="function"==typeof t?t():t,1===r.length?a[r[0]]=t:(!a[r[0]]||a[r[0]]instanceof Boolean||(a[r[0]]=new Boolean(a[r[0]])),a[r[0]][r[1]]=t),function(e){var t=u.className,n=a._config.classPrefix||"";if(p&&(t=t.baseVal),a._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}a._config.enableClasses&&(e.length>0&&(t+=" "+n+e.join(" "+n)),p?u.className.baseVal=t:u.className=t)}([(t&&!1!==t?"":"no-")+r.join("-")]),a._trigger(e,t)}return a}i._l={},i.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),a.hasOwnProperty(e)&&setTimeout(function(){a._trigger(e,a[e])},0)},i._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout(function(){var e;for(e=0;e<n.length;e++)(0,n[e])(t)},0),delete this._l[e]}},a._q.push(function(){i.addTest=f}),a.addTest("blobconstructor",function(){try{return!!new Blob}catch(e){return!1}},{aliases:["blob-constructor"]});var v=!1;try{v="WebSocket"in t&&2===t.WebSocket.CLOSING}catch(e){}a.addTest("websockets",v);var g=i._config.usePrefixes?"Moz O ms Webkit".split(" "):[];function m(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):p?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}i._cssomPrefixes=g;var y={elem:m("modernizr")};a._q.push(function(){delete y.elem});var h={style:y.elem.style};function b(e,t,r,o){var i,a,s,c,d="modernizr",l=m("div"),f=function(){var e=n.body;return e||((e=m(p?"svg":"body")).fake=!0),e}();if(parseInt(r,10))for(;r--;)(s=m("div")).id=o?o[r]:d+(r+1),l.appendChild(s);return(i=m("style")).type="text/css",i.id="s"+d,(f.fake?f:l).appendChild(i),f.appendChild(l),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(n.createTextNode(e)),l.id=d,f.fake&&(f.style.background="",f.style.overflow="hidden",c=u.style.overflow,u.style.overflow="hidden",u.appendChild(f)),a=t(l,e),f.fake?(f.parentNode.removeChild(f),u.style.overflow=c,u.offsetHeight):l.parentNode.removeChild(l),!!a}function E(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function T(e,n){var o=e.length;if("CSS"in t&&"supports"in t.CSS){for(;o--;)if(t.CSS.supports(E(e[o]),n))return!0;return!1}if("CSSSupportsRule"in t){for(var i=[];o--;)i.push("("+E(e[o])+":"+n+")");return b("@supports ("+(i=i.join(" or "))+") { #modernizr { position: absolute; } }",function(e){return"absolute"===function(e,n,r){var o;if("getComputedStyle"in t){o=getComputedStyle.call(t,e,n);var i=t.console;null!==o?r&&(o=o.getPropertyValue(r)):i&&i[i.error?"error":"log"].call(i,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}else o=!n&&e.currentStyle&&e.currentStyle[r];return o}(e,null,"position")})}return r}function w(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}a._q.unshift(function(){delete h.style});var S=[""];function R(e,t){return function(){return e.apply(t,arguments)}}function C(e,t,n,o,i){var a=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+g.join(a+" ")+a).split(" ");return l(t,"string")||l(t,"undefined")?function(e,t,n,o){if(o=!l(o,"undefined")&&o,!l(n,"undefined")){var i=T(e,n);if(!l(i,"undefined"))return i}for(var a,s,c,d,u,p=["modernizr","tspan","samp"];!h.style&&p.length;)a=!0,h.modElem=m(p.shift()),h.style=h.modElem.style;function f(){a&&(delete h.style,delete h.modElem)}for(c=e.length,s=0;s<c;s++)if(d=e[s],u=h.style[d],~(""+d).indexOf("-")&&(d=w(d)),h.style[d]!==r){if(o||l(n,"undefined"))return f(),"pfx"!==t||d;try{h.style[d]=n}catch(e){}if(h.style[d]!==u)return f(),"pfx"!==t||d}return f(),!1}(s,t,o,i):function(e,t,n){var r;for(var o in e)if(e[o]in t)return!1===n?e[o]:l(r=t[e[o]],"function")?R(r,n||t):r;return!1}(s=(e+" "+S.join(a+" ")+a).split(" "),t,n)}i._domPrefixes=S,i.testAllProps=C;var L=function(e){var n,o=prefixes.length,i=t.CSSRule;if(void 0===i)return r;if(!e)return!1;if((n=(e=e.replace(/^@/,"")).replace(/-/g,"_").toUpperCase()+"_RULE")in i)return"@"+e;for(var a=0;a<o;a++){var s=prefixes[a];if(s.toUpperCase()+"_"+n in i)return"@-"+s.toLowerCase()+"-"+e}return!1};i.atRule=L;var P=i.prefixed=function(e,t,n){return 0===e.indexOf("@")?L(e):(-1!==e.indexOf("-")&&(e=w(e)),t?C(e,t,n):C(e,"pfx"))},O=P("URL",t,!1);O=O&&t[O],a.addTest("bloburls",O&&"revokeObjectURL"in O&&"createObjectURL"in O);var x=[""].concat(S);i._domPrefixesAll=x,a.addTest("peerconnection",!!P("RTCPeerConnection",t)),a.addTest("datachannel",function(){if(!a.peerconnection)return!1;for(var e=0,n=x.length;e<n;e++){var r=t[x[e]+"RTCPeerConnection"];if(r){var o=new r(null);return o.close(),"createDataChannel"in o}}return!1}),a.addTest("dataview","undefined"!=typeof DataView&&"getFloat64"in DataView.prototype),a.addTest("typedarrays","ArrayBuffer"in t),function(){var e,t,n,r,i,s;for(var c in o)if(o.hasOwnProperty(c)){if(e=[],(t=o[c]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(r=l(t.fn,"function")?t.fn():t.fn,i=0;i<e.length;i++)1===(s=e[i].split(".")).length?a[s[0]]=r:(a[s[0]]&&(!a[s[0]]||a[s[0]]instanceof Boolean)||(a[s[0]]=new Boolean(a[s[0]])),a[s[0]][s[1]]=r),d.push((r?"":"no-")+s.join("-"))}}(),delete i.addTest,delete i.addAsyncTest;for(var I=0;I<a._q.length;I++)a._q[I]();t.teltoo.Modernizr=a}(window,window,document),teltoo.playbackInstance=function(e){var t,n,r,o,i,a,s,c={},d=20,l=!1,u=!1,p=!1,f=!0,v=teltoo.isP2PSupported(),g=teltoo.streamInfo(),m=e||teltoo.bandwidthEstimator();function y(e,r){e?(u=!1,n&&(n.dispose(),n=void 0)):f&&(u=!0,a=r.id,i=r.gid,p=r.reportPlayerMetrics,r.signallingSessionEndpointBaseUrl&&t!==r.signallingSessionEndpointBaseUrl&&(n&&(n.dispose(),n=void 0),t=r.signallingSessionEndpointBaseUrl),n||l||(n=teltoo.clientMiddlewareSession(t)).setBandwidthEstimatorHttp(m))}function h(){n&&(n.dispose(),n=void 0),r&&(r.clearCAPlaylistRequestRepetitionTimeout(),r=void 0),u=!1,a=void 0,i=void 0,s=void 0}return c.setPlaylistUrl=function(e){l||(h(),o=e,f&&v&&(r||(r=teltoo.apiMiddleware()),teltoo.playlistInfo(e,y,r)))},c.setAvailableBitrates=function(e){g.setAvailableBitrates("VIDEO",e)},c.setAvailableBitratesPerTrackType=function(e,t){g.setAvailableBitrates(e,t)},c.dispose=function(e){l=!0,r&&r.clearCAPlaylistRequestRepetitionTimeout(),n&&(n.dispose(),n=void 0),e&&e()},c.enableTeltoo=function(){!1!==f||l||(h(),f=!0,c.setPlaylistUrl(o))},c.disableTeltoo=function(){h(),f=!1},c.downloadWithTeltoo=function(e,t,r,o){var s;if(f&&u&&v){var c,l,p={};s={credentials:void 0,responseType:void 0,withCredentials:void 0,timeout:void 0,response:void 0,status:void 0,readyState:void 0,onload:void 0,onerror:void 0,ontimeout:void 0,onreadystatechange:void 0,onprogress:void 0,onabort:void 0,getResponseHeader:function(e){return null},getAllResponseHeaders:function(){return""},setRequestHeader:function(e,t){p[e]=t},abort:function(){s.readyState=0,s.status=0,c&&c.abort();var e={target:s};s.onabort&&s.onabort(e),s.onreadystatechange&&s.onreadystatechange(e),s.dispatchEvent("readystatechange",{type:"readystatechange",target:s,currentTarget:s}),s.dispatchEvent("abort",{type:"abort",target:s,currentTarget:s})},open:function(e,t,n){l=t,s.credentials=n},send:function(e){var u=performance.now();(c=teltoo.sharedFile(l,n,g)).responseType=s.responseType,c.timeout=s.timeout,c.segmentDuration=t,c.segmentType=r,c.playlistId=a,c.playlistGroupId=i,c.bitrate=o,c.httpRequestHeaders=p;var f=function(e,t,r){var o=-1;if(n&&g&&t&&r){for(var i=m.getBandwidthEstimate(0),a=g.getAvailableBitrates(e),s=0,c=0;0===s&&c<a.length;c++)i>=a[c]&&(s=a[c]);if(s>0){var d=t*r;o=parseInt(1e3*d/s)}}return o}(r,o,t);c.qualityThresholdTime=f,c.adaptiveTimeout=function(e,t,r){var o=-1;if(r>0&&n&&n.getClientDeviceConfig().enableAdaptiveFallbackTimeout&&"number"==typeof n.getClientDeviceConfig().adaptiveFallbackTimeoutGuardBand&&e&&t){var i=m.getBandwidthEstimate(0),a=e*t,s=parseInt(1e3*a/i),c=s*(1+n.getClientDeviceConfig().adaptiveFallbackTimeoutGuardBand);(o=r-c)<d&&(o=0)}return o}(o,t,f),c.addEventListener("load",function(e){if(s.retrievalMethod=e.target.retrievalMethod,"HTTP"!==e.target.retrievalMethod)s.readyState=4,s.status=200,s.statusText="OK",s.responseType=e.target.responseType,s.response=e.target.response;else{var t=e.target;s.readyState=e.target.readyState,s.status=e.target.status,s.responseType=e.target.responseType,s.response=e.target.response,s.statusText=e.target.statusText,s.getResponseHeader=function(e){return t.getResponseHeader(e)},s.getAllResponseHeaders=function(){return t.getAllResponseHeaders()}}var n=0;s.response&&("arraybuffer"===s.responseType?n=s.response.byteLength:"blob"===s.responseType&&(n=s.response.size),e.lengthComputable=!0,e.loaded=n,e.total=n),e.target=s,e.currentTarget=s,s.onreadystatechange&&s.onreadystatechange(e),s.onload&&s.onload(e),s.dispatchEvent("readystatechange",{type:"readystatechange",target:s}),s.dispatchEvent("load",{type:"load",target:s}),"HTTP"===e.target.retrievalMethod&&m.sample(n,performance.now()-u)}),c.addEventListener("error",function(e){s.onerror&&s.onerror(e),s.dispatchEvent("error",{type:"error",target:s})}),c.addEventListener("timeout",function(e){s.status=0,s.readyState=4,s.ontimeout&&(e.target=s,s.ontimeout(e)),s.dispatchEvent("timeout",{type:"timeout",target:s})}),c.addEventListener("progress",function(e){s.onprogress&&s.onprogress(e),s.dispatchEvent("progress",{type:"progress",target:s})})}},teltoo.utils.eventualize(s)}return s},c.stallStart=function(){p&&(s=performance.now(),teltoo.reportPlayerInterruption(i,a,r))},c.stallEnd=function(){if(p&&s){var e=(performance.now()-s)/1e3;s=void 0,teltoo.reportPlayerInterruptionEnd(e,i,a,r)}},c},function(e,t){"use strict";var n="model",r="name",o="type",i="vendor",a="version",s="mobile",c="tablet",d={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},l={rgx:function(e,t){for(var n,r,o,i,a,s,c=0;c<t.length&&!a;){var d=t[c],l=t[c+1];for(n=r=0;n<d.length&&!a;)if(a=d[n++].exec(e))for(o=0;o<l.length;o++)s=a[++r],"object"==typeof(i=l[o])&&i.length>0?2==i.length?"function"==typeof i[1]?this[i[0]]=i[1].call(this,s):this[i[0]]=i[1]:3==i.length?"function"!=typeof i[1]||i[1].exec&&i[1].test?this[i[0]]=s?s.replace(i[1],i[2]):void 0:this[i[0]]=s?i[1].call(this,s,i[2]):void 0:4==i.length&&(this[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):void 0):this[i]=s||void 0;c+=2}},str:function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(d.has(t[n][r],e))return"?"===n?void 0:n}else if(d.has(t[n],e))return"?"===n?void 0:n;return e}},u={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[r,a],[/(opios)[\/\s]+([\w\.]+)/i],[[r,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[r,"Opera"],a],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[r,a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[r,"IE"],a],[/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i],[[r,"Edge"],a],[/(yabrowser)\/([\w\.]+)/i],[[r,"Yandex"],a],[/(puffin)\/([\w\.]+)/i],[[r,"Puffin"],a],[/(focus)\/([\w\.]+)/i],[[r,"Firefox Focus"],a],[/(opt)\/([\w\.]+)/i],[[r,"Opera Touch"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[r,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[r,/_/g," "],a],[/(micromessenger)\/([\w\.]+)/i],[[r,"WeChat"],a],[/(brave)\/([\w\.]+)/i],[[r,"Brave"],a],[/(qqbrowserlite)\/([\w\.]+)/i],[r,a],[/(QQ)\/([\d\.]+)/i],[r,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[r,a],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[r,a],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[r,a],[/(MetaSr)[\/\s]?([\w\.]+)/i],[r],[/(LBBROWSER)/i],[r],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[r,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[r,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[r,a],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[r,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[r,/(.+)/,"$1 WebView"],a],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[r,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[r,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[r,a],[/(dolfin)\/([\w\.]+)/i],[[r,"Dolphin"],a],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[r,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[r,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[r,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[r,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,r],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[r,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[r,[a,l.str,u.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[r,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[r,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[r,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",d.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",d.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",d.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[n,i,[o,c]],[/applecoremedia\/[\w\.]+ \((ipad)/],[n,[i,"Apple"],[o,c]],[/(apple\s{0,1}tv)/i],[[n,"Apple TV"],[i,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[i,n,[o,c]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[n,[i,"Amazon"],[o,c]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[n,l.str,u.device.amazon.model],[i,"Amazon"],[o,s]],[/android.+aft([bms])\sbuild/i],[n,[i,"Amazon"],[o,"smarttv"]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[n,i,[o,s]],[/\((ip[honed|\s\w*]+);/i],[n,[i,"Apple"],[o,s]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[i,n,[o,s]],[/\(bb10;\s(\w+)/i],[n,[i,"BlackBerry"],[o,s]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[n,[i,"Asus"],[o,c]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[i,"Sony"],[n,"Xperia Tablet"],[o,c]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[n,[i,"Sony"],[o,s]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[i,n,[o,"console"]],[/android.+;\s(shield)\sbuild/i],[n,[i,"Nvidia"],[o,"console"]],[/(playstation\s[34portablevi]+)/i],[n,[i,"Sony"],[o,"console"]],[/(sprint\s(\w+))/i],[[i,l.str,u.device.sprint.vendor],[n,l.str,u.device.sprint.model],[o,s]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[i,n,[o,c]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[i,[n,/_/g," "],[o,s]],[/(nexus\s9)/i],[n,[i,"HTC"],[o,c]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[n,[i,"Huawei"],[o,s]],[/(microsoft);\s(lumia[\s\w]+)/i],[i,n,[o,s]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[n,[i,"Microsoft"],[o,"console"]],[/(kin\.[onetw]{3})/i],[[n,/\./g," "],[i,"Microsoft"],[o,s]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[n,[i,"Motorola"],[o,s]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[n,[i,"Motorola"],[o,c]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[i,d.trim],[n,d.trim],[o,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[n,/^/,"SmartTV"],[i,"Samsung"],[o,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[n,[i,"Sharp"],[o,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[i,"Samsung"],n,[o,c]],[/smart-tv.+(samsung)/i],[i,[o,"smarttv"],n],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[i,"Samsung"],n,[o,s]],[/sie-(\w*)/i],[n,[i,"Siemens"],[o,s]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[i,"Nokia"],n,[o,s]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[n,[i,"Acer"],[o,c]],[/android.+([vl]k\-?\d{3})\s+build/i],[n,[i,"LG"],[o,c]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[i,"LG"],n,[o,c]],[/(lg) netcast\.tv/i],[i,n,[o,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[n,[i,"LG"],[o,s]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[n,[i,"Lenovo"],[o,c]],[/linux;.+((jolla));/i],[i,n,[o,s]],[/((pebble))app\/[\d\.]+\s/i],[i,n,[o,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[i,n,[o,s]],[/crkey/i],[[n,"Chromecast"],[i,"Google"]],[/android.+;\s(glass)\s\d/i],[n,[i,"Google"],[o,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[n,[i,"Google"],[o,c]],[/android.+;\s(pixel( [23])?( xl)?)\s/i],[n,[i,"Google"],[o,s]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[n,/_/g," "],[i,"Xiaomi"],[o,s]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[n,/_/g," "],[i,"Xiaomi"],[o,c]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[n,[i,"Meizu"],[o,c]],[/(mz)-([\w-]{2,})/i],[[i,"Meizu"],n,[o,s]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[n,[i,"OnePlus"],[o,s]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[n,[i,"RCA"],[o,c]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[n,[i,"Dell"],[o,c]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[n,[i,"Verizon"],[o,c]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[i,"Barnes & Noble"],n,[o,c]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[n,[i,"NuVision"],[o,c]],[/android.+;\s(k88)\sbuild/i],[n,[i,"ZTE"],[o,c]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[n,[i,"Swiss"],[o,s]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[n,[i,"Swiss"],[o,c]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[n,[i,"Zeki"],[o,c]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[i,"Dragon Touch"],n,[o,c]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[n,[i,"Insignia"],[o,c]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[n,[i,"NextBook"],[o,c]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[i,"Voice"],n,[o,s]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[i,"LvTel"],n,[o,s]],[/android.+;\s(PH-1)\s/i],[n,[i,"Essential"],[o,s]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[n,[i,"Envizen"],[o,c]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[i,n,[o,c]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[n,[i,"MachSpeed"],[o,c]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[i,n,[o,c]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[n,[i,"Rotor"],[o,c]],[/android.+(KS(.+))\s+build/i],[n,[i,"Amazon"],[o,c]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[i,n,[o,c]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[o,d.lowerize],i,n],[/(android[\w\.\s\-]{0,9});.+build/i],[n,[i,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[r,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[r,a],[/rv\:([\w\.]{1,9}).+(gecko)/i],[a,r]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[r,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[r,[a,l.str,u.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[r,"Windows"],[a,l.str,u.os.windows.version]],[/\((bb)(10);/i],[[r,"BlackBerry"],a],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[r,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[r,"Symbian"],a],[/\((series40);/i],[r],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[r,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[r,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[r,"Chromium OS"],a],[/(sunos)\s?([\w\.\d]*)/i],[[r,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[r,a],[/(haiku)\s(\w+)/i],[r,a],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[r,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[r,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[r,a]]},f=function(t,n){if("object"==typeof t&&(n=t,t=void 0),!(this instanceof f))return new f(t,n).getResult();var r=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),o=n?d.extend(p,n):p;return this.getBrowser=function(){var e={name:void 0,version:void 0};return l.rgx.call(e,r,o.browser),e.major=d.major(e.version),e},this.getCPU=function(){var e={architecture:void 0};return l.rgx.call(e,r,o.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return l.rgx.call(e,r,o.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return l.rgx.call(e,r,o.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return l.rgx.call(e,r,o.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=e,this},this};f.VERSION="0.7.19",f.BROWSER={NAME:r,MAJOR:"major",VERSION:a},f.CPU={ARCHITECTURE:"architecture"},f.DEVICE={MODEL:n,VENDOR:i,TYPE:o,CONSOLE:"console",MOBILE:s,SMARTTV:"smarttv",TABLET:c,WEARABLE:"wearable",EMBEDDED:"embedded"},f.ENGINE={NAME:r,VERSION:a},f.OS={NAME:r,VERSION:a},teltoo.vendor=teltoo.vendor||{},teltoo.vendor.UAParser=f}("object"==typeof window?window:this);